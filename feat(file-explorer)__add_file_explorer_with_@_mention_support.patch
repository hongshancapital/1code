Subject: [PATCH] feat(file-explorer): add file explorer with @ mention support
---
Index: bun.lock
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/bun.lock b/bun.lock
--- a/bun.lock	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/bun.lock	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -1,5 +1,6 @@
 {
   "lockfileVersion": 1,
+  "configVersion": 0,
   "workspaces": {
     "": {
       "name": "21st-desktop",
@@ -51,6 +52,7 @@
         "gray-matter": "^4.0.3",
         "jotai": "^2.11.1",
         "lucide-react": "^0.468.0",
+        "mermaid": "^11.12.2",
         "motion": "^11.15.0",
         "next-themes": "^0.4.4",
         "node-pty": "^1.1.0",
@@ -62,6 +64,7 @@
         "react-hotkeys-hook": "^4.6.1",
         "react-icons": "^5.5.0",
         "react-syntax-highlighter": "^16.1.0",
+        "react-zoom-pan-pinch": "^3.7.0",
         "remark-breaks": "^4.0.0",
         "remark-gfm": "^4.0.1",
         "shiki": "^1.24.4",
@@ -112,6 +115,8 @@
 
     "@alloc/quick-lru": ["@alloc/quick-lru@5.2.0", "", {}, "sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw=="],
 
+    "@antfu/install-pkg": ["@antfu/install-pkg@1.1.0", "", { "dependencies": { "package-manager-detector": "^1.3.0", "tinyexec": "^1.0.1" } }, "sha512-MGQsmw10ZyI+EJo45CdSER4zEb+p31LpDAFp2Z3gkSd1yqVZGi0Ebx++YTEMonJy4oChEMLsxZ64j8FH6sSqtQ=="],
+
     "@anthropic-ai/claude-agent-sdk": ["@anthropic-ai/claude-agent-sdk@0.2.15", "", { "optionalDependencies": { "@img/sharp-darwin-arm64": "^0.33.5", "@img/sharp-darwin-x64": "^0.33.5", "@img/sharp-linux-arm": "^0.33.5", "@img/sharp-linux-arm64": "^0.33.5", "@img/sharp-linux-x64": "^0.33.5", "@img/sharp-linuxmusl-arm64": "^0.33.5", "@img/sharp-linuxmusl-x64": "^0.33.5", "@img/sharp-win32-x64": "^0.33.5" }, "peerDependencies": { "zod": "^4.0.0" } }, "sha512-KN3jrHR5tIcAfLbplK5xHqNyUS3XnG8DMnImGeVEv64Z8NxfxIWtJTxtuBRWjyYzo36PEhK4r2SkX97A2iG+ng=="],
 
     "@apm-js-collab/code-transformer": ["@apm-js-collab/code-transformer@0.8.2", "", {}, "sha512-YRjJjNq5KFSjDUoqu5pFUWrrsvGOxl6c3bu+uMFc9HNNptZ2rNU/TI2nLw4jnhQNtka972Ee2m3uqbvDQtPeCA=="],
@@ -160,6 +165,18 @@
 
     "@babel/types": ["@babel/types@7.28.6", "", { "dependencies": { "@babel/helper-string-parser": "^7.27.1", "@babel/helper-validator-identifier": "^7.28.5" } }, "sha512-0ZrskXVEHSWIqZM/sQZ4EV3jZJXRkio/WCxaqKZP1g//CEWEPSfeZFcms4XeKBCHU0ZKnIkdJeU/kF+eRp5lBg=="],
 
+    "@braintree/sanitize-url": ["@braintree/sanitize-url@7.1.1", "", {}, "sha512-i1L7noDNxtFyL5DmZafWy1wRVhGehQmzZaz1HiN5e7iylJMSZR7ekOV7NsIqa5qBldlLrsKv4HbgFUVlQrz8Mw=="],
+
+    "@chevrotain/cst-dts-gen": ["@chevrotain/cst-dts-gen@11.0.3", "", { "dependencies": { "@chevrotain/gast": "11.0.3", "@chevrotain/types": "11.0.3", "lodash-es": "4.17.21" } }, "sha512-BvIKpRLeS/8UbfxXxgC33xOumsacaeCKAjAeLyOn7Pcp95HiRbrpl14S+9vaZLolnbssPIUuiUd8IvgkRyt6NQ=="],
+
+    "@chevrotain/gast": ["@chevrotain/gast@11.0.3", "", { "dependencies": { "@chevrotain/types": "11.0.3", "lodash-es": "4.17.21" } }, "sha512-+qNfcoNk70PyS/uxmj3li5NiECO+2YKZZQMbmjTqRI3Qchu8Hig/Q9vgkHpI3alNjr7M+a2St5pw5w5F6NL5/Q=="],
+
+    "@chevrotain/regexp-to-ast": ["@chevrotain/regexp-to-ast@11.0.3", "", {}, "sha512-1fMHaBZxLFvWI067AVbGJav1eRY7N8DDvYCTwGBiE/ytKBgP8azTdgyrKyWZ9Mfh09eHWb5PgTSO8wi7U824RA=="],
+
+    "@chevrotain/types": ["@chevrotain/types@11.0.3", "", {}, "sha512-gsiM3G8b58kZC2HaWR50gu6Y1440cHiJ+i3JUvcp/35JchYejb2+5MVeJK0iKThYpAa/P2PYFV4hoi44HD+aHQ=="],
+
+    "@chevrotain/utils": ["@chevrotain/utils@11.0.3", "", {}, "sha512-YslZMgtJUyuMbZ+aKvfF3x1f5liK4mWNxghFRv7jqRR9C3R3fAOGTTKvxXDa2Y1s9zSbcpuO0cAxDYsc9SrXoQ=="],
+
     "@develar/schema-utils": ["@develar/schema-utils@2.6.5", "", { "dependencies": { "ajv": "^6.12.0", "ajv-keywords": "^3.4.1" } }, "sha512-0cp4PsWQ/9avqTVMCtZ+GirikIA36ikvjtHweU4/j8yLtgObI0+JUPhYFScgwlteveGB1rt3Cm8UhN04XayDig=="],
 
     "@drizzle-team/brocli": ["@drizzle-team/brocli@0.10.2", "", {}, "sha512-z33Il7l5dKjUgGULTqBsQBQwckHh5AbIuxhdsIxDDiZAzBOrZO6q9ogcWC65kU382AfynTfgNumVcNIjuIua6w=="],
@@ -256,6 +273,10 @@
 
     "@hono/node-server": ["@hono/node-server@1.19.9", "", { "peerDependencies": { "hono": "^4" } }, "sha512-vHL6w3ecZsky+8P5MD+eFfaGTyCeOHUIFYMGpQGbrBTSmNNoxv0if69rEZ5giu36weC5saFuznL411gRX7bJDw=="],
 
+    "@iconify/types": ["@iconify/types@2.0.0", "", {}, "sha512-+wluvCrRhXrhyOmRDJ3q8mux9JkKy5SJ/v8ol2tu4FVjyYvtEzkc/3pK15ET6RKg4b4w4BmTk1+gsCUhf21Ykg=="],
+
+    "@iconify/utils": ["@iconify/utils@3.1.0", "", { "dependencies": { "@antfu/install-pkg": "^1.1.0", "@iconify/types": "^2.0.0", "mlly": "^1.8.0" } }, "sha512-Zlzem1ZXhI1iHeeERabLNzBHdOa4VhQbqAcOQaMKuTuyZCpwKbC2R4Dd0Zo3g9EAc+Y4fiarO8HIHRAth7+skw=="],
+
     "@img/sharp-darwin-arm64": ["@img/sharp-darwin-arm64@0.33.5", "", { "optionalDependencies": { "@img/sharp-libvips-darwin-arm64": "1.0.4" }, "os": "darwin", "cpu": "arm64" }, "sha512-UT4p+iz/2H4twwAoLCqfA9UH5pI6DggwKEGuaPy7nCVQ8ZsiY5PIcrRvD1DzuY3qYL07NtIQcWnBSY/heikIFQ=="],
 
     "@img/sharp-darwin-x64": ["@img/sharp-darwin-x64@0.33.5", "", { "optionalDependencies": { "@img/sharp-libvips-darwin-x64": "1.0.4" }, "os": "darwin", "cpu": "x64" }, "sha512-fyHac4jIc1ANYGRDxtiqelIbdWkIuQaI84Mv45KvGRRxSAa7o7d1ZKAOBaYbnepLC1WqxfpimdeWfvqqSGwR2Q=="],
@@ -310,6 +331,8 @@
 
     "@malept/flatpak-bundler": ["@malept/flatpak-bundler@0.4.0", "", { "dependencies": { "debug": "^4.1.1", "fs-extra": "^9.0.0", "lodash": "^4.17.15", "tmp-promise": "^3.0.2" } }, "sha512-9QOtNffcOF/c1seMCDnjckb3R9WHcG34tky+FHpNKKCW0wc/scYLwMtO+ptyGUfMW0/b/n4qRiALlaFHc9Oj7Q=="],
 
+    "@mermaid-js/parser": ["@mermaid-js/parser@0.6.3", "", { "dependencies": { "langium": "3.3.1" } }, "sha512-lnjOhe7zyHjc+If7yT4zoedx2vo4sHaTmtkl1+or8BRTnCtDmcTpAjpzDSfCZrshM5bCoz0GyidzadJAH1xobA=="],
+
     "@modelcontextprotocol/sdk": ["@modelcontextprotocol/sdk@1.25.3", "", { "dependencies": { "@hono/node-server": "^1.19.9", "ajv": "^8.17.1", "ajv-formats": "^3.0.1", "content-type": "^1.0.5", "cors": "^2.8.5", "cross-spawn": "^7.0.5", "eventsource": "^3.0.2", "eventsource-parser": "^3.0.0", "express": "^5.0.1", "express-rate-limit": "^7.5.0", "jose": "^6.1.1", "json-schema-typed": "^8.0.2", "pkce-challenge": "^5.0.0", "raw-body": "^3.0.0", "zod": "^3.25 || ^4.0", "zod-to-json-schema": "^3.25.0" }, "peerDependencies": { "@cfworker/json-schema": "^4.1.1" }, "optionalPeers": ["@cfworker/json-schema"] }, "sha512-vsAMBMERybvYgKbg/l4L1rhS7VXV1c0CtyJg72vwxONVX0l4ZfKVAnZEWTQixJGTzKnELjQ59e4NbdFDALRiAQ=="],
 
     "@nodelib/fs.scandir": ["@nodelib/fs.scandir@2.1.5", "", { "dependencies": { "@nodelib/fs.stat": "2.0.5", "run-parallel": "^1.1.9" } }, "sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g=="],
@@ -636,6 +659,68 @@
 
     "@types/connect": ["@types/connect@3.4.38", "", { "dependencies": { "@types/node": "*" } }, "sha512-K6uROf1LD88uDQqJCktA4yzL1YYAK6NgfsI0v/mTgyPKWsX1CnJ0XPSDhViejru1GcRkLWb8RlzFYJRqGUbaug=="],
 
+    "@types/d3": ["@types/d3@7.4.3", "", { "dependencies": { "@types/d3-array": "*", "@types/d3-axis": "*", "@types/d3-brush": "*", "@types/d3-chord": "*", "@types/d3-color": "*", "@types/d3-contour": "*", "@types/d3-delaunay": "*", "@types/d3-dispatch": "*", "@types/d3-drag": "*", "@types/d3-dsv": "*", "@types/d3-ease": "*", "@types/d3-fetch": "*", "@types/d3-force": "*", "@types/d3-format": "*", "@types/d3-geo": "*", "@types/d3-hierarchy": "*", "@types/d3-interpolate": "*", "@types/d3-path": "*", "@types/d3-polygon": "*", "@types/d3-quadtree": "*", "@types/d3-random": "*", "@types/d3-scale": "*", "@types/d3-scale-chromatic": "*", "@types/d3-selection": "*", "@types/d3-shape": "*", "@types/d3-time": "*", "@types/d3-time-format": "*", "@types/d3-timer": "*", "@types/d3-transition": "*", "@types/d3-zoom": "*" } }, "sha512-lZXZ9ckh5R8uiFVt8ogUNf+pIrK4EsWrx2Np75WvF/eTpJ0FMHNhjXk8CKEx/+gpHbNQyJWehbFaTvqmHWB3ww=="],
+
+    "@types/d3-array": ["@types/d3-array@3.2.2", "", {}, "sha512-hOLWVbm7uRza0BYXpIIW5pxfrKe0W+D5lrFiAEYR+pb6w3N2SwSMaJbXdUfSEv+dT4MfHBLtn5js0LAWaO6otw=="],
+
+    "@types/d3-axis": ["@types/d3-axis@3.0.6", "", { "dependencies": { "@types/d3-selection": "*" } }, "sha512-pYeijfZuBd87T0hGn0FO1vQ/cgLk6E1ALJjfkC0oJ8cbwkZl3TpgS8bVBLZN+2jjGgg38epgxb2zmoGtSfvgMw=="],
+
+    "@types/d3-brush": ["@types/d3-brush@3.0.6", "", { "dependencies": { "@types/d3-selection": "*" } }, "sha512-nH60IZNNxEcrh6L1ZSMNA28rj27ut/2ZmI3r96Zd+1jrZD++zD3LsMIjWlvg4AYrHn/Pqz4CF3veCxGjtbqt7A=="],
+
+    "@types/d3-chord": ["@types/d3-chord@3.0.6", "", {}, "sha512-LFYWWd8nwfwEmTZG9PfQxd17HbNPksHBiJHaKuY1XeqscXacsS2tyoo6OdRsjf+NQYeB6XrNL3a25E3gH69lcg=="],
+
+    "@types/d3-color": ["@types/d3-color@3.1.3", "", {}, "sha512-iO90scth9WAbmgv7ogoq57O9YpKmFBbmoEoCHDB2xMBY0+/KVrqAaCDyCE16dUspeOvIxFFRI+0sEtqDqy2b4A=="],
+
+    "@types/d3-contour": ["@types/d3-contour@3.0.6", "", { "dependencies": { "@types/d3-array": "*", "@types/geojson": "*" } }, "sha512-BjzLgXGnCWjUSYGfH1cpdo41/hgdWETu4YxpezoztawmqsvCeep+8QGfiY6YbDvfgHz/DkjeIkkZVJavB4a3rg=="],
+
+    "@types/d3-delaunay": ["@types/d3-delaunay@6.0.4", "", {}, "sha512-ZMaSKu4THYCU6sV64Lhg6qjf1orxBthaC161plr5KuPHo3CNm8DTHiLw/5Eq2b6TsNP0W0iJrUOFscY6Q450Hw=="],
+
+    "@types/d3-dispatch": ["@types/d3-dispatch@3.0.7", "", {}, "sha512-5o9OIAdKkhN1QItV2oqaE5KMIiXAvDWBDPrD85e58Qlz1c1kI/J0NcqbEG88CoTwJrYe7ntUCVfeUl2UJKbWgA=="],
+
+    "@types/d3-drag": ["@types/d3-drag@3.0.7", "", { "dependencies": { "@types/d3-selection": "*" } }, "sha512-HE3jVKlzU9AaMazNufooRJ5ZpWmLIoc90A37WU2JMmeq28w1FQqCZswHZ3xR+SuxYftzHq6WU6KJHvqxKzTxxQ=="],
+
+    "@types/d3-dsv": ["@types/d3-dsv@3.0.7", "", {}, "sha512-n6QBF9/+XASqcKK6waudgL0pf/S5XHPPI8APyMLLUHd8NqouBGLsU8MgtO7NINGtPBtk9Kko/W4ea0oAspwh9g=="],
+
+    "@types/d3-ease": ["@types/d3-ease@3.0.2", "", {}, "sha512-NcV1JjO5oDzoK26oMzbILE6HW7uVXOHLQvHshBUW4UMdZGfiY6v5BeQwh9a9tCzv+CeefZQHJt5SRgK154RtiA=="],
+
+    "@types/d3-fetch": ["@types/d3-fetch@3.0.7", "", { "dependencies": { "@types/d3-dsv": "*" } }, "sha512-fTAfNmxSb9SOWNB9IoG5c8Hg6R+AzUHDRlsXsDZsNp6sxAEOP0tkP3gKkNSO/qmHPoBFTxNrjDprVHDQDvo5aA=="],
+
+    "@types/d3-force": ["@types/d3-force@3.0.10", "", {}, "sha512-ZYeSaCF3p73RdOKcjj+swRlZfnYpK1EbaDiYICEEp5Q6sUiqFaFQ9qgoshp5CzIyyb/yD09kD9o2zEltCexlgw=="],
+
+    "@types/d3-format": ["@types/d3-format@3.0.4", "", {}, "sha512-fALi2aI6shfg7vM5KiR1wNJnZ7r6UuggVqtDA+xiEdPZQwy/trcQaHnwShLuLdta2rTymCNpxYTiMZX/e09F4g=="],
+
+    "@types/d3-geo": ["@types/d3-geo@3.1.0", "", { "dependencies": { "@types/geojson": "*" } }, "sha512-856sckF0oP/diXtS4jNsiQw/UuK5fQG8l/a9VVLeSouf1/PPbBE1i1W852zVwKwYCBkFJJB7nCFTbk6UMEXBOQ=="],
+
+    "@types/d3-hierarchy": ["@types/d3-hierarchy@3.1.7", "", {}, "sha512-tJFtNoYBtRtkNysX1Xq4sxtjK8YgoWUNpIiUee0/jHGRwqvzYxkq0hGVbbOGSz+JgFxxRu4K8nb3YpG3CMARtg=="],
+
+    "@types/d3-interpolate": ["@types/d3-interpolate@3.0.4", "", { "dependencies": { "@types/d3-color": "*" } }, "sha512-mgLPETlrpVV1YRJIglr4Ez47g7Yxjl1lj7YKsiMCb27VJH9W8NVM6Bb9d8kkpG/uAQS5AmbA48q2IAolKKo1MA=="],
+
+    "@types/d3-path": ["@types/d3-path@3.1.1", "", {}, "sha512-VMZBYyQvbGmWyWVea0EHs/BwLgxc+MKi1zLDCONksozI4YJMcTt8ZEuIR4Sb1MMTE8MMW49v0IwI5+b7RmfWlg=="],
+
+    "@types/d3-polygon": ["@types/d3-polygon@3.0.2", "", {}, "sha512-ZuWOtMaHCkN9xoeEMr1ubW2nGWsp4nIql+OPQRstu4ypeZ+zk3YKqQT0CXVe/PYqrKpZAi+J9mTs05TKwjXSRA=="],
+
+    "@types/d3-quadtree": ["@types/d3-quadtree@3.0.6", "", {}, "sha512-oUzyO1/Zm6rsxKRHA1vH0NEDG58HrT5icx/azi9MF1TWdtttWl0UIUsjEQBBh+SIkrpd21ZjEv7ptxWys1ncsg=="],
+
+    "@types/d3-random": ["@types/d3-random@3.0.3", "", {}, "sha512-Imagg1vJ3y76Y2ea0871wpabqp613+8/r0mCLEBfdtqC7xMSfj9idOnmBYyMoULfHePJyxMAw3nWhJxzc+LFwQ=="],
+
+    "@types/d3-scale": ["@types/d3-scale@4.0.9", "", { "dependencies": { "@types/d3-time": "*" } }, "sha512-dLmtwB8zkAeO/juAMfnV+sItKjlsw2lKdZVVy6LRr0cBmegxSABiLEpGVmSJJ8O08i4+sGR6qQtb6WtuwJdvVw=="],
+
+    "@types/d3-scale-chromatic": ["@types/d3-scale-chromatic@3.1.0", "", {}, "sha512-iWMJgwkK7yTRmWqRB5plb1kadXyQ5Sj8V/zYlFGMUBbIPKQScw+Dku9cAAMgJG+z5GYDoMjWGLVOvjghDEFnKQ=="],
+
+    "@types/d3-selection": ["@types/d3-selection@3.0.11", "", {}, "sha512-bhAXu23DJWsrI45xafYpkQ4NtcKMwWnAC/vKrd2l+nxMFuvOT3XMYTIj2opv8vq8AO5Yh7Qac/nSeP/3zjTK0w=="],
+
+    "@types/d3-shape": ["@types/d3-shape@3.1.8", "", { "dependencies": { "@types/d3-path": "*" } }, "sha512-lae0iWfcDeR7qt7rA88BNiqdvPS5pFVPpo5OfjElwNaT2yyekbM0C9vK+yqBqEmHr6lDkRnYNoTBYlAgJa7a4w=="],
+
+    "@types/d3-time": ["@types/d3-time@3.0.4", "", {}, "sha512-yuzZug1nkAAaBlBBikKZTgzCeA+k1uy4ZFwWANOfKw5z5LRhV0gNA7gNkKm7HoK+HRN0wX3EkxGk0fpbWhmB7g=="],
+
+    "@types/d3-time-format": ["@types/d3-time-format@4.0.3", "", {}, "sha512-5xg9rC+wWL8kdDj153qZcsJ0FWiFt0J5RB6LYUNZjwSnesfblqrI/bJ1wBdJ8OQfncgbJG5+2F+qfqnqyzYxyg=="],
+
+    "@types/d3-timer": ["@types/d3-timer@3.0.2", "", {}, "sha512-Ps3T8E8dZDam6fUyNiMkekK3XUsaUEik+idO9/YjPtfj2qruF8tFBXS7XhtE4iIXBLxhmLjP3SXpLhVf21I9Lw=="],
+
+    "@types/d3-transition": ["@types/d3-transition@3.0.9", "", { "dependencies": { "@types/d3-selection": "*" } }, "sha512-uZS5shfxzO3rGlu0cC3bjmMFKsXv+SmZZcgp0KD22ts4uGXp5EVYGzu/0YdwZeKmddhcAccYtREJKkPfXkZuCg=="],
+
+    "@types/d3-zoom": ["@types/d3-zoom@3.0.8", "", { "dependencies": { "@types/d3-interpolate": "*", "@types/d3-selection": "*" } }, "sha512-iqMC4/YlFCSlO8+2Ii1GGGliCAY4XdeG748w5vQUbevlbDu0zSjH/+jojorQVBK/se0j6DUFNPBGSqD3YWYnDw=="],
+
     "@types/debug": ["@types/debug@4.1.12", "", { "dependencies": { "@types/ms": "*" } }, "sha512-vIChWdVG3LG1SMxEvI/AK+FWJthlrqlTu7fbrlywTkkaONwk/UAGaULXRlf8vkzFBLVm0zkMdCquhL5aOjhXPQ=="],
 
     "@types/estree": ["@types/estree@1.0.8", "", {}, "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w=="],
@@ -644,6 +729,8 @@
 
     "@types/fs-extra": ["@types/fs-extra@9.0.13", "", { "dependencies": { "@types/node": "*" } }, "sha512-nEnwB++1u5lVDM2UI4c1+5R+FYaKfaAzS4OococimjVm3nQw3TuzH5UNsocrcTBbhnerblyHj4A49qXbIiZdpA=="],
 
+    "@types/geojson": ["@types/geojson@7946.0.16", "", {}, "sha512-6C8nqWur3j98U6+lXDfTUWIfgvZU+EumvpHKcYjujKH7woYyLj2sUmff0tRhrqM7BohUw7Pz3ZB1jj2gW9Fvmg=="],
+
     "@types/hast": ["@types/hast@3.0.4", "", { "dependencies": { "@types/unist": "*" } }, "sha512-WPs+bbQw5aCj+x6laNGWLH3wviHtoCv/P3+otBhbOhJgG8qtpdAMlTCxLtsTWA7LH1Oh/bFCHsBn0TPS5m30EQ=="],
 
     "@types/http-cache-semantics": ["@types/http-cache-semantics@4.0.4", "", {}, "sha512-1m0bIFVc7eJWyve9S0RnuRgcQqF/Xd5QsUZAZeQFr1Q3/p9JWoQQEqmVy+DPTNpGXwhgIetAoYF8JSc33q29QA=="],
@@ -842,6 +929,10 @@
 
     "character-reference-invalid": ["character-reference-invalid@2.0.1", "", {}, "sha512-iBZ4F4wRbyORVsu0jPV7gXkOsGYjGHPmAyv+HiHG8gi5PtC9KI2j1+v8/tlibRvjoWX027ypmG/n0HtO5t7unw=="],
 
+    "chevrotain": ["chevrotain@11.0.3", "", { "dependencies": { "@chevrotain/cst-dts-gen": "11.0.3", "@chevrotain/gast": "11.0.3", "@chevrotain/regexp-to-ast": "11.0.3", "@chevrotain/types": "11.0.3", "@chevrotain/utils": "11.0.3", "lodash-es": "4.17.21" } }, "sha512-ci2iJH6LeIkvP9eJW6gpueU8cnZhv85ELY8w8WiFtNjMHA5ad6pQLaJo9mEly/9qUyCpvqX8/POVUTf18/HFdw=="],
+
+    "chevrotain-allstar": ["chevrotain-allstar@0.3.1", "", { "dependencies": { "lodash-es": "^4.17.21" }, "peerDependencies": { "chevrotain": "^11.0.0" } }, "sha512-b7g+y9A0v4mxCW1qUhf3BSVPg+/NvGErk/dOkrDaHA0nQIQGAtrOjlX//9OQtRlSCy+x9rfB5N8yC71lH1nvMw=="],
+
     "chokidar": ["chokidar@5.0.0", "", { "dependencies": { "readdirp": "^5.0.0" } }, "sha512-TQMmc3w+5AxjpL8iIiwebF73dRDF4fBIieAqGn9RGCWaEVwQ6Fb2cGe31Yns0RRIzii5goJ1Y7xbMwo1TxMplw=="],
 
     "chownr": ["chownr@2.0.0", "", {}, "sha512-bIomtDF5KGpdogkLd9VspvFzk9KfpyyGlS8YFVZl7TGPBHL5snIOnxeshwVgPteQ9b4Eydl+pVbIyE1DcvCWgQ=="],
@@ -888,6 +979,8 @@
 
     "concat-map": ["concat-map@0.0.1", "", {}, "sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg=="],
 
+    "confbox": ["confbox@0.1.8", "", {}, "sha512-RMtmw0iFkeR4YV+fUOSucriAQNb9g8zFR52MWCtl+cCZOFRNL6zeB395vPzFhEjjn4fMxXudmELnl/KF/WrK6w=="],
+
     "config-file-ts": ["config-file-ts@0.2.8-rc1", "", { "dependencies": { "glob": "^10.3.12", "typescript": "^5.4.3" } }, "sha512-GtNECbVI82bT4RiDIzBSVuTKoSHufnU7Ce7/42bkWZJZFLjmDF2WBpVsvRkhKCfKBnTBb3qZrBwPpFBU/Myvhg=="],
 
     "console-control-strings": ["console-control-strings@1.1.0", "", {}, "sha512-ty/fTekppD2fIwRvnZAVdeOiGd1c7YXEixbgJTNzqcxJWKQnjJ/V1bNEEE6hygpM3WjwHFUVK6HTjWSzV4a8sQ=="],
@@ -910,6 +1003,8 @@
 
     "cors": ["cors@2.8.5", "", { "dependencies": { "object-assign": "^4", "vary": "^1" } }, "sha512-KIHbLJqu73RGr/hnbrO9uBeixNGuvSQjul/jdFvS/KFSIH1hWVd1ng7zOHx+YrEfInLG7q4n6GHQ9cDtxv/P6g=="],
 
+    "cose-base": ["cose-base@1.0.3", "", { "dependencies": { "layout-base": "^1.0.0" } }, "sha512-s9whTXInMSgAp/NVXVNuVxVKzGH2qck3aQlVHxDCdAEPgtMKwc4Wq6/QKhgdEdgbLSi9rBTAcPoRa6JpiG4ksg=="],
+
     "crc": ["crc@3.8.0", "", { "dependencies": { "buffer": "^5.1.0" } }, "sha512-iX3mfgcTMIq3ZKLIsVFAbv7+Mc10kxabAGQb8HvjA1o3T1PIYprbakQ65d3I+2HGHt6nSKkM9PYjgoJO2KcFBQ=="],
 
     "crc-32": ["crc-32@1.2.2", "", { "bin": { "crc32": "bin/crc32.njs" } }, "sha512-ROmzCKrTnOwybPcJApAA6WBWij23HVfGVNKqqrZpuyZOHqK2CwHSvpGuyt/UNNvaIjEd8X5IFGp4Mh+Ie1IHJQ=="],
@@ -922,8 +1017,82 @@
 
     "csstype": ["csstype@3.2.3", "", {}, "sha512-z1HGKcYy2xA8AGQfwrn0PAy+PB7X/GSj3UVJW9qKyn43xWa+gl5nXmU4qqLMRzWVLFC8KusUX8T/0kCiOYpAIQ=="],
 
+    "cytoscape": ["cytoscape@3.33.1", "", {}, "sha512-iJc4TwyANnOGR1OmWhsS9ayRS3s+XQ185FmuHObThD+5AeJCakAAbWv8KimMTt08xCCLNgneQwFp+JRJOr9qGQ=="],
+
+    "cytoscape-cose-bilkent": ["cytoscape-cose-bilkent@4.1.0", "", { "dependencies": { "cose-base": "^1.0.0" }, "peerDependencies": { "cytoscape": "^3.2.0" } }, "sha512-wgQlVIUJF13Quxiv5e1gstZ08rnZj2XaLHGoFMYXz7SkNfCDOOteKBE6SYRfA9WxxI/iBc3ajfDoc6hb/MRAHQ=="],
+
+    "cytoscape-fcose": ["cytoscape-fcose@2.2.0", "", { "dependencies": { "cose-base": "^2.2.0" }, "peerDependencies": { "cytoscape": "^3.2.0" } }, "sha512-ki1/VuRIHFCzxWNrsshHYPs6L7TvLu3DL+TyIGEsRcvVERmxokbf5Gdk7mFxZnTdiGtnA4cfSmjZJMviqSuZrQ=="],
+
+    "d3": ["d3@7.9.0", "", { "dependencies": { "d3-array": "3", "d3-axis": "3", "d3-brush": "3", "d3-chord": "3", "d3-color": "3", "d3-contour": "4", "d3-delaunay": "6", "d3-dispatch": "3", "d3-drag": "3", "d3-dsv": "3", "d3-ease": "3", "d3-fetch": "3", "d3-force": "3", "d3-format": "3", "d3-geo": "3", "d3-hierarchy": "3", "d3-interpolate": "3", "d3-path": "3", "d3-polygon": "3", "d3-quadtree": "3", "d3-random": "3", "d3-scale": "4", "d3-scale-chromatic": "3", "d3-selection": "3", "d3-shape": "3", "d3-time": "3", "d3-time-format": "4", "d3-timer": "3", "d3-transition": "3", "d3-zoom": "3" } }, "sha512-e1U46jVP+w7Iut8Jt8ri1YsPOvFpg46k+K8TpCb0P+zjCkjkPnV7WzfDJzMHy1LnA+wj5pLT1wjO901gLXeEhA=="],
+
+    "d3-array": ["d3-array@3.2.4", "", { "dependencies": { "internmap": "1 - 2" } }, "sha512-tdQAmyA18i4J7wprpYq8ClcxZy3SC31QMeByyCFyRt7BVHdREQZ5lpzoe5mFEYZUWe+oq8HBvk9JjpibyEV4Jg=="],
+
+    "d3-axis": ["d3-axis@3.0.0", "", {}, "sha512-IH5tgjV4jE/GhHkRV0HiVYPDtvfjHQlQfJHs0usq7M30XcSBvOotpmH1IgkcXsO/5gEQZD43B//fc7SRT5S+xw=="],
+
+    "d3-brush": ["d3-brush@3.0.0", "", { "dependencies": { "d3-dispatch": "1 - 3", "d3-drag": "2 - 3", "d3-interpolate": "1 - 3", "d3-selection": "3", "d3-transition": "3" } }, "sha512-ALnjWlVYkXsVIGlOsuWH1+3udkYFI48Ljihfnh8FZPF2QS9o+PzGLBslO0PjzVoHLZ2KCVgAM8NVkXPJB2aNnQ=="],
+
+    "d3-chord": ["d3-chord@3.0.1", "", { "dependencies": { "d3-path": "1 - 3" } }, "sha512-VE5S6TNa+j8msksl7HwjxMHDM2yNK3XCkusIlpX5kwauBfXuyLAtNg9jCp/iHH61tgI4sb6R/EIMWCqEIdjT/g=="],
+
+    "d3-color": ["d3-color@3.1.0", "", {}, "sha512-zg/chbXyeBtMQ1LbD/WSoW2DpC3I0mpmPdW+ynRTj/x2DAWYrIY7qeZIHidozwV24m4iavr15lNwIwLxRmOxhA=="],
+
+    "d3-contour": ["d3-contour@4.0.2", "", { "dependencies": { "d3-array": "^3.2.0" } }, "sha512-4EzFTRIikzs47RGmdxbeUvLWtGedDUNkTcmzoeyg4sP/dvCexO47AaQL7VKy/gul85TOxw+IBgA8US2xwbToNA=="],
+
+    "d3-delaunay": ["d3-delaunay@6.0.4", "", { "dependencies": { "delaunator": "5" } }, "sha512-mdjtIZ1XLAM8bm/hx3WwjfHt6Sggek7qH043O8KEjDXN40xi3vx/6pYSVTwLjEgiXQTbvaouWKynLBiUZ6SK6A=="],
+
+    "d3-dispatch": ["d3-dispatch@3.0.1", "", {}, "sha512-rzUyPU/S7rwUflMyLc1ETDeBj0NRuHKKAcvukozwhshr6g6c5d8zh4c2gQjY2bZ0dXeGLWc1PF174P2tVvKhfg=="],
+
+    "d3-drag": ["d3-drag@3.0.0", "", { "dependencies": { "d3-dispatch": "1 - 3", "d3-selection": "3" } }, "sha512-pWbUJLdETVA8lQNJecMxoXfH6x+mO2UQo8rSmZ+QqxcbyA3hfeprFgIT//HW2nlHChWeIIMwS2Fq+gEARkhTkg=="],
+
+    "d3-dsv": ["d3-dsv@3.0.1", "", { "dependencies": { "commander": "7", "iconv-lite": "0.6", "rw": "1" }, "bin": { "csv2json": "bin/dsv2json.js", "csv2tsv": "bin/dsv2dsv.js", "dsv2dsv": "bin/dsv2dsv.js", "dsv2json": "bin/dsv2json.js", "json2csv": "bin/json2dsv.js", "json2dsv": "bin/json2dsv.js", "json2tsv": "bin/json2dsv.js", "tsv2csv": "bin/dsv2dsv.js", "tsv2json": "bin/dsv2json.js" } }, "sha512-UG6OvdI5afDIFP9w4G0mNq50dSOsXHJaRE8arAS5o9ApWnIElp8GZw1Dun8vP8OyHOZ/QJUKUJwxiiCCnUwm+Q=="],
+
+    "d3-ease": ["d3-ease@3.0.1", "", {}, "sha512-wR/XK3D3XcLIZwpbvQwQ5fK+8Ykds1ip7A2Txe0yxncXSdq1L9skcG7blcedkOX+ZcgxGAmLX1FrRGbADwzi0w=="],
+
+    "d3-fetch": ["d3-fetch@3.0.1", "", { "dependencies": { "d3-dsv": "1 - 3" } }, "sha512-kpkQIM20n3oLVBKGg6oHrUchHM3xODkTzjMoj7aWQFq5QEM+R6E4WkzT5+tojDY7yjez8KgCBRoj4aEr99Fdqw=="],
+
+    "d3-force": ["d3-force@3.0.0", "", { "dependencies": { "d3-dispatch": "1 - 3", "d3-quadtree": "1 - 3", "d3-timer": "1 - 3" } }, "sha512-zxV/SsA+U4yte8051P4ECydjD/S+qeYtnaIyAs9tgHCqfguma/aAQDjo85A9Z6EKhBirHRJHXIgJUlffT4wdLg=="],
+
+    "d3-format": ["d3-format@3.1.2", "", {}, "sha512-AJDdYOdnyRDV5b6ArilzCPPwc1ejkHcoyFarqlPqT7zRYjhavcT3uSrqcMvsgh2CgoPbK3RCwyHaVyxYcP2Arg=="],
+
+    "d3-geo": ["d3-geo@3.1.1", "", { "dependencies": { "d3-array": "2.5.0 - 3" } }, "sha512-637ln3gXKXOwhalDzinUgY83KzNWZRKbYubaG+fGVuc/dxO64RRljtCTnf5ecMyE1RIdtqpkVcq0IbtU2S8j2Q=="],
+
+    "d3-hierarchy": ["d3-hierarchy@3.1.2", "", {}, "sha512-FX/9frcub54beBdugHjDCdikxThEqjnR93Qt7PvQTOHxyiNCAlvMrHhclk3cD5VeAaq9fxmfRp+CnWw9rEMBuA=="],
+
+    "d3-interpolate": ["d3-interpolate@3.0.1", "", { "dependencies": { "d3-color": "1 - 3" } }, "sha512-3bYs1rOD33uo8aqJfKP3JWPAibgw8Zm2+L9vBKEHJ2Rg+viTR7o5Mmv5mZcieN+FRYaAOWX5SJATX6k1PWz72g=="],
+
+    "d3-path": ["d3-path@3.1.0", "", {}, "sha512-p3KP5HCf/bvjBSSKuXid6Zqijx7wIfNW+J/maPs+iwR35at5JCbLUT0LzF1cnjbCHWhqzQTIN2Jpe8pRebIEFQ=="],
+
+    "d3-polygon": ["d3-polygon@3.0.1", "", {}, "sha512-3vbA7vXYwfe1SYhED++fPUQlWSYTTGmFmQiany/gdbiWgU/iEyQzyymwL9SkJjFFuCS4902BSzewVGsHHmHtXg=="],
+
+    "d3-quadtree": ["d3-quadtree@3.0.1", "", {}, "sha512-04xDrxQTDTCFwP5H6hRhsRcb9xxv2RzkcsygFzmkSIOJy3PeRJP7sNk3VRIbKXcog561P9oU0/rVH6vDROAgUw=="],
+
+    "d3-random": ["d3-random@3.0.1", "", {}, "sha512-FXMe9GfxTxqd5D6jFsQ+DJ8BJS4E/fT5mqqdjovykEB2oFbTMDVdg1MGFxfQW+FBOGoB++k8swBrgwSHT1cUXQ=="],
+
+    "d3-sankey": ["d3-sankey@0.12.3", "", { "dependencies": { "d3-array": "1 - 2", "d3-shape": "^1.2.0" } }, "sha512-nQhsBRmM19Ax5xEIPLMY9ZmJ/cDvd1BG3UVvt5h3WRxKg5zGRbvnteTyWAbzeSvlh3tW7ZEmq4VwR5mB3tutmQ=="],
+
+    "d3-scale": ["d3-scale@4.0.2", "", { "dependencies": { "d3-array": "2.10.0 - 3", "d3-format": "1 - 3", "d3-interpolate": "1.2.0 - 3", "d3-time": "2.1.1 - 3", "d3-time-format": "2 - 4" } }, "sha512-GZW464g1SH7ag3Y7hXjf8RoUuAFIqklOAq3MRl4OaWabTFJY9PN/E1YklhXLh+OQ3fM9yS2nOkCoS+WLZ6kvxQ=="],
+
+    "d3-scale-chromatic": ["d3-scale-chromatic@3.1.0", "", { "dependencies": { "d3-color": "1 - 3", "d3-interpolate": "1 - 3" } }, "sha512-A3s5PWiZ9YCXFye1o246KoscMWqf8BsD9eRiJ3He7C9OBaxKhAd5TFCdEx/7VbKtxxTsu//1mMJFrEt572cEyQ=="],
+
+    "d3-selection": ["d3-selection@3.0.0", "", {}, "sha512-fmTRWbNMmsmWq6xJV8D19U/gw/bwrHfNXxrIN+HfZgnzqTHp9jOmKMhsTUjXOJnZOdZY9Q28y4yebKzqDKlxlQ=="],
+
+    "d3-shape": ["d3-shape@3.2.0", "", { "dependencies": { "d3-path": "^3.1.0" } }, "sha512-SaLBuwGm3MOViRq2ABk3eLoxwZELpH6zhl3FbAoJ7Vm1gofKx6El1Ib5z23NUEhF9AsGl7y+dzLe5Cw2AArGTA=="],
+
+    "d3-time": ["d3-time@3.1.0", "", { "dependencies": { "d3-array": "2 - 3" } }, "sha512-VqKjzBLejbSMT4IgbmVgDjpkYrNWUYJnbCGo874u7MMKIWsILRX+OpX/gTk8MqjpT1A/c6HY2dCA77ZN0lkQ2Q=="],
+
+    "d3-time-format": ["d3-time-format@4.1.0", "", { "dependencies": { "d3-time": "1 - 3" } }, "sha512-dJxPBlzC7NugB2PDLwo9Q8JiTR3M3e4/XANkreKSUxF8vvXKqm1Yfq4Q5dl8budlunRVlUUaDUgFt7eA8D6NLg=="],
+
+    "d3-timer": ["d3-timer@3.0.1", "", {}, "sha512-ndfJ/JxxMd3nw31uyKoY2naivF+r29V+Lc0svZxe1JvvIRmi8hUsrMvdOwgS1o6uBHmiz91geQ0ylPP0aj1VUA=="],
+
+    "d3-transition": ["d3-transition@3.0.1", "", { "dependencies": { "d3-color": "1 - 3", "d3-dispatch": "1 - 3", "d3-ease": "1 - 3", "d3-interpolate": "1 - 3", "d3-timer": "1 - 3" }, "peerDependencies": { "d3-selection": "2 - 3" } }, "sha512-ApKvfjsSR6tg06xrL434C0WydLr7JewBB3V+/39RMHsaXTOG0zmt/OAXeng5M5LBm0ojmxJrpomQVZ1aPvBL4w=="],
+
+    "d3-zoom": ["d3-zoom@3.0.0", "", { "dependencies": { "d3-dispatch": "1 - 3", "d3-drag": "2 - 3", "d3-interpolate": "1 - 3", "d3-selection": "2 - 3", "d3-transition": "2 - 3" } }, "sha512-b8AmV3kfQaqWAuacbPuNbL6vahnOJflOhexLzMMNLga62+/nh0JzvJ0aO/5a5MVgUFGS7Hu1P9P03o3fJkDCyw=="],
+
+    "dagre-d3-es": ["dagre-d3-es@7.0.13", "", { "dependencies": { "d3": "^7.9.0", "lodash-es": "^4.17.21" } }, "sha512-efEhnxpSuwpYOKRm/L5KbqoZmNNukHa/Flty4Wp62JRvgH2ojwVgPgdYyr4twpieZnyRDdIH7PY2mopX26+j2Q=="],
+
     "date-fns": ["date-fns@3.6.0", "", {}, "sha512-fRHTG8g/Gif+kSh50gaGEdToemgfj74aRX3swtiouboip5JDLAyDE9F11nHMIcvOaXeOC6D7SpNhi7uFyB7Uww=="],
 
+    "dayjs": ["dayjs@1.11.19", "", {}, "sha512-t5EcLVS6QPBNqM2z8fakk/NKel+Xzshgt8FFKAn+qwlD1pzZWxh0nVCrvFK7ZDb6XucZeF9z8C7CBWTRIVApAw=="],
+
     "debug": ["debug@4.4.3", "", { "dependencies": { "ms": "^2.1.3" } }, "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA=="],
 
     "decode-named-character-reference": ["decode-named-character-reference@1.3.0", "", { "dependencies": { "character-entities": "^2.0.0" } }, "sha512-GtpQYB283KrPp6nRw50q3U9/VfOutZOe103qlN7BPP6Ad27xYnOIWv4lPzo8HCAL+mMZofJ9KEy30fq6MfaK6Q=="],
@@ -940,6 +1109,8 @@
 
     "define-properties": ["define-properties@1.2.1", "", { "dependencies": { "define-data-property": "^1.0.1", "has-property-descriptors": "^1.0.0", "object-keys": "^1.1.1" } }, "sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg=="],
 
+    "delaunator": ["delaunator@5.0.1", "", { "dependencies": { "robust-predicates": "^3.0.2" } }, "sha512-8nvh+XBe96aCESrGOqMp/84b13H9cdKbG5P2ejQCh4d4sK9RL4371qou9drQjMhvnPmhWl5hnmqbEE0fXr9Xnw=="],
+
     "delayed-stream": ["delayed-stream@1.0.0", "", {}, "sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ=="],
 
     "delegates": ["delegates@1.0.0", "", {}, "sha512-bd2L678uiWATM6m5Z1VzNCErI3jiGzt6HGY8OVICs40JQq/HALfbyNJmp0UDakEY4pMMaN0Ly5om/B1VI/+xfQ=="],
@@ -1154,6 +1325,8 @@
 
     "gray-matter": ["gray-matter@4.0.3", "", { "dependencies": { "js-yaml": "^3.13.1", "kind-of": "^6.0.2", "section-matter": "^1.0.0", "strip-bom-string": "^1.0.0" } }, "sha512-5v6yZd4JK3eMI3FqqCouswVqwugaA9r4dNZB1wwcmrD02QkV5H0y7XBQW8QwQqEaZY1pM9aqORSORhJRdNK44Q=="],
 
+    "hachure-fill": ["hachure-fill@0.5.2", "", {}, "sha512-3GKBOn+m2LX9iq+JC1064cSFprJY4jL1jCXTcpnfER5HYE2l/4EfWSGzkPa/ZDBmYI0ZOEj5VHV/eKnPGkHuOg=="],
+
     "has-flag": ["has-flag@4.0.0", "", {}, "sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ=="],
 
     "has-property-descriptors": ["has-property-descriptors@1.0.2", "", { "dependencies": { "es-define-property": "^1.0.0" } }, "sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg=="],
@@ -1230,6 +1403,8 @@
 
     "inline-style-parser": ["inline-style-parser@0.2.7", "", {}, "sha512-Nb2ctOyNR8DqQoR0OwRG95uNWIC0C1lCgf5Naz5H6Ji72KZ8OcFZLz2P5sNgwlyoJ8Yif11oMuYs5pBQa86csA=="],
 
+    "internmap": ["internmap@2.0.3", "", {}, "sha512-5Hh7Y1wQbvY5ooGgPbDaL5iYLAPzMTUrjMulskHLH6wnv/A+1q5rgEaiuqEjB+oxGXIVZs1FF+R/KPN3ZSQYYg=="],
+
     "ip-address": ["ip-address@10.1.0", "", {}, "sha512-XXADHxXmvT9+CRxhXg56LJovE+bmWnEWB78LB83VZTprKTmaC5QfruXocxzTZ2Kl0DNwKuBdlIhjL8LeY8Sf8Q=="],
 
     "ipaddr.js": ["ipaddr.js@1.9.1", "", {}, "sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g=="],
@@ -1306,10 +1481,18 @@
 
     "jsonfile": ["jsonfile@6.2.0", "", { "dependencies": { "universalify": "^2.0.0" }, "optionalDependencies": { "graceful-fs": "^4.1.6" } }, "sha512-FGuPw30AdOIUTRMC2OMRtQV+jkVj2cfPqSeWXv1NEAJ1qZ5zb1X6z1mFhbfOB/iy3ssJCD+3KuZ8r8C3uVFlAg=="],
 
+    "katex": ["katex@0.16.27", "", { "dependencies": { "commander": "^8.3.0" }, "bin": { "katex": "cli.js" } }, "sha512-aeQoDkuRWSqQN6nSvVCEFvfXdqo1OQiCmmW1kc9xSdjutPv7BGO7pqY9sQRJpMOGrEdfDgF2TfRXe5eUAD2Waw=="],
+
     "keyv": ["keyv@4.5.4", "", { "dependencies": { "json-buffer": "3.0.1" } }, "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw=="],
 
+    "khroma": ["khroma@2.1.0", "", {}, "sha512-Ls993zuzfayK269Svk9hzpeGUKob/sIgZzyHYdjQoAdQetRKpOLj+k/QQQ/6Qi0Yz65mlROrfd+Ev+1+7dz9Kw=="],
+
     "kind-of": ["kind-of@6.0.3", "", {}, "sha512-dcS1ul+9tmeD95T+x28/ehLgd9mENa3LsvDTtzm3vyBEO7RPptvAD+t44WVXaUjTBRcrpFeFlC8WCruUR456hw=="],
 
+    "langium": ["langium@3.3.1", "", { "dependencies": { "chevrotain": "~11.0.3", "chevrotain-allstar": "~0.3.0", "vscode-languageserver": "~9.0.1", "vscode-languageserver-textdocument": "~1.0.11", "vscode-uri": "~3.0.8" } }, "sha512-QJv/h939gDpvT+9SiLVlY7tZC3xB2qK57v0J04Sh9wpMb6MP1q8gB21L3WIo8T5P1MSMg3Ep14L7KkDCFG3y4w=="],
+
+    "layout-base": ["layout-base@1.0.2", "", {}, "sha512-8h2oVEZNktL4BH2JCOI90iD1yXwL6iNW7KcCKT2QZgQJR2vbqDsldCTPRU9NifTCqHZci57XvQQ15YTu+sTYPg=="],
+
     "lazy-val": ["lazy-val@1.0.5", "", {}, "sha512-0/BnGCCfyUMkBpeDgWihanIAF9JmZhHBgUhEqzvf+adhNGLoP6TaiI5oF8oyb3I45P+PcnrqihSf01M0l0G5+Q=="],
 
     "lazystream": ["lazystream@1.0.1", "", { "dependencies": { "readable-stream": "^2.0.5" } }, "sha512-b94GiNHQNy6JNTrt5w6zNyffMrNkXZb3KTkCZJb2V1xaEGCk093vkZ2jk3tpaeP33/OiXC+WvK9AxUebnf5nbw=="],
@@ -1320,6 +1503,8 @@
 
     "lodash": ["lodash@4.17.23", "", {}, "sha512-LgVTMpQtIopCi79SJeDiP0TfWi5CNEc/L/aRdTh3yIvmZXTnheWpKjSZhnvMl8iXbC1tFg9gdHHDMLoV7CnG+w=="],
 
+    "lodash-es": ["lodash-es@4.17.23", "", {}, "sha512-kVI48u3PZr38HdYz98UmfPnXl2DXrpdctLrFLCd3kOx1xUkOmpFPx7gCWWM5MPkL/fD8zb+Ph0QzjGFs4+hHWg=="],
+
     "lodash.defaults": ["lodash.defaults@4.2.0", "", {}, "sha512-qjxPLHd3r5DnsdGacqOMU6pb/avJzdh9tFX2ymgoZE27BmjXrNy/y4LoaiTeAb+O3gL8AfpJGtqfX/ae2leYYQ=="],
 
     "lodash.difference": ["lodash.difference@4.5.0", "", {}, "sha512-dS2j+W26TQ7taQBGN8Lbbq04ssV3emRw4NY58WErlTO29pIqS0HmoT5aJ9+TUQ1N3G+JOZSji4eugsWwGp9yPA=="],
@@ -1356,7 +1541,7 @@
 
     "markdown-table": ["markdown-table@3.0.4", "", {}, "sha512-wiYz4+JrLyb/DqW2hkFJxP7Vd7JuTDm77fvbM8VfEQdmSMqcImWeeRbHwZjBjIFki/VaMK2BhFi7oUUZeM5bqw=="],
 
-    "marked": ["marked@17.0.1", "", { "bin": { "marked": "bin/marked.js" } }, "sha512-boeBdiS0ghpWcSwoNm/jJBwdpFaMnZWRzjA6SkUMYb40SVaN1x7mmfGKp0jvexGcx+7y2La5zRZsYFZI6Qpypg=="],
+    "marked": ["marked@16.4.2", "", { "bin": { "marked": "bin/marked.js" } }, "sha512-TI3V8YYWvkVf3KJe1dRkpnjs68JUPyEa5vjKrp1XEEJUAOaQc+Qj+L1qWbPd0SJuAdQkFU0h73sXXqwDYxsiDA=="],
 
     "matcher": ["matcher@3.0.0", "", { "dependencies": { "escape-string-regexp": "^4.0.0" } }, "sha512-OkeDaAZ/bQCxeFAozM55PKcKU0yJMPGifLwV4Qgjitu+5MoAfSQN4lsLJeXZ1b8w0x+/Emda6MZgXS1jvsapng=="],
 
@@ -1400,6 +1585,8 @@
 
     "merge2": ["merge2@1.4.1", "", {}, "sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg=="],
 
+    "mermaid": ["mermaid@11.12.2", "", { "dependencies": { "@braintree/sanitize-url": "^7.1.1", "@iconify/utils": "^3.0.1", "@mermaid-js/parser": "^0.6.3", "@types/d3": "^7.4.3", "cytoscape": "^3.29.3", "cytoscape-cose-bilkent": "^4.1.0", "cytoscape-fcose": "^2.2.0", "d3": "^7.9.0", "d3-sankey": "^0.12.3", "dagre-d3-es": "7.0.13", "dayjs": "^1.11.18", "dompurify": "^3.2.5", "katex": "^0.16.22", "khroma": "^2.1.0", "lodash-es": "^4.17.21", "marked": "^16.2.1", "roughjs": "^4.6.6", "stylis": "^4.3.6", "ts-dedent": "^2.2.0", "uuid": "^11.1.0" } }, "sha512-n34QPDPEKmaeCG4WDMGy0OT6PSyxKCfy2pJgShP+Qow2KLrvWjclwbc3yXfSIf4BanqWEhQEpngWwNp/XhZt6w=="],
+
     "micromark": ["micromark@4.0.2", "", { "dependencies": { "@types/debug": "^4.0.0", "debug": "^4.0.0", "decode-named-character-reference": "^1.0.0", "devlop": "^1.0.0", "micromark-core-commonmark": "^2.0.0", "micromark-factory-space": "^2.0.0", "micromark-util-character": "^2.0.0", "micromark-util-chunked": "^2.0.0", "micromark-util-combine-extensions": "^2.0.0", "micromark-util-decode-numeric-character-reference": "^2.0.0", "micromark-util-encode": "^2.0.0", "micromark-util-normalize-identifier": "^2.0.0", "micromark-util-resolve-all": "^2.0.0", "micromark-util-sanitize-uri": "^2.0.0", "micromark-util-subtokenize": "^2.0.0", "micromark-util-symbol": "^2.0.0", "micromark-util-types": "^2.0.0" } }, "sha512-zpe98Q6kvavpCr1NPVSCMebCKfD7CA2NqZ+rykeNhONIJBpc1tFKt9hucLGwha3jNTNI8lHpctWJWoimVF4PfA=="],
 
     "micromark-core-commonmark": ["micromark-core-commonmark@2.0.3", "", { "dependencies": { "decode-named-character-reference": "^1.0.0", "devlop": "^1.0.0", "micromark-factory-destination": "^2.0.0", "micromark-factory-label": "^2.0.0", "micromark-factory-space": "^2.0.0", "micromark-factory-title": "^2.0.0", "micromark-factory-whitespace": "^2.0.0", "micromark-util-character": "^2.0.0", "micromark-util-chunked": "^2.0.0", "micromark-util-classify-character": "^2.0.0", "micromark-util-html-tag-name": "^2.0.0", "micromark-util-normalize-identifier": "^2.0.0", "micromark-util-resolve-all": "^2.0.0", "micromark-util-subtokenize": "^2.0.0", "micromark-util-symbol": "^2.0.0", "micromark-util-types": "^2.0.0" } }, "sha512-RDBrHEMSxVFLg6xvnXmb1Ayr2WzLAWjeSATAoxwKYJV94TeNavgoIdA0a9ytzDSVzBy2YKFK+emCPOEibLeCrg=="],
@@ -1490,6 +1677,8 @@
 
     "mkdirp-classic": ["mkdirp-classic@0.5.3", "", {}, "sha512-gKLcREMhtuZRwRAfqP3RFW+TK4JqApVBtOIftVgjuABpAtpxhPGaDcfvbhNvD0B8iD1oUr/txX35NjcaY6Ns/A=="],
 
+    "mlly": ["mlly@1.8.0", "", { "dependencies": { "acorn": "^8.15.0", "pathe": "^2.0.3", "pkg-types": "^1.3.1", "ufo": "^1.6.1" } }, "sha512-l8D9ODSRWLe2KHJSifWGwBqpTZXIXTeo8mlKjY+E2HAakaTeNpqAyBZ8GSqLzHgw4XmHmC8whvpjJNMbFZN7/g=="],
+
     "module-details-from-path": ["module-details-from-path@1.0.4", "", {}, "sha512-EGWKgxALGMgzvxYF1UyGTy0HXX/2vHLkw6+NvDKW2jypWbHpjQuj4UMcqQWXHERJhVGKikolT06G3bcKe4fi7w=="],
 
     "motion": ["motion@11.18.2", "", { "dependencies": { "framer-motion": "^11.18.2", "tslib": "^2.4.0" }, "peerDependencies": { "@emotion/is-prop-valid": "*", "react": "^18.0.0 || ^19.0.0", "react-dom": "^18.0.0 || ^19.0.0" }, "optionalPeers": ["@emotion/is-prop-valid", "react", "react-dom"] }, "sha512-JLjvFDuFr42NFtcVoMAyC2sEjnpA8xpy6qWPyzQvCloznAyQ8FIXioxWfHiLtgYhoVpfUqSWpn1h9++skj9+Wg=="],
@@ -1560,12 +1749,16 @@
 
     "package-json-from-dist": ["package-json-from-dist@1.0.1", "", {}, "sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw=="],
 
+    "package-manager-detector": ["package-manager-detector@1.6.0", "", {}, "sha512-61A5ThoTiDG/C8s8UMZwSorAGwMJ0ERVGj2OjoW5pAalsNOg15+iQiPzrLJ4jhZ1HJzmC2PIHT2oEiH3R5fzNA=="],
+
     "parse-entities": ["parse-entities@4.0.2", "", { "dependencies": { "@types/unist": "^2.0.0", "character-entities-legacy": "^3.0.0", "character-reference-invalid": "^2.0.0", "decode-named-character-reference": "^1.0.0", "is-alphanumerical": "^2.0.0", "is-decimal": "^2.0.0", "is-hexadecimal": "^2.0.0" } }, "sha512-GG2AQYWoLgL877gQIKeRPGO1xF9+eG1ujIb5soS5gPvLQ1y2o8FL90w2QWNdf9I361Mpp7726c+lj3U0qK1uGw=="],
 
     "parse5": ["parse5@7.3.0", "", { "dependencies": { "entities": "^6.0.0" } }, "sha512-IInvU7fabl34qmi9gY8XOVxhYyMyuH2xUNpb2q8/Y+7552KlejkRvqvD19nMoUW/uQGGbqNpA6Tufu5FL5BZgw=="],
 
     "parseurl": ["parseurl@1.3.3", "", {}, "sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ=="],
 
+    "path-data-parser": ["path-data-parser@0.1.0", "", {}, "sha512-NOnmBpt5Y2RWbuv0LMzsayp3lVylAHLPUTut412ZA3l+C4uw4ZVkQbjShYCQ8TCpUMdPapr4YjUqLYD6v68j+w=="],
+
     "path-is-absolute": ["path-is-absolute@1.0.1", "", {}, "sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg=="],
 
     "path-key": ["path-key@3.1.1", "", {}, "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q=="],
@@ -1576,6 +1769,8 @@
 
     "path-to-regexp": ["path-to-regexp@8.3.0", "", {}, "sha512-7jdwVIRtsP8MYpdXSwOS0YdD0Du+qOoF/AEPIt88PcCFrZCzx41oxku1jD88hZBwbNUIEfpqvuhjFaMAqMTWnA=="],
 
+    "pathe": ["pathe@2.0.3", "", {}, "sha512-WUjGcAqP1gQacoQe+OBJsFA7Ld4DyXuUIjZ5cc75cLHvJ7dtNsTugphxIADwspS+AraAUePCKrSVtPLFj/F88w=="],
+
     "pe-library": ["pe-library@0.4.1", "", {}, "sha512-eRWB5LBz7PpDu4PUlwT0PhnQfTQJlDDdPa35urV4Osrm0t0AqQFGn+UIkU3klZvwJ8KPO3VbBFsXquA6p6kqZw=="],
 
     "pend": ["pend@1.2.0", "", {}, "sha512-F3asv42UuXchdzt+xXqfW1OGlVBe+mxa2mqI0pg5yAHZPvFmY3Y6drSf/GQ1A86WgWEN9Kzh/WrgKa6iGcHXLg=="],
@@ -1598,8 +1793,14 @@
 
     "pkce-challenge": ["pkce-challenge@5.0.1", "", {}, "sha512-wQ0b/W4Fr01qtpHlqSqspcj3EhBvimsdh0KlHhH8HRZnMsEa0ea2fTULOXOS9ccQr3om+GcGRk4e+isrZWV8qQ=="],
 
+    "pkg-types": ["pkg-types@1.3.1", "", { "dependencies": { "confbox": "^0.1.8", "mlly": "^1.7.4", "pathe": "^2.0.1" } }, "sha512-/Jm5M4RvtBFVkKWRu2BLUTNP8/M2a+UwuAX+ae4770q1qVGtfjG+WTCupoZixokjmHiry8uI+dlY8KXYV5HVVQ=="],
+
     "plist": ["plist@3.1.0", "", { "dependencies": { "@xmldom/xmldom": "^0.8.8", "base64-js": "^1.5.1", "xmlbuilder": "^15.1.1" } }, "sha512-uysumyrvkUX0rX/dEVqt8gC3sTBzd4zoWfLeS29nb53imdaXVvLINYXTI2GNqzaMuvacNx4uJQ8+b3zXR0pkgQ=="],
 
+    "points-on-curve": ["points-on-curve@0.2.0", "", {}, "sha512-0mYKnYYe9ZcqMCWhUjItv/oHjvgEsfKvnUTg8sAtnHr3GVy7rGkXCb6d5cSyqrWqL4k81b9CPg3urd+T7aop3A=="],
+
+    "points-on-path": ["points-on-path@0.2.1", "", { "dependencies": { "path-data-parser": "0.1.0", "points-on-curve": "0.2.0" } }, "sha512-25ClnWWuw7JbWZcgqY/gJ4FQWadKxGWk+3kR/7kD0tCaDtPPMj7oHu2ToLaVhfpnHrZzYby2w6tUA0eOIuUg8g=="],
+
     "postcss": ["postcss@8.5.6", "", { "dependencies": { "nanoid": "^3.3.11", "picocolors": "^1.1.1", "source-map-js": "^1.2.1" } }, "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg=="],
 
     "postcss-import": ["postcss-import@15.1.0", "", { "dependencies": { "postcss-value-parser": "^4.0.0", "read-cache": "^1.0.0", "resolve": "^1.1.7" }, "peerDependencies": { "postcss": "^8.0.0" } }, "sha512-hpr+J05B2FVYUAXHeK1YyI267J/dDDhMU6B6civm8hSY1jYJnBXxzKDKDswzJmtLHryrjhnDjqqp/49t8FALew=="],
@@ -1682,6 +1883,8 @@
 
     "react-syntax-highlighter": ["react-syntax-highlighter@16.1.0", "", { "dependencies": { "@babel/runtime": "^7.28.4", "highlight.js": "^10.4.1", "highlightjs-vue": "^1.0.0", "lowlight": "^1.17.0", "prismjs": "^1.30.0", "refractor": "^5.0.0" }, "peerDependencies": { "react": ">= 0.14.0" } }, "sha512-E40/hBiP5rCNwkeBN1vRP+xow1X0pndinO+z3h7HLsHyjztbyjfzNWNKuAsJj+7DLam9iT4AaaOZnueCU+Nplg=="],
 
+    "react-zoom-pan-pinch": ["react-zoom-pan-pinch@3.7.0", "", { "peerDependencies": { "react": "*", "react-dom": "*" } }, "sha512-UmReVZ0TxlKzxSbYiAj+LeGRW8s8LraAFTXRAxzMYnNRgGPsxCudwZKVkjvGmjtx7SW/hZamt69NUmGf4xrkXA=="],
+
     "reactivity-store": ["reactivity-store@0.3.12", "", { "dependencies": { "@vue/reactivity": "~3.5.22", "@vue/shared": "~3.5.22", "use-sync-external-store": "^1.6.0" }, "peerDependencies": { "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0" } }, "sha512-Idz9EL4dFUtQbHySZQzckWOTUfqjdYpUtNW0iOysC32mG7IjiUGB77QrsyR5eAWBkRiS9JscF6A3fuQAIy+LrQ=="],
 
     "read-binary-file-arch": ["read-binary-file-arch@1.0.6", "", { "dependencies": { "debug": "^4.3.4" }, "bin": { "read-binary-file-arch": "cli.js" } }, "sha512-BNg9EN3DD3GsDXX7Aa8O4p92sryjkmzYYgmgTAc6CA4uGLEDzFfxOxugu21akOxpcXHiEgsYkC6nPsQvLLLmEg=="],
@@ -1746,12 +1949,18 @@
 
     "roarr": ["roarr@2.15.4", "", { "dependencies": { "boolean": "^3.0.1", "detect-node": "^2.0.4", "globalthis": "^1.0.1", "json-stringify-safe": "^5.0.1", "semver-compare": "^1.0.0", "sprintf-js": "^1.1.2" } }, "sha512-CHhPh+UNHD2GTXNYhPWLnU8ONHdI+5DI+4EYIAOaiD63rHeYlZvyh8P+in5999TTSFgUYuKUAjzRI4mdh/p+2A=="],
 
+    "robust-predicates": ["robust-predicates@3.0.2", "", {}, "sha512-IXgzBWvWQwE6PrDI05OvmXUIruQTcoMDzRsOd5CDvHCVLcLHMTSYvOK5Cm46kWqlV3yAbuSpBZdJ5oP5OUoStg=="],
+
     "rollup": ["rollup@4.56.0", "", { "dependencies": { "@types/estree": "1.0.8" }, "optionalDependencies": { "@rollup/rollup-android-arm-eabi": "4.56.0", "@rollup/rollup-android-arm64": "4.56.0", "@rollup/rollup-darwin-arm64": "4.56.0", "@rollup/rollup-darwin-x64": "4.56.0", "@rollup/rollup-freebsd-arm64": "4.56.0", "@rollup/rollup-freebsd-x64": "4.56.0", "@rollup/rollup-linux-arm-gnueabihf": "4.56.0", "@rollup/rollup-linux-arm-musleabihf": "4.56.0", "@rollup/rollup-linux-arm64-gnu": "4.56.0", "@rollup/rollup-linux-arm64-musl": "4.56.0", "@rollup/rollup-linux-loong64-gnu": "4.56.0", "@rollup/rollup-linux-loong64-musl": "4.56.0", "@rollup/rollup-linux-ppc64-gnu": "4.56.0", "@rollup/rollup-linux-ppc64-musl": "4.56.0", "@rollup/rollup-linux-riscv64-gnu": "4.56.0", "@rollup/rollup-linux-riscv64-musl": "4.56.0", "@rollup/rollup-linux-s390x-gnu": "4.56.0", "@rollup/rollup-linux-x64-gnu": "4.56.0", "@rollup/rollup-linux-x64-musl": "4.56.0", "@rollup/rollup-openbsd-x64": "4.56.0", "@rollup/rollup-openharmony-arm64": "4.56.0", "@rollup/rollup-win32-arm64-msvc": "4.56.0", "@rollup/rollup-win32-ia32-msvc": "4.56.0", "@rollup/rollup-win32-x64-gnu": "4.56.0", "@rollup/rollup-win32-x64-msvc": "4.56.0", "fsevents": "~2.3.2" }, "bin": { "rollup": "dist/bin/rollup" } }, "sha512-9FwVqlgUHzbXtDg9RCMgodF3Ua4Na6Gau+Sdt9vyCN4RhHfVKX2DCHy3BjMLTDd47ITDhYAnTwGulWTblJSDLg=="],
 
+    "roughjs": ["roughjs@4.6.6", "", { "dependencies": { "hachure-fill": "^0.5.2", "path-data-parser": "^0.1.0", "points-on-curve": "^0.2.0", "points-on-path": "^0.2.1" } }, "sha512-ZUz/69+SYpFN/g/lUlo2FXcIjRkSu3nDarreVdGGndHEBJ6cXPdKguS8JGxwj5HA5xIbVKSmLgr5b3AWxtRfvQ=="],
+
     "router": ["router@2.2.0", "", { "dependencies": { "debug": "^4.4.0", "depd": "^2.0.0", "is-promise": "^4.0.0", "parseurl": "^1.3.3", "path-to-regexp": "^8.0.0" } }, "sha512-nLTrUKm2UyiL7rlhapu/Zl45FwNgkZGaCpZbIHajDYgwlJCOzLSk+cIPAnsEqV955GjILJnKbdQC1nVPz+gAYQ=="],
 
     "run-parallel": ["run-parallel@1.2.0", "", { "dependencies": { "queue-microtask": "^1.2.2" } }, "sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA=="],
 
+    "rw": ["rw@1.3.3", "", {}, "sha512-PdhdWy89SiZogBLaw42zdeqtRJ//zFd2PgQavcICDUgJT5oW10QCRKbJ6bg4r0/UY2M6BWd5tkxuGFRvCkgfHQ=="],
+
     "safe-buffer": ["safe-buffer@5.2.1", "", {}, "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ=="],
 
     "safer-buffer": ["safer-buffer@2.1.2", "", {}, "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg=="],
@@ -1850,6 +2059,8 @@
 
     "style-to-object": ["style-to-object@1.0.14", "", { "dependencies": { "inline-style-parser": "0.2.7" } }, "sha512-LIN7rULI0jBscWQYaSswptyderlarFkjQ+t79nzty8tcIAceVomEVlLzH5VP4Cmsv6MtKhs7qaAiwlcp+Mgaxw=="],
 
+    "stylis": ["stylis@4.3.6", "", {}, "sha512-yQ3rwFWRfwNUY7H5vpU0wfdkNSnvnJinhF9830Swlaxl03zsOjCfmX0ugac+3LtK0lYSgwL/KXc8oYL3mG4YFQ=="],
+
     "sucrase": ["sucrase@3.35.1", "", { "dependencies": { "@jridgewell/gen-mapping": "^0.3.2", "commander": "^4.0.0", "lines-and-columns": "^1.1.6", "mz": "^2.7.0", "pirates": "^4.0.1", "tinyglobby": "^0.2.11", "ts-interface-checker": "^0.1.9" }, "bin": { "sucrase": "bin/sucrase", "sucrase-node": "bin/sucrase-node" } }, "sha512-DhuTmvZWux4H1UOnWMB3sk0sbaCVOoQZjv8u1rDoTV0HTdGem9hkAZtl4JZy8P2z4Bg0nT+YMeOFyVr4zcG5Tw=="],
 
     "sumchecker": ["sumchecker@3.0.1", "", { "dependencies": { "debug": "^4.1.0" } }, "sha512-MvjXzkz/BOfyVDkG0oFOtBxHX2u3gKbMHIF/dXblZsgD3BWOFLmHovIpZY7BykJdAjcqRCBi1WYBNdEC9yI7vg=="],
@@ -1884,6 +2095,8 @@
 
     "tiny-typed-emitter": ["tiny-typed-emitter@2.1.0", "", {}, "sha512-qVtvMxeXbVej0cQWKqVSSAHmKZEHAvxdF8HEUBFWts8h+xEo5m/lEiPakuyZ3BnCBjOD8i24kzNOiOLLgsSxhA=="],
 
+    "tinyexec": ["tinyexec@1.0.2", "", {}, "sha512-W/KYk+NFhkmsYpuHq5JykngiOCnxeVL8v8dFnqxSD8qEEdRfXk1SDM6JzNqcERbcGYj9tMrDQBYV9cjgnunFIg=="],
+
     "tinyglobby": ["tinyglobby@0.2.15", "", { "dependencies": { "fdir": "^6.5.0", "picomatch": "^4.0.3" } }, "sha512-j2Zq4NyQYG5XMST4cbs02Ak8iJUdxRM0XI5QyxXuZOzKOINmWurp3smXu3y5wDcJrptwpSjgXHzIQxR0omXljQ=="],
 
     "tmp": ["tmp@0.2.5", "", {}, "sha512-voyz6MApa1rQGUxT3E+BK7/ROe8itEx7vD8/HEvt4xwXucvQ5G5oeEiHkmHZJuBO21RpOf+YYm9MOivj709jow=="],
@@ -1902,6 +2115,8 @@
 
     "truncate-utf8-bytes": ["truncate-utf8-bytes@1.0.2", "", { "dependencies": { "utf8-byte-length": "^1.0.1" } }, "sha512-95Pu1QXQvruGEhv62XCMO3Mm90GscOCClvrIUwCM0PYOXK3kaF3l3sIHxx71ThJfcbM2O5Au6SO3AWCSEfW4mQ=="],
 
+    "ts-dedent": ["ts-dedent@2.2.0", "", {}, "sha512-q5W7tVM71e2xjHZTlgfTDoPF/SmqKG5hddq9SzR49CH2hayqRKJtQ4mtRlSxKaJlR/+9rEM+mnBHf7I2/BQcpQ=="],
+
     "ts-interface-checker": ["ts-interface-checker@0.1.13", "", {}, "sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA=="],
 
     "tslib": ["tslib@2.8.1", "", {}, "sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w=="],
@@ -1914,6 +2129,8 @@
 
     "typescript": ["typescript@5.9.3", "", { "bin": { "tsc": "bin/tsc", "tsserver": "bin/tsserver" } }, "sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw=="],
 
+    "ufo": ["ufo@1.6.3", "", {}, "sha512-yDJTmhydvl5lJzBmy/hyOAA0d+aqCBuwl818haVdYCRrWV84o7YyeVm4QlVHStqNrrJSTb6jKuFAVqAFsr+K3Q=="],
+
     "undici-types": ["undici-types@6.21.0", "", {}, "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ=="],
 
     "unified": ["unified@11.0.5", "", { "dependencies": { "@types/unist": "^3.0.0", "bail": "^2.0.0", "devlop": "^1.0.0", "extend": "^3.0.0", "is-plain-obj": "^4.0.0", "trough": "^2.0.0", "vfile": "^6.0.0" } }, "sha512-xKvGhPWw3k84Qjh8bI3ZeJjqnyadK+GEFtazSfZv/rKeTkTjOJho6mFqh2SM96iIcZokxiOpg78GazTSg8+KHA=="],
@@ -1952,6 +2169,8 @@
 
     "util-deprecate": ["util-deprecate@1.0.2", "", {}, "sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw=="],
 
+    "uuid": ["uuid@11.1.0", "", { "bin": { "uuid": "dist/esm/bin/uuid" } }, "sha512-0/A9rDy9P7cJ+8w1c9WD9V//9Wj15Ce2MPz8Ri6032usz+NfePxx5AcN3bN+r6ZL6jEo066/yNYB3tn4pQEx+A=="],
+
     "vary": ["vary@1.1.2", "", {}, "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg=="],
 
     "verror": ["verror@1.10.1", "", { "dependencies": { "assert-plus": "^1.0.0", "core-util-is": "1.0.2", "extsprintf": "^1.2.0" } }, "sha512-veufcmxri4e3XSrT0xwfUR7kguIkaxBeosDg00yDWhk49wdwkSUrvvsm7nc75e1PUyvIeZj6nS8VQRYz2/S4Xg=="],
@@ -1964,6 +2183,18 @@
 
     "vite": ["vite@6.4.1", "", { "dependencies": { "esbuild": "^0.25.0", "fdir": "^6.4.4", "picomatch": "^4.0.2", "postcss": "^8.5.3", "rollup": "^4.34.9", "tinyglobby": "^0.2.13" }, "optionalDependencies": { "fsevents": "~2.3.3" }, "peerDependencies": { "@types/node": "^18.0.0 || ^20.0.0 || >=22.0.0", "jiti": ">=1.21.0", "less": "*", "lightningcss": "^1.21.0", "sass": "*", "sass-embedded": "*", "stylus": "*", "sugarss": "*", "terser": "^5.16.0", "tsx": "^4.8.1", "yaml": "^2.4.2" }, "optionalPeers": ["@types/node", "jiti", "less", "lightningcss", "sass", "sass-embedded", "stylus", "sugarss", "terser", "tsx", "yaml"], "bin": { "vite": "bin/vite.js" } }, "sha512-+Oxm7q9hDoLMyJOYfUYBuHQo+dkAloi33apOPP56pzj+vsdJDzr+j1NISE5pyaAuKL4A3UD34qd0lx5+kfKp2g=="],
 
+    "vscode-jsonrpc": ["vscode-jsonrpc@8.2.0", "", {}, "sha512-C+r0eKJUIfiDIfwJhria30+TYWPtuHJXHtI7J0YlOmKAo7ogxP20T0zxB7HZQIFhIyvoBPwWskjxrvAtfjyZfA=="],
+
+    "vscode-languageserver": ["vscode-languageserver@9.0.1", "", { "dependencies": { "vscode-languageserver-protocol": "3.17.5" }, "bin": { "installServerIntoExtension": "bin/installServerIntoExtension" } }, "sha512-woByF3PDpkHFUreUa7Hos7+pUWdeWMXRd26+ZX2A8cFx6v/JPTtd4/uN0/jB6XQHYaOlHbio03NTHCqrgG5n7g=="],
+
+    "vscode-languageserver-protocol": ["vscode-languageserver-protocol@3.17.5", "", { "dependencies": { "vscode-jsonrpc": "8.2.0", "vscode-languageserver-types": "3.17.5" } }, "sha512-mb1bvRJN8SVznADSGWM9u/b07H7Ecg0I3OgXDuLdn307rl/J3A9YD6/eYOssqhecL27hK1IPZAsaqh00i/Jljg=="],
+
+    "vscode-languageserver-textdocument": ["vscode-languageserver-textdocument@1.0.12", "", {}, "sha512-cxWNPesCnQCcMPeenjKKsOCKQZ/L6Tv19DTRIGuLWe32lyzWhihGVJ/rcckZXJxfdKCFvRLS3fpBIsV/ZGX4zA=="],
+
+    "vscode-languageserver-types": ["vscode-languageserver-types@3.17.5", "", {}, "sha512-Ld1VelNuX9pdF39h2Hgaeb5hEZM2Z3jUrrMgWQAu82jMtZp7p3vJT3BzToKtZI7NgQssZje5o0zryOrhQvzQAg=="],
+
+    "vscode-uri": ["vscode-uri@3.0.8", "", {}, "sha512-AyFQ0EVmsOZOlAnxoFOGOq1SQDWAB7C6aqMGS23svWAllfOaxbuFvcT8D1i8z3Gyn8fraVeZNNmN6e9bxxXkKw=="],
+
     "wcwidth": ["wcwidth@1.0.1", "", { "dependencies": { "defaults": "^1.0.3" } }, "sha512-XHPEwS0q6TaxcvG85+8EYkbiCux2XtWG2mkc47Ng2A77BQu9+DqIOJldST4HgPkuea7dvKSj5VgX3P1d4rW8Tg=="],
 
     "web-namespaces": ["web-namespaces@2.0.1", "", {}, "sha512-bKr1DkiNa2krS7qxNtdrtHAmzuYGFQLiQ13TsorsdT6ULTkPLKuu5+GsFpDlg6JFjUTwX2DyhMPG2be8uPrqsQ=="],
@@ -2012,6 +2243,10 @@
 
     "@babel/helper-compilation-targets/semver": ["semver@6.3.1", "", { "bin": { "semver": "bin/semver.js" } }, "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA=="],
 
+    "@chevrotain/cst-dts-gen/lodash-es": ["lodash-es@4.17.21", "", {}, "sha512-mKnC+QJ9pWVzv+C4/U3rRsHapFfHvQFoFB92e52xeyGMcX6/OlIl78je1u8vePzYZSkkogMPJ2yjxxsb89cxyw=="],
+
+    "@chevrotain/gast/lodash-es": ["lodash-es@4.17.21", "", {}, "sha512-mKnC+QJ9pWVzv+C4/U3rRsHapFfHvQFoFB92e52xeyGMcX6/OlIl78je1u8vePzYZSkkogMPJ2yjxxsb89cxyw=="],
+
     "@develar/schema-utils/ajv": ["ajv@6.12.6", "", { "dependencies": { "fast-deep-equal": "^3.1.1", "fast-json-stable-stringify": "^2.0.0", "json-schema-traverse": "^0.4.1", "uri-js": "^4.2.2" } }, "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g=="],
 
     "@electron/asar/commander": ["commander@5.1.0", "", {}, "sha512-P0CysNDQ7rtVw4QIQtm+MRxV66vKFSvlsQvGYXZWR3qFU0jlMKHZZZgw8e+8DSah4UDKMqnknRDQz+xuQXQ/Zg=="],
@@ -2106,10 +2341,20 @@
 
     "cacache/minipass": ["minipass@3.3.6", "", { "dependencies": { "yallist": "^4.0.0" } }, "sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw=="],
 
+    "chevrotain/lodash-es": ["lodash-es@4.17.21", "", {}, "sha512-mKnC+QJ9pWVzv+C4/U3rRsHapFfHvQFoFB92e52xeyGMcX6/OlIl78je1u8vePzYZSkkogMPJ2yjxxsb89cxyw=="],
+
     "clone-response/mimic-response": ["mimic-response@1.0.1", "", {}, "sha512-j5EctnkH7amfV/q5Hgmoal1g2QHFJRraOtmx0JpIqkxhBhI/lJSl1nMpQ45hVarwNETOoWEimndZ4QK0RHxuxQ=="],
 
     "config-file-ts/glob": ["glob@10.5.0", "", { "dependencies": { "foreground-child": "^3.1.0", "jackspeak": "^3.1.2", "minimatch": "^9.0.4", "minipass": "^7.1.2", "package-json-from-dist": "^1.0.0", "path-scurry": "^1.11.1" }, "bin": { "glob": "dist/esm/bin.mjs" } }, "sha512-DfXN8DfhJ7NH3Oe7cFmu3NCu1wKbkReJ8TorzSAFbSKrlNaQSKfIzqYqVY8zlbs2NLBbWpRiU52GX2PbaBVNkg=="],
 
+    "cytoscape-fcose/cose-base": ["cose-base@2.2.0", "", { "dependencies": { "layout-base": "^2.0.0" } }, "sha512-AzlgcsCbUMymkADOJtQm3wO9S3ltPfYOFD5033keQn9NJzIbtnZj+UdBJe7DYml/8TdbtHJW3j58SOnKhWY/5g=="],
+
+    "d3-dsv/commander": ["commander@7.2.0", "", {}, "sha512-QrWXB+ZQSVPmIWIhtEO9H+gwHaMGYiF5ChvoJ+K9ZGHG/sVsa6yiesAD1GC/x46sET00Xlwo1u49RVVVzvcSkw=="],
+
+    "d3-sankey/d3-array": ["d3-array@2.12.1", "", { "dependencies": { "internmap": "^1.0.0" } }, "sha512-B0ErZK/66mHtEsR1TkPEEkwdy+WDesimkM5gpZr5Dsg54BiTA5RXtYW5qTLIAcekaS9xfZrzBLF/OAkB3Qn1YQ=="],
+
+    "d3-sankey/d3-shape": ["d3-shape@1.3.7", "", { "dependencies": { "d3-path": "1" } }, "sha512-EUkvKjqPFUAZyOlhY5gzCxCeI0Aep04LwIRpsZ/mLFelJiUfnK56jo5JMDSE7yyP2kLSb6LtF+S5chMk7uqPqw=="],
+
     "dir-compare/minimatch": ["minimatch@3.1.2", "", { "dependencies": { "brace-expansion": "^1.1.7" } }, "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw=="],
 
     "dmg-license/ajv": ["ajv@6.12.6", "", { "dependencies": { "fast-deep-equal": "^3.1.1", "fast-json-stable-stringify": "^2.0.0", "json-schema-traverse": "^0.4.1", "uri-js": "^4.2.2" } }, "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g=="],
@@ -2134,6 +2379,8 @@
 
     "iconv-corefoundation/node-addon-api": ["node-addon-api@1.7.2", "", {}, "sha512-ibPK3iA+vaY1eEjESkQkM0BbCqFOaZMiXRTtdB0u7b4djtY6JnsjvPdUHVMg6xQt3B8fpTTWHI9A+ADjM9frzg=="],
 
+    "katex/commander": ["commander@8.3.0", "", {}, "sha512-OkTL9umf+He2DZkUq8f8J9of7yL6RJKI24dVITBmNfZBmri9zYZQrKkuXiKhyfPSu8tUhnVBB1iKXevvnlR4Ww=="],
+
     "lazystream/readable-stream": ["readable-stream@2.3.8", "", { "dependencies": { "core-util-is": "~1.0.0", "inherits": "~2.0.3", "isarray": "~1.0.0", "process-nextick-args": "~2.0.0", "safe-buffer": "~5.1.1", "string_decoder": "~1.1.1", "util-deprecate": "~1.0.1" } }, "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA=="],
 
     "lru-cache/yallist": ["yallist@3.1.1", "", {}, "sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g=="],
@@ -2184,6 +2431,8 @@
 
     "ssri/minipass": ["minipass@3.3.6", "", { "dependencies": { "yallist": "^4.0.0" } }, "sha512-DxiNidxSEK+tHG6zOIklvNOwm3hvCrbUrdtzY74U6HKTJxvIDfOUL5W5P2Ghd3DTkhhKPYGqeNUIh5qcM4YBfw=="],
 
+    "streamdown/marked": ["marked@17.0.1", "", { "bin": { "marked": "bin/marked.js" } }, "sha512-boeBdiS0ghpWcSwoNm/jJBwdpFaMnZWRzjA6SkUMYb40SVaN1x7mmfGKp0jvexGcx+7y2La5zRZsYFZI6Qpypg=="],
+
     "streamdown/tailwind-merge": ["tailwind-merge@3.4.0", "", {}, "sha512-uSaO4gnW+b3Y2aWoWfFpX62vn2sR3skfhbjsEnaBI81WD1wBLlHZe5sWf0AqjksNdYTbGBEd0UasQMT3SNV15g=="],
 
     "tailwindcss/chokidar": ["chokidar@3.6.0", "", { "dependencies": { "anymatch": "~3.1.2", "braces": "~3.0.2", "glob-parent": "~5.1.2", "is-binary-path": "~2.1.0", "is-glob": "~4.0.1", "normalize-path": "~3.0.0", "readdirp": "~3.6.0" }, "optionalDependencies": { "fsevents": "~2.3.2" } }, "sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw=="],
@@ -2274,6 +2523,12 @@
 
     "config-file-ts/glob/minipass": ["minipass@7.1.2", "", {}, "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw=="],
 
+    "cytoscape-fcose/cose-base/layout-base": ["layout-base@2.0.1", "", {}, "sha512-dp3s92+uNI1hWIpPGH3jK2kxE2lMjdXdr+DH8ynZHpd6PUlH6x6cbuXnoMmiNumznqaNO31xu9e79F0uuZ0JFg=="],
+
+    "d3-sankey/d3-array/internmap": ["internmap@1.0.1", "", {}, "sha512-lDB5YccMydFBtasVtxnZ3MRBHuaoE8GKsppq+EchKL2U4nK/DmEpPHNH8MZe5HkMtpSiTSOZwfN0tzYjO/lJEw=="],
+
+    "d3-sankey/d3-shape/d3-path": ["d3-path@1.0.9", "", {}, "sha512-VLaYcn81dtHVTjEHd8B+pbe9yHWpXKZUC87PzoFmsFrJqgFwDe/qxfp5MlfsfM1V5E/iVt0MmEbWQ7FVIXh/bg=="],
+
     "dir-compare/minimatch/brace-expansion": ["brace-expansion@1.1.12", "", { "dependencies": { "balanced-match": "^1.0.0", "concat-map": "0.0.1" } }, "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg=="],
 
     "dmg-license/ajv/json-schema-traverse": ["json-schema-traverse@0.4.1", "", {}, "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg=="],
Index: src/main/index.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/index.ts b/src/main/index.ts
--- a/src/main/index.ts	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/main/index.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -1,8 +1,9 @@
 import * as Sentry from "@sentry/electron/main"
-import { app, BrowserWindow, Menu, session } from "electron"
+import { app, BrowserWindow, Menu, net, session } from "electron"
 import { existsSync, readFileSync, readlinkSync, unlinkSync } from "fs"
 import { createServer } from "http"
 import { join } from "path"
+import { pathToFileURL } from "url"
 import { AuthManager, initAuthManager, getAuthManager as getAuthManagerFromModule } from "./auth-manager"
 import {
   identify,
@@ -554,6 +555,124 @@
     // Register protocol handler (must be after app is ready)
     initialRegistration = registerProtocol()
 
+    // Register local-file:// protocol for media file preview
+    // Supports Range requests for video/audio streaming
+    const mainSession = session.fromPartition("persist:main")
+    mainSession.protocol.handle("local-file", async (request) => {
+      try {
+        // Parse URL: local-file://localhost/C:/path/to/file.png
+        const url = new URL(request.url)
+        let filePath = decodeURIComponent(url.pathname)
+
+        // Windows path handling: /C:/path -> C:/path or /D:/path -> D:/path
+        if (process.platform === "win32" && filePath.startsWith("/")) {
+          filePath = filePath.slice(1)
+        }
+
+        // Convert forward slashes to backslashes on Windows
+        if (process.platform === "win32") {
+          filePath = filePath.replace(/\//g, "\\")
+        }
+
+        // Verify file exists
+        if (!existsSync(filePath)) {
+          console.error("[local-file] File not found:", filePath)
+          return new Response("File not found", { status: 404 })
+        }
+
+        // Get file stats for size
+        const { statSync, createReadStream } = await import("fs")
+        const stats = statSync(filePath)
+        const fileSize = stats.size
+
+        // Determine MIME type
+        const ext = filePath.split(".").pop()?.toLowerCase() || ""
+        const mimeTypes: Record<string, string> = {
+          // Images
+          png: "image/png",
+          jpg: "image/jpeg",
+          jpeg: "image/jpeg",
+          gif: "image/gif",
+          webp: "image/webp",
+          svg: "image/svg+xml",
+          ico: "image/x-icon",
+          bmp: "image/bmp",
+          // Video
+          mp4: "video/mp4",
+          webm: "video/webm",
+          ogg: "video/ogg",
+          mov: "video/quicktime",
+          avi: "video/x-msvideo",
+          mkv: "video/x-matroska",
+          // Audio
+          mp3: "audio/mpeg",
+          wav: "audio/wav",
+          flac: "audio/flac",
+          aac: "audio/aac",
+          m4a: "audio/mp4",
+          // Documents
+          pdf: "application/pdf",
+        }
+        const contentType = mimeTypes[ext] || "application/octet-stream"
+
+        // Check for Range header (needed for video/audio seeking)
+        const rangeHeader = request.headers.get("range")
+
+        if (rangeHeader) {
+          // Parse Range header: bytes=start-end
+          const match = rangeHeader.match(/bytes=(\d*)-(\d*)/)
+          if (match) {
+            const start = match[1] ? parseInt(match[1], 10) : 0
+            const end = match[2] ? parseInt(match[2], 10) : fileSize - 1
+            const chunkSize = end - start + 1
+
+            // Create readable stream for the range
+            const stream = createReadStream(filePath, { start, end })
+            const readable = new ReadableStream({
+              start(controller) {
+                stream.on("data", (chunk: Buffer) => controller.enqueue(chunk))
+                stream.on("end", () => controller.close())
+                stream.on("error", (err) => controller.error(err))
+              },
+            })
+
+            return new Response(readable, {
+              status: 206,
+              headers: {
+                "Content-Type": contentType,
+                "Content-Length": String(chunkSize),
+                "Content-Range": `bytes ${start}-${end}/${fileSize}`,
+                "Accept-Ranges": "bytes",
+              },
+            })
+          }
+        }
+
+        // No Range header - return full file
+        const stream = createReadStream(filePath)
+        const readable = new ReadableStream({
+          start(controller) {
+            stream.on("data", (chunk: Buffer) => controller.enqueue(chunk))
+            stream.on("end", () => controller.close())
+            stream.on("error", (err) => controller.error(err))
+          },
+        })
+
+        return new Response(readable, {
+          status: 200,
+          headers: {
+            "Content-Type": contentType,
+            "Content-Length": String(fileSize),
+            "Accept-Ranges": "bytes",
+          },
+        })
+      } catch (error) {
+        console.error("[local-file] Protocol error:", error)
+        return new Response("Internal error", { status: 500 })
+      }
+    })
+    console.log("[Protocol] Registered local-file:// protocol handler")
+
     // Handle deep link on macOS (app already running)
     app.on("open-url", (event, url) => {
       console.log("[Protocol] open-url event received:", url)
Index: src/main/lib/trpc/routers/files.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/lib/trpc/routers/files.ts b/src/main/lib/trpc/routers/files.ts
--- a/src/main/lib/trpc/routers/files.ts	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/main/lib/trpc/routers/files.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -1,7 +1,9 @@
 import { z } from "zod"
 import { router, publicProcedure } from "../index"
 import { readdir, stat, readFile, writeFile, mkdir } from "node:fs/promises"
-import { join, relative, basename } from "node:path"
+import { join, relative, basename, posix } from "node:path"
+import { spawn } from "node:child_process"
+import { platform } from "node:os"
 import { app } from "electron"
 
 // Directories to ignore when scanning
@@ -63,6 +65,16 @@
   type: "file" | "folder"
 }
 
+// Content search result type
+interface ContentSearchResult {
+  file: string
+  line: number
+  column: number
+  text: string
+  beforeContext?: string[]
+  afterContext?: string[]
+}
+
 // Cache for file and folder listings
 const fileListCache = new Map<string, { entries: FileEntry[]; timestamp: number }>()
 const CACHE_TTL = 5000 // 5 seconds
@@ -94,7 +106,8 @@
         if (entry.name.startsWith(".") && !entry.name.startsWith(".github") && !entry.name.startsWith(".vscode")) continue
 
         // Add the folder itself to results
-        entries.push({ path: relativePath, type: "folder" })
+        // Normalize path separators to forward slashes for cross-platform consistency
+        entries.push({ path: relativePath.replace(/\\/g, "/"), type: "folder" })
 
         // Recurse into subdirectory
         const subEntries = await scanDirectory(rootPath, fullPath, depth + 1, maxDepth)
@@ -110,7 +123,8 @@
           if (!ALLOWED_LOCK_FILES.has(entry.name)) continue
         }
 
-        entries.push({ path: relativePath, type: "file" })
+        // Normalize path separators to forward slashes for cross-platform consistency
+        entries.push({ path: relativePath.replace(/\\/g, "/"), type: "file" })
       }
     }
   } catch (error) {
@@ -176,7 +190,7 @@
       const bStarts = bName.startsWith(queryLower)
       if (aStarts && !bStarts) return -1
       if (!aStarts && bStarts) return 1
-      
+
       // Priority 3: If both start with query, shorter name = better match
       if (aStarts && bStarts) {
         if (aName.length !== bName.length) {
@@ -237,7 +251,7 @@
 
         // Get entry list (cached or fresh scan)
         const entries = await getEntryList(projectPath)
-        
+
         // Debug: log folder count
         const folderCount = entries.filter(e => e.type === "folder").length
         const fileCount = entries.filter(e => e.type === "file").length
@@ -264,19 +278,545 @@
     }),
 
   /**
-   * Read file contents from filesystem
+   * List contents of a specific directory (non-recursive, for lazy loading)
+   */
+  listDirectory: publicProcedure
+    .input(
+      z.object({
+        projectPath: z.string(),
+        relativePath: z.string().default(""),
+      })
+    )
+    .query(async ({ input }) => {
+      const { projectPath, relativePath } = input
+
+      if (!projectPath) {
+        return []
+      }
+
+      try {
+        const targetPath = relativePath ? join(projectPath, relativePath) : projectPath
+
+        // Verify the path exists and is a directory
+        const pathStat = await stat(targetPath)
+        if (!pathStat.isDirectory()) {
+          console.warn(`[files] Not a directory: ${targetPath}`)
+          return []
+        }
+
+        const dirEntries = await readdir(targetPath, { withFileTypes: true })
+        const results: Array<{ name: string; path: string; type: "file" | "folder" }> = []
+
+        for (const entry of dirEntries) {
+          // Use forward slash for cross-platform consistency
+          const entryRelativePath = relativePath ? `${relativePath}/${entry.name}` : entry.name
+
+          if (entry.isDirectory()) {
+            // Skip ignored directories
+            if (IGNORED_DIRS.has(entry.name)) continue
+            // Skip hidden directories (except .github, .vscode, etc.)
+            if (entry.name.startsWith(".") && !entry.name.startsWith(".github") && !entry.name.startsWith(".vscode")) continue
+
+            results.push({
+              name: entry.name,
+              path: entryRelativePath,
+              type: "folder",
+            })
+          } else if (entry.isFile()) {
+            // Skip ignored files
+            if (IGNORED_FILES.has(entry.name)) continue
+
+            // Check extension
+            const ext = entry.name.includes(".") ? "." + entry.name.split(".").pop()?.toLowerCase() : ""
+            if (IGNORED_EXTENSIONS.has(ext)) {
+              // Allow specific lock files
+              if (!ALLOWED_LOCK_FILES.has(entry.name)) continue
+            }
+
+            results.push({
+              name: entry.name,
+              path: entryRelativePath,
+              type: "file",
+            })
+          }
+        }
+
+        // Sort: folders first, then alphabetically
+        results.sort((a, b) => {
+          if (a.type !== b.type) {
+            return a.type === "folder" ? -1 : 1
+          }
+          return a.name.localeCompare(b.name)
+        })
+
+        return results
+      } catch (error) {
+        console.error(`[files] Error listing directory:`, error)
+        return []
+      }
+    }),
+
+  /**
+   * Read file content (for preview)
    */
   readFile: publicProcedure
-    .input(z.object({ filePath: z.string() }))
+    .input(
+      z.object({
+        path: z.string(),
+        maxSize: z.number().default(1024 * 1024), // 1MB default max
+      })
+    )
     .query(async ({ input }) => {
-      const { filePath } = input
+      const { path: filePath, maxSize } = input
 
       try {
+        // Check file exists and get size
+        const fileStat = await stat(filePath)
+
+        if (!fileStat.isFile()) {
+          throw new Error("Not a file")
+        }
+
+        if (fileStat.size > maxSize) {
+          throw new Error(`File too large (${Math.round(fileStat.size / 1024)}KB > ${Math.round(maxSize / 1024)}KB limit)`)
+        }
+
+        // Read file content
         const content = await readFile(filePath, "utf-8")
         return content
       } catch (error) {
-        console.error(`[files] Error reading file ${filePath}:`, error)
-        throw new Error(`Failed to read file: ${error instanceof Error ? error.message : "Unknown error"}`)
+        console.error(`[files] Error reading file:`, error)
+        throw error
+      }
+    }),
+
+  /**
+   * Read binary file as base64 (for images, PDFs, etc.)
+   */
+  readBinaryFile: publicProcedure
+    .input(
+      z.object({
+        path: z.string(),
+        maxSize: z.number().default(10 * 1024 * 1024), // 10MB default max for binary files
+      })
+    )
+    .query(async ({ input }) => {
+      const { path: filePath, maxSize } = input
+
+      try {
+        // Check file exists and get size
+        const fileStat = await stat(filePath)
+
+        if (!fileStat.isFile()) {
+          throw new Error("Not a file")
+        }
+
+        if (fileStat.size > maxSize) {
+          throw new Error(`File too large (${Math.round(fileStat.size / 1024)}KB > ${Math.round(maxSize / 1024)}KB limit)`)
+        }
+
+        // Read file as buffer and convert to base64
+        const buffer = await readFile(filePath)
+        const base64 = buffer.toString("base64")
+
+        // Determine MIME type from extension
+        const ext = filePath.split(".").pop()?.toLowerCase() || ""
+        const mimeTypes: Record<string, string> = {
+          // Images
+          png: "image/png",
+          jpg: "image/jpeg",
+          jpeg: "image/jpeg",
+          gif: "image/gif",
+          webp: "image/webp",
+          svg: "image/svg+xml",
+          ico: "image/x-icon",
+          bmp: "image/bmp",
+          avif: "image/avif",
+          // Documents
+          pdf: "application/pdf",
+        }
+        const mimeType = mimeTypes[ext] || "application/octet-stream"
+
+        return {
+          base64,
+          mimeType,
+          size: fileStat.size,
+        }
+      } catch (error) {
+        console.error(`[files] Error reading binary file:`, error)
+        throw error
+      }
+    }),
+
+  /**
+   * Search for files matching a filename pattern (returns all matching paths for auto-expand)
+   */
+  searchFiles: publicProcedure
+    .input(
+      z.object({
+        projectPath: z.string(),
+        query: z.string(),
+        limit: z.number().min(1).max(500).default(100),
+      })
+    )
+    .query(async ({ input }) => {
+      const { projectPath, query, limit } = input
+
+      if (!projectPath) {
+        return { results: [], parentPaths: [] }
+      }
+
+      try {
+        const entries = await getEntryList(projectPath)
+
+        // If no query, return all folder paths for expand all functionality
+        if (!query) {
+          const allFolders = entries.filter((entry) => entry.type === "folder")
+          return {
+            results: [],
+            parentPaths: allFolders.map((f) => f.path),
+          }
+        }
+
+        const queryLower = query.toLowerCase()
+
+        // Find matching files
+        const matchingFiles = entries.filter((entry) => {
+          const name = basename(entry.path).toLowerCase()
+          return name.includes(queryLower)
+        })
+
+        // Sort by relevance
+        matchingFiles.sort((a, b) => {
+          const aName = basename(a.path).toLowerCase()
+          const bName = basename(b.path).toLowerCase()
+
+          // Exact match first
+          if (aName === queryLower && bName !== queryLower) return -1
+          if (bName === queryLower && aName !== queryLower) return 1
+
+          // Starts with query
+          if (aName.startsWith(queryLower) && !bName.startsWith(queryLower)) return -1
+          if (bName.startsWith(queryLower) && !aName.startsWith(queryLower)) return 1
+
+          // Shorter name = better match
+          return aName.length - bName.length
+        })
+
+        const limited = matchingFiles.slice(0, limit)
+
+        // Collect all parent directories that need to be expanded
+        // Use posix.dirname since paths are normalized to forward slashes
+        const parentPaths = new Set<string>()
+        for (const entry of limited) {
+          let currentPath = posix.dirname(entry.path)
+          while (currentPath && currentPath !== ".") {
+            parentPaths.add(currentPath)
+            currentPath = posix.dirname(currentPath)
+          }
+        }
+
+        return {
+          results: limited.map((entry) => ({
+            path: entry.path,
+            type: entry.type,
+            name: basename(entry.path),
+          })),
+          parentPaths: Array.from(parentPaths),
+        }
+      } catch (error) {
+        console.error(`[files] Error searching files:`, error)
+        return { results: [], parentPaths: [] }
+      }
+    }),
+
+  /**
+   * Search file contents using ripgrep (with grep/findstr fallback)
+   */
+  searchContent: publicProcedure
+    .input(
+      z.object({
+        projectPath: z.string(),
+        query: z.string(),
+        filePattern: z.string().optional(),
+        caseSensitive: z.boolean().default(false),
+        limit: z.number().min(1).max(500).default(100),
+      })
+    )
+    .mutation(async ({ input }) => {
+      const { projectPath, query, filePattern, caseSensitive, limit } = input
+
+      if (!projectPath || !query) {
+        return { results: [], tool: "none" }
+      }
+
+      const isWindows = platform() === "win32"
+
+      return new Promise<{ results: ContentSearchResult[]; tool: string }>((resolve) => {
+        // Try ripgrep first, then fall back to grep/findstr
+        const rgPaths = isWindows
+          ? ["rg", "C:\\Program Files\\ripgrep\\rg.exe", "C:\\ProgramData\\scoop\\shims\\rg.exe"]
+          : ["rg", "/opt/homebrew/bin/rg", "/usr/local/bin/rg", "/usr/bin/rg"]
+
+        let rgPathIndex = 0
+
+        const tryRipgrep = () => {
+          if (rgPathIndex >= rgPaths.length) {
+            // No ripgrep found, try fallback
+            tryFallback()
+            return
+          }
+
+          const rgPath = rgPaths[rgPathIndex]
+          rgPathIndex++
+
+          console.log(`[files] Trying ripgrep at: ${rgPath} for content search: "${query}" in ${projectPath}`)
+
+          const args = [
+            "--json",
+            "--line-number",
+            "--column",
+            "-C", "2", // 2 lines of context
+          ]
+
+          // Add case sensitivity flag
+          if (!caseSensitive) {
+            args.push("-i")
+          }
+
+          // Add file pattern if provided
+          if (filePattern) {
+            args.push("-g", filePattern)
+          }
+
+          // Add ignored directories
+          for (const dir of IGNORED_DIRS) {
+            args.push("-g", `!${dir}/**`)
+          }
+
+          args.push("--", query, projectPath)
+
+          const rg = spawn(rgPath, args)
+          let output = ""
+
+          rg.stdout.on("data", (data) => {
+            output += data.toString()
+          })
+
+          rg.on("close", (code) => {
+            if (code === null || (code !== 0 && code !== 1)) {
+              // ripgrep error, try next path
+              tryRipgrep()
+              return
+            }
+
+            // Parse JSON output
+            const lines = output.split("\n").filter(Boolean)
+            const matchMap = new Map<string, ContentSearchResult>()
+
+            for (const line of lines) {
+              try {
+                const json = JSON.parse(line)
+                if (json.type === "match") {
+                  const data = json.data
+                  const file = relative(projectPath, data.path.text).replace(/\\/g, "/")
+                  const lineNum = data.line_number
+
+                  // Skip ignored directories
+                  if (IGNORED_DIRS.has(file.split("/")[0])) continue
+
+                  const key = `${file}:${lineNum}`
+                  if (!matchMap.has(key)) {
+                    matchMap.set(key, {
+                      file,
+                      line: lineNum,
+                      column: data.submatches?.[0]?.start || 0,
+                      text: data.lines.text.trim(),
+                      beforeContext: [],
+                      afterContext: [],
+                    })
+                  }
+                }
+              } catch {
+                // Skip non-JSON lines
+              }
+            }
+
+            const results = Array.from(matchMap.values()).slice(0, limit)
+            resolve({
+              results,
+              tool: "ripgrep",
+            })
+          })
+
+          rg.on("error", () => {
+            // This ripgrep path not found, try next path
+            tryRipgrep()
+          })
+        }
+
+        const tryFallback = () => {
+          if (isWindows) {
+            tryFindstr()
+          } else {
+            tryGrep()
+          }
+        }
+
+        const tryFindstr = () => {
+          console.log(`[files] Trying findstr for content search: "${query}" in ${projectPath}`)
+
+          // Windows findstr command
+          // /S = search subdirectories
+          // /N = print line numbers
+          // /I = case insensitive (if needed)
+          // /P = skip binary files
+          const args = ["/S", "/N", "/P"]
+
+          if (!caseSensitive) {
+            args.push("/I")
+          }
+
+          // Add search pattern
+          args.push(query)
+
+          // Add file pattern
+          if (filePattern) {
+            args.push(filePattern)
+          } else {
+            args.push("*.*")
+          }
+
+          const findstr = spawn("findstr", args, { cwd: projectPath })
+          const results: ContentSearchResult[] = []
+          let output = ""
+
+          findstr.stdout.on("data", (data) => {
+            output += data.toString()
+          })
+
+          findstr.on("close", (code) => {
+            // findstr returns 1 when no matches found, 0 on success, 2 on error
+            if (code === 2) {
+              console.error(`[files] findstr failed`)
+              resolve({ results: [], tool: "findstr-failed" })
+              return
+            }
+
+            // Parse findstr output: filename:line:content
+            const lines = output.split("\r\n").filter(Boolean)
+
+            for (const line of lines) {
+              if (results.length >= limit) break
+
+              const match = line.match(/^(.+?):(\d+):(.*)$/)
+              if (match) {
+                let filePath = match[1]
+                // Normalize path separators to forward slashes
+                filePath = filePath.replace(/\\/g, "/")
+                // Skip ignored directories
+                if (IGNORED_DIRS.has(filePath.split("/")[0])) continue
+                if (filePath.includes("/node_modules/") || filePath.includes("/.git/")) continue
+
+                results.push({
+                  file: filePath,
+                  line: parseInt(match[2], 10),
+                  column: 0,
+                  text: match[3].trim(),
+                })
+              }
+            }
+
+            resolve({ results, tool: "findstr" })
+          })
+
+          findstr.on("error", (err) => {
+            console.error(`[files] findstr spawn error:`, err)
+            resolve({ results: [], tool: "findstr-error" })
+          })
+        }
+
+        const tryGrep = () => {
+          console.log(`[files] Trying grep for content search: "${query}" in ${projectPath}`)
+
+          const grepPath = "/usr/bin/grep"
+          const args = ["-r", "-n", "-H"]
+
+          if (filePattern) {
+            args.push("--include=" + filePattern)
+          }
+
+          if (!caseSensitive) {
+            args.push("-i")
+          }
+
+          for (const dir of IGNORED_DIRS) {
+            args.push(`--exclude-dir=${dir}`)
+          }
+
+          args.push("--", query, projectPath)
+
+          const grep = spawn(grepPath, args)
+          const results: ContentSearchResult[] = []
+          let output = ""
+
+          grep.stdout.on("data", (data) => {
+            output += data.toString()
+          })
+
+          grep.on("close", (code) => {
+            if (code === null || code > 1) {
+              resolve({ results: [], tool: "grep-failed" })
+              return
+            }
+
+            const lines = output.split("\n").filter(Boolean)
+            for (const line of lines) {
+              if (results.length >= limit) break
+
+              const match = line.match(/^(.+?):(\d+):(.*)$/)
+              if (match) {
+                results.push({
+                  file: relative(projectPath, match[1]).replace(/\\/g, "/"),
+                  line: parseInt(match[2], 10),
+                  column: 0,
+                  text: match[3].trim(),
+                })
+              }
+            }
+
+            resolve({ results, tool: "grep" })
+          })
+
+          grep.on("error", () => {
+            resolve({ results: [], tool: "grep-error" })
+          })
+        }
+
+        tryRipgrep()
+      })
+    }),
+
+  /**
+   * Write file content (for editing files)
+   */
+  writeFile: publicProcedure
+    .input(
+      z.object({
+        path: z.string(),
+        content: z.string(),
+      })
+    )
+    .mutation(async ({ input }) => {
+      const { path: filePath, content } = input
+
+      try {
+        await writeFile(filePath, content, "utf-8")
+        console.log(`[files] Wrote file: ${filePath} (${content.length} bytes)`)
+        return { success: true }
+      } catch (error) {
+        console.error(`[files] Error writing file:`, error)
+        throw error
       }
     }),
 
Index: src/renderer/components/ui/panel-container/center-peek-dialog.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/center-peek-dialog.tsx b/src/renderer/components/ui/panel-container/center-peek-dialog.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/center-peek-dialog.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,57 @@
+"use client"
+
+import { AnimatePresence, motion } from "motion/react"
+
+interface CenterPeekDialogProps {
+  isOpen: boolean
+  onClose: () => void
+  children: React.ReactNode
+}
+
+export function CenterPeekDialog({
+  isOpen,
+  onClose,
+  children,
+}: CenterPeekDialogProps) {
+  return (
+    <AnimatePresence>
+      {isOpen && (
+        <>
+          {/* Backdrop */}
+          <motion.div
+            initial={{ opacity: 0 }}
+            animate={{ opacity: 1 }}
+            exit={{ opacity: 0 }}
+            transition={{ duration: 0.15 }}
+            className="fixed inset-0 bg-black/50 z-50"
+            onClick={onClose}
+          />
+
+          {/* Dialog */}
+          <motion.div
+            role="dialog"
+            aria-modal="true"
+            initial={{ opacity: 0, scale: 0.98 }}
+            animate={{ opacity: 1, scale: 1 }}
+            exit={{ opacity: 0, scale: 0.98 }}
+            transition={{ duration: 0.15, ease: [0.4, 0, 0.2, 1] }}
+            className="fixed z-50 flex flex-col bg-background border border-border/50 overflow-hidden"
+            style={{
+              top: "72px",
+              left: "72px",
+              right: "72px",
+              height: "calc(100% - 144px)",
+              maxWidth: "1200px",
+              marginInline: "auto",
+              borderRadius: "12px",
+              boxShadow:
+                "0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05)",
+            }}
+          >
+            {children}
+          </motion.div>
+        </>
+      )}
+    </AnimatePresence>
+  )
+}
Index: src/renderer/components/ui/panel-container/full-page-view.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/full-page-view.tsx b/src/renderer/components/ui/panel-container/full-page-view.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/full-page-view.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,31 @@
+"use client"
+
+import { AnimatePresence, motion } from "motion/react"
+
+interface FullPageViewProps {
+  isOpen: boolean
+  onClose: () => void
+  children: React.ReactNode
+}
+
+export function FullPageView({
+  isOpen,
+  onClose,
+  children,
+}: FullPageViewProps) {
+  return (
+    <AnimatePresence>
+      {isOpen && (
+        <motion.div
+          initial={{ opacity: 0 }}
+          animate={{ opacity: 1 }}
+          exit={{ opacity: 0 }}
+          transition={{ duration: 0.15, ease: [0.4, 0, 0.2, 1] }}
+          className="fixed inset-0 z-50 bg-background flex flex-col"
+        >
+          {children}
+        </motion.div>
+      )}
+    </AnimatePresence>
+  )
+}
Index: src/renderer/components/ui/panel-container/index.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/index.ts b/src/renderer/components/ui/panel-container/index.ts
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/index.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,6 @@
+export { PanelContainer } from "./panel-container"
+export { PanelHeader } from "./panel-header"
+export { PanelModeSwitcher } from "./panel-mode-switcher"
+export { CenterPeekDialog } from "./center-peek-dialog"
+export { FullPageView } from "./full-page-view"
+export type { PanelDisplayMode } from "./types"
Index: src/renderer/components/ui/panel-container/panel-container.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/panel-container.tsx b/src/renderer/components/ui/panel-container/panel-container.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/panel-container.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,105 @@
+"use client"
+
+import { useCallback, useEffect } from "react"
+import type { WritableAtom } from "jotai"
+import { ResizableSidebar } from "../resizable-sidebar"
+import { CenterPeekDialog } from "./center-peek-dialog"
+import { FullPageView } from "./full-page-view"
+import type { PanelDisplayMode } from "./types"
+
+interface PanelContainerProps {
+  /** Whether the panel is open */
+  isOpen: boolean
+  /** Close handler */
+  onClose: () => void
+  /** Current display mode */
+  displayMode: PanelDisplayMode
+  /** Panel content */
+  children: React.ReactNode
+  /** Jotai atom for sidebar width (required for side-peek mode) */
+  widthAtom?: WritableAtom<number, [number], void>
+  /** Minimum width for sidebar mode */
+  minWidth?: number
+  /** Maximum width for sidebar mode */
+  maxWidth?: number
+  /** Side for sidebar mode */
+  side?: "left" | "right"
+  /** Additional class name for sidebar container */
+  className?: string
+  /** Custom styles for sidebar container */
+  style?: React.CSSProperties
+}
+
+export function PanelContainer({
+  isOpen,
+  onClose,
+  displayMode,
+  children,
+  widthAtom,
+  minWidth = 300,
+  maxWidth = 800,
+  side = "right",
+  className = "",
+  style,
+}: PanelContainerProps) {
+  // ESC key handler for dialog and full-page modes
+  // (ResizableSidebar doesn't handle ESC by default)
+  const handleKeyDown = useCallback(
+    (e: KeyboardEvent) => {
+      if (e.key === "Escape") {
+        e.stopPropagation()
+        onClose()
+      }
+    },
+    [onClose]
+  )
+
+  useEffect(() => {
+    // Only add ESC handler for non-sidebar modes
+    // CenterPeekDialog and FullPageView have their own ESC handlers,
+    // but we add one at container level for consistency
+    if (isOpen && displayMode !== "side-peek") {
+      document.addEventListener("keydown", handleKeyDown)
+      return () => document.removeEventListener("keydown", handleKeyDown)
+    }
+  }, [isOpen, displayMode, handleKeyDown])
+
+  if (displayMode === "side-peek") {
+    if (!widthAtom) {
+      console.warn("PanelContainer: widthAtom is required for side-peek mode")
+      return null
+    }
+    return (
+      <ResizableSidebar
+        isOpen={isOpen}
+        onClose={onClose}
+        widthAtom={widthAtom}
+        side={side}
+        minWidth={minWidth}
+        maxWidth={maxWidth}
+        className={className}
+        style={{ borderLeftWidth: side === "right" ? "0.5px" : undefined, overflow: "hidden", ...style }}
+      >
+        {children}
+      </ResizableSidebar>
+    )
+  }
+
+  if (displayMode === "center-peek") {
+    return (
+      <CenterPeekDialog isOpen={isOpen} onClose={onClose}>
+        {children}
+      </CenterPeekDialog>
+    )
+  }
+
+  if (displayMode === "full-page") {
+    return (
+      <FullPageView isOpen={isOpen} onClose={onClose}>
+        {children}
+      </FullPageView>
+    )
+  }
+
+  return null
+}
Index: src/renderer/components/ui/panel-container/panel-header.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/panel-header.tsx b/src/renderer/components/ui/panel-container/panel-header.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/panel-header.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,111 @@
+"use client"
+
+import { X } from "lucide-react"
+import { Button } from "../button"
+import { IconCloseSidebarRight } from "../icons"
+import { PanelModeSwitcher } from "./panel-mode-switcher"
+import type { PanelDisplayMode } from "./types"
+import { cn } from "../../../lib/utils"
+
+interface PanelHeaderProps {
+  /** Title content (displayed after close button and mode switcher) */
+  title?: React.ReactNode
+  /** Left slot - custom content after mode switcher, before title */
+  leftSlot?: React.ReactNode
+  /** Right slot - custom actions on the right side */
+  rightSlot?: React.ReactNode
+  /** Close handler */
+  onClose?: () => void
+  /** Current display mode */
+  displayMode?: PanelDisplayMode
+  /** Display mode change handler */
+  onDisplayModeChange?: (mode: PanelDisplayMode) => void
+  /** Enable desktop window drag region */
+  isDesktop?: boolean
+  /** Whether window is in fullscreen mode */
+  isFullscreen?: boolean
+  /** Additional class names */
+  className?: string
+}
+
+export function PanelHeader({
+  title,
+  leftSlot,
+  rightSlot,
+  onClose,
+  displayMode,
+  onDisplayModeChange,
+  isDesktop = false,
+  isFullscreen = false,
+  className,
+}: PanelHeaderProps) {
+  return (
+    <div
+      className={cn(
+        "relative flex items-center justify-between h-10 px-2 border-b border-border/50 bg-background flex-shrink-0",
+        className
+      )}
+    >
+      {/* Drag region for window dragging */}
+      {isDesktop && !isFullscreen && (
+        <div
+          className="absolute inset-0 z-0"
+          style={{
+            // @ts-expect-error - WebKit-specific property
+            WebkitAppRegion: "drag",
+          }}
+        />
+      )}
+
+      {/* Left side: Close button + Mode switcher + Left slot + Title */}
+      <div
+        className="relative z-10 flex items-center gap-1 min-w-0 shrink"
+        style={{
+          // @ts-expect-error - WebKit-specific property
+          WebkitAppRegion: "no-drag",
+        }}
+      >
+        {/* Close button - X icon for dialog/fullpage modes, chevron for sidebar */}
+        {onClose && (
+          <Button
+            variant="ghost"
+            size="sm"
+            className="h-6 w-6 p-0 flex-shrink-0 hover:bg-foreground/10"
+            onClick={onClose}
+          >
+            {displayMode === "side-peek" ? (
+              <IconCloseSidebarRight className="size-4 text-muted-foreground" />
+            ) : (
+              <X className="size-4 text-muted-foreground" />
+            )}
+          </Button>
+        )}
+
+        {/* Display mode switcher */}
+        {displayMode && onDisplayModeChange && (
+          <PanelModeSwitcher
+            mode={displayMode}
+            onModeChange={onDisplayModeChange}
+          />
+        )}
+
+        {/* Left slot (custom content like branch selector for Diff) */}
+        {leftSlot}
+
+        {/* Title */}
+        {title}
+      </div>
+
+      {/* Right side (custom actions) */}
+      <div
+        className="relative z-10 flex items-center gap-1 flex-shrink-0"
+        style={{
+          // @ts-expect-error - WebKit-specific property
+          WebkitAppRegion: "no-drag",
+        }}
+      >
+        {rightSlot}
+      </div>
+    </div>
+  )
+}
Index: src/renderer/components/ui/panel-container/panel-mode-switcher.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/panel-mode-switcher.tsx b/src/renderer/components/ui/panel-container/panel-mode-switcher.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/panel-mode-switcher.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,76 @@
+"use client"
+
+import { Check } from "lucide-react"
+import { Button } from "../button"
+import {
+  DropdownMenu,
+  DropdownMenuContent,
+  DropdownMenuItem,
+  DropdownMenuTrigger,
+} from "../dropdown-menu"
+import {
+  IconSidePeek,
+  IconCenterPeek,
+  IconFullPage,
+} from "../icons"
+import type { PanelDisplayMode } from "./types"
+
+interface PanelModeSwitcherProps {
+  mode: PanelDisplayMode
+  onModeChange: (mode: PanelDisplayMode) => void
+}
+
+const MODES = [
+  {
+    value: "side-peek" as const,
+    label: "Sidebar",
+    Icon: IconSidePeek,
+  },
+  {
+    value: "center-peek" as const,
+    label: "Dialog",
+    Icon: IconCenterPeek,
+  },
+  {
+    value: "full-page" as const,
+    label: "Fullscreen",
+    Icon: IconFullPage,
+  },
+]
+
+export function PanelModeSwitcher({
+  mode,
+  onModeChange,
+}: PanelModeSwitcherProps) {
+  const currentMode = MODES.find((m) => m.value === mode) ?? MODES[0]
+  const CurrentIcon = currentMode.Icon
+
+  return (
+    <DropdownMenu>
+      <DropdownMenuTrigger asChild>
+        <Button
+          variant="ghost"
+          size="sm"
+          className="h-6 w-6 p-0 flex-shrink-0 hover:bg-foreground/10"
+        >
+          <CurrentIcon className="size-4 text-muted-foreground" />
+        </Button>
+      </DropdownMenuTrigger>
+      <DropdownMenuContent align="start" className="min-w-[140px]">
+        {MODES.map(({ value, label, Icon }) => (
+          <DropdownMenuItem
+            key={value}
+            onClick={() => onModeChange(value)}
+            className="flex items-center gap-2"
+          >
+            <Icon className="size-4 text-muted-foreground" />
+            <span className="flex-1">{label}</span>
+            {mode === value && (
+              <Check className="size-4 text-muted-foreground ml-auto" />
+            )}
+          </DropdownMenuItem>
+        ))}
+      </DropdownMenuContent>
+    </DropdownMenu>
+  )
+}
Index: src/renderer/components/ui/panel-container/types.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/components/ui/panel-container/types.ts b/src/renderer/components/ui/panel-container/types.ts
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/components/ui/panel-container/types.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,1 @@
+export type PanelDisplayMode = "side-peek" | "center-peek" | "full-page"
Index: src/renderer/features/agents/atoms/index.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/agents/atoms/index.ts b/src/renderer/features/agents/atoms/index.ts
--- a/src/renderer/features/agents/atoms/index.ts	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/agents/atoms/index.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -777,3 +777,68 @@
     },
   ),
 )
+
+// ============================================================================
+// Explorer Panel State
+// ============================================================================
+
+// Explorer display mode - sidebar (side peek), center dialog, or fullscreen
+export type ExplorerDisplayMode = "side-peek" | "center-peek" | "full-page"
+
+export const explorerDisplayModeAtom = atomWithStorage<ExplorerDisplayMode>(
+  "agents:explorerDisplayMode",
+  "side-peek", // default to sidebar for existing behavior
+  undefined,
+  { getOnInit: true },
+)
+
+// Explorer sidebar width (persisted globally)
+export const explorerSidebarWidthAtom = atomWithStorage<number>(
+  "agents-explorer-sidebar-width",
+  350,
+  undefined,
+  { getOnInit: true },
+)
+
+// Explorer panel open state storage - window-scoped, stores per chatId
+const explorerPanelOpenStorageAtom = atomWithWindowStorage<Record<string, boolean>>(
+  "agents:explorerPanelOpen",
+  {},
+  { getOnInit: true },
+)
+
+// Runtime open state - not persisted, used for dialog/fullscreen modes
+const explorerPanelOpenRuntimeAtom = atom<Record<string, boolean>>({})
+
+// atomFamily to get/set explorer panel open state per chatId
+// Only restores persisted state when display mode is "side-peek" (sidebar mode)
+// For dialog/fullscreen modes, we use runtime state only (not auto-restored on page load)
+export const explorerPanelOpenAtomFamily = atomFamily((chatId: string) =>
+  atom(
+    (get) => {
+      const displayMode = get(explorerDisplayModeAtom)
+      const runtimeOpen = get(explorerPanelOpenRuntimeAtom)[chatId]
+
+      // If we have a runtime value, use it (user explicitly opened/closed)
+      if (runtimeOpen !== undefined) {
+        return runtimeOpen
+      }
+
+      // For initial load: only restore persisted state for sidebar mode
+      // Dialog and fullscreen should not auto-open on page load
+      if (displayMode !== "side-peek") {
+        return false
+      }
+      return get(explorerPanelOpenStorageAtom)[chatId] ?? false
+    },
+    (get, set, isOpen: boolean) => {
+      // Always update runtime state
+      const currentRuntime = get(explorerPanelOpenRuntimeAtom)
+      set(explorerPanelOpenRuntimeAtom, { ...currentRuntime, [chatId]: isOpen })
+
+      // Also persist for sidebar mode
+      const current = get(explorerPanelOpenStorageAtom)
+      set(explorerPanelOpenStorageAtom, { ...current, [chatId]: isOpen })
+    },
+  ),
+)
Index: src/renderer/features/agents/main/active-chat.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/agents/main/active-chat.tsx b/src/renderer/features/agents/main/active-chat.tsx
--- a/src/renderer/features/agents/main/active-chat.tsx	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/agents/main/active-chat.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -191,10 +191,14 @@
 import { ChatInputArea } from "./chat-input-area"
 import { IsolatedMessagesSection } from "./isolated-messages-section"
 import { DetailsSidebar } from "../../details-sidebar/details-sidebar"
+import { ExpandedWidgetSidebar } from "../../details-sidebar/expanded-widget-sidebar"
 import {
   detailsSidebarOpenAtom,
   unifiedSidebarEnabledAtom,
+  expandedWidgetAtomFamily,
 } from "../../details-sidebar/atoms"
+import { ExplorerPanel } from "../../details-sidebar/sections/explorer-panel"
+import { explorerPanelOpenAtomFamily } from "../atoms"
 const clearSubChatSelectionAtom = atom(null, () => {})
 const isSubChatMultiSelectModeAtom = atom(false)
 const selectedSubChatIdsAtom = atom(new Set<string>())
@@ -4233,6 +4237,20 @@
   )
   const [isTerminalSidebarOpen, setIsTerminalSidebarOpen] = useAtom(terminalSidebarAtom)
 
+  // Per-chat expanded widget state - for Explorer and other expandable widgets
+  const expandedWidgetAtom = useMemo(
+    () => expandedWidgetAtomFamily(chatId),
+    [chatId],
+  )
+  const [expandedWidget, setExpandedWidget] = useAtom(expandedWidgetAtom)
+
+  // Explorer panel state - separate from ExpandedWidgetSidebar (supports three display modes)
+  const explorerPanelOpenAtom = useMemo(
+    () => explorerPanelOpenAtomFamily(chatId),
+    [chatId],
+  )
+  const [isExplorerPanelOpen, setIsExplorerPanelOpen] = useAtom(explorerPanelOpenAtom)
+
   // Mutual exclusion: Details sidebar vs Plan/Terminal/Diff(side-peek) sidebars
   // When one opens, close the conflicting ones and remember for restoration
 
@@ -6468,6 +6486,8 @@
             onExpandTerminal={() => setIsTerminalSidebarOpen(true)}
             onExpandPlan={() => setIsPlanSidebarOpen(true)}
             onExpandDiff={() => setIsDiffSidebarOpen(true)}
+            onExpandExplorer={() => setIsExplorerPanelOpen(true)}
+            isExplorerSidebarOpen={isExplorerPanelOpen}
             onFileSelect={(filePath) => {
               // Set the selected file path
               setSelectedFilePath(filePath)
@@ -6478,6 +6498,31 @@
             }}
           />
         )}
+
+        {/* Expanded Widget Sidebar - for Info, Plan, Terminal, Diff widgets */}
+        {isUnifiedSidebarEnabled && !isMobileFullscreen && worktreePath && (
+          <ExpandedWidgetSidebar
+            chatId={chatId}
+            worktreePath={worktreePath}
+            planPath={currentPlanPath}
+            planRefetchTrigger={planEditRefetchTrigger}
+            activeSubChatId={activeSubChatIdForPlan}
+            canOpenDiff={canOpenDiff}
+            isDiffSidebarOpen={isDiffSidebarOpen}
+            setIsDiffSidebarOpen={setIsDiffSidebarOpen}
+            diffStats={diffStats}
+          />
+        )}
+
+        {/* Explorer Panel - supports sidebar/dialog/fullscreen modes */}
+        {worktreePath && (
+          <ExplorerPanel
+            chatId={chatId}
+            worktreePath={worktreePath}
+            isOpen={isExplorerPanelOpen}
+            onClose={() => setIsExplorerPanelOpen(false)}
+          />
+        )}
       </div>
     </div>
     </TextSelectionProvider>
Index: src/renderer/features/agents/main/chat-input-area.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/agents/main/chat-input-area.tsx b/src/renderer/features/agents/main/chat-input-area.tsx
--- a/src/renderer/features/agents/main/chat-input-area.tsx	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/agents/main/chat-input-area.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -39,6 +39,7 @@
 import { trpc } from "../../../lib/trpc"
 import { cn } from "../../../lib/utils"
 import { isPlanModeAtom, lastSelectedModelIdAtom, type SubChatFileChange } from "../atoms"
+import { pendingFileReferenceAtom } from "../../cowork/atoms"
 import { AgentsSlashCommand, type SlashCommandOption } from "../commands"
 import { AgentSendButton } from "../components/agent-send-button"
 import type { UploadedFile, UploadedImage } from "../hooks/use-agents-file-upload"
@@ -421,6 +422,9 @@
   // Plan mode - global atom
   const [isPlanMode, setIsPlanMode] = useAtom(isPlanModeAtom)
 
+  // Pending file reference from file tree panel (@ button click)
+  const [pendingFileReference, setPendingFileReference] = useAtom(pendingFileReferenceAtom)
+
   // Voice input state
   const {
     isRecording: isVoiceRecording,
@@ -642,6 +646,29 @@
     }
   }, [voiceInputHotkey, isVoiceRecording, isTranscribing, isStreaming, handleVoiceMouseDown, handleVoiceMouseUp])
 
+  // Handle pending file reference from file tree panel (@ button click)
+  useEffect(() => {
+    if (pendingFileReference && editorRef.current) {
+      // Construct mention option from pending reference
+      const mentionOption: FileMentionOption = {
+        id: `file:local:${pendingFileReference.path}`,
+        label: pendingFileReference.name,
+        path: pendingFileReference.path,
+        repository: "local",
+        type: pendingFileReference.type,
+      }
+
+      // Insert the mention into the editor
+      editorRef.current.insertMention(mentionOption)
+
+      // Clear the pending reference
+      setPendingFileReference(null)
+
+      // Focus the editor
+      editorRef.current.focus()
+    }
+  }, [pendingFileReference, setPendingFileReference, editorRef])
+
   // Save draft on blur (with attachments and text contexts)
   const handleEditorBlur = useCallback(async () => {
     setIsFocused(false)
Index: src/renderer/features/changes/components/diff-center-peek-dialog/diff-center-peek-dialog.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/changes/components/diff-center-peek-dialog/diff-center-peek-dialog.tsx b/src/renderer/features/changes/components/diff-center-peek-dialog/diff-center-peek-dialog.tsx
--- a/src/renderer/features/changes/components/diff-center-peek-dialog/diff-center-peek-dialog.tsx	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/changes/components/diff-center-peek-dialog/diff-center-peek-dialog.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -1,76 +1,2 @@
-"use client"
-
-import { AnimatePresence, motion } from "motion/react"
-import { useEffect, useCallback } from "react"
-
-interface DiffCenterPeekDialogProps {
-  isOpen: boolean
-  onClose: () => void
-  children: React.ReactNode
-}
-
-export function DiffCenterPeekDialog({
-  isOpen,
-  onClose,
-  children,
-}: DiffCenterPeekDialogProps) {
-  // Close on Escape key
-  const handleKeyDown = useCallback(
-    (e: KeyboardEvent) => {
-      if (e.key === "Escape") {
-        e.stopPropagation() // Prevent ESC from bubbling to stop stream handler
-        onClose()
-      }
-    },
-    [onClose]
-  )
-
-  useEffect(() => {
-    if (isOpen) {
-      document.addEventListener("keydown", handleKeyDown)
-      return () => document.removeEventListener("keydown", handleKeyDown)
-    }
-  }, [isOpen, handleKeyDown])
-
-  return (
-    <AnimatePresence>
-      {isOpen && (
-        <>
-          {/* Backdrop */}
-          <motion.div
-            initial={{ opacity: 0 }}
-            animate={{ opacity: 1 }}
-            exit={{ opacity: 0 }}
-            transition={{ duration: 0.15 }}
-            className="fixed inset-0 bg-black/50 z-50"
-            onClick={onClose}
-          />
-
-          {/* Dialog */}
-          <motion.div
-            role="dialog"
-            aria-modal="true"
-            initial={{ opacity: 0, scale: 0.98 }}
-            animate={{ opacity: 1, scale: 1 }}
-            exit={{ opacity: 0, scale: 0.98 }}
-            transition={{ duration: 0.15, ease: [0.4, 0, 0.2, 1] }}
-            className="fixed z-50 flex flex-col bg-background border border-border/50 overflow-hidden"
-            style={{
-              top: "72px",
-              left: "72px",
-              right: "72px",
-              height: "calc(100% - 144px)",
-              maxWidth: "1200px",
-              marginInline: "auto",
-              borderRadius: "12px",
-              boxShadow:
-                "0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05)",
-            }}
-          >
-            {children}
-          </motion.div>
-        </>
-      )}
-    </AnimatePresence>
-  )
-}
+// Re-export from unified panel-container for backward compatibility
+export { CenterPeekDialog as DiffCenterPeekDialog } from "../../../../components/ui/panel-container"
Index: src/renderer/features/changes/components/diff-full-page-view/diff-full-page-view.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/changes/components/diff-full-page-view/diff-full-page-view.tsx b/src/renderer/features/changes/components/diff-full-page-view/diff-full-page-view.tsx
--- a/src/renderer/features/changes/components/diff-full-page-view/diff-full-page-view.tsx	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/changes/components/diff-full-page-view/diff-full-page-view.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -1,50 +1,2 @@
-"use client"
-
-import { AnimatePresence, motion } from "motion/react"
-import { useEffect, useCallback } from "react"
-
-interface DiffFullPageViewProps {
-  isOpen: boolean
-  onClose: () => void
-  children: React.ReactNode
-}
-
-export function DiffFullPageView({
-  isOpen,
-  onClose,
-  children,
-}: DiffFullPageViewProps) {
-  // Close on Escape key
-  const handleKeyDown = useCallback(
-    (e: KeyboardEvent) => {
-      if (e.key === "Escape") {
-        e.stopPropagation() // Prevent ESC from bubbling to stop stream handler
-        onClose()
-      }
-    },
-    [onClose]
-  )
-
-  useEffect(() => {
-    if (isOpen) {
-      document.addEventListener("keydown", handleKeyDown)
-      return () => document.removeEventListener("keydown", handleKeyDown)
-    }
-  }, [isOpen, handleKeyDown])
-
-  return (
-    <AnimatePresence>
-      {isOpen && (
-        <motion.div
-          initial={{ opacity: 0 }}
-          animate={{ opacity: 1 }}
-          exit={{ opacity: 0 }}
-          transition={{ duration: 0.15, ease: [0.4, 0, 0.2, 1] }}
-          className="fixed inset-0 z-50 bg-background flex flex-col"
-        >
-          {children}
-        </motion.div>
-      )}
-    </AnimatePresence>
-  )
-}
+// Re-export from unified panel-container for backward compatibility
+export { FullPageView as DiffFullPageView } from "../../../../components/ui/panel-container"
Index: src/renderer/features/cowork/atoms.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/atoms.ts b/src/renderer/features/cowork/atoms.ts
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/atoms.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,228 @@
+import { atom } from "jotai"
+import { atomWithStorage, atomFamily } from "jotai/utils"
+
+// ============================================================================
+// Cowork Mode Toggle
+// ============================================================================
+
+// Master switch for Cowork mode (persisted)
+// When true, CoworkLayout is used instead of AgentsLayout
+export const isCoworkModeAtom = atomWithStorage<boolean>(
+  "cowork:enabled",
+  true, // Default to Cowork mode
+  undefined,
+  { getOnInit: true },
+)
+
+// ============================================================================
+// Right Panel State (Tasks + Files)
+// ============================================================================
+
+// Right panel width (persisted)
+export const coworkRightPanelWidthAtom = atomWithStorage<number>(
+  "cowork:rightPanelWidth",
+  320,
+  undefined,
+  { getOnInit: true },
+)
+
+// Right panel open state (persisted)
+export const coworkRightPanelOpenAtom = atomWithStorage<boolean>(
+  "cowork:rightPanelOpen",
+  true,
+  undefined,
+  { getOnInit: true },
+)
+
+// Track if user has manually closed the right panel (persisted)
+// Used to determine whether to auto-open panel when entering a chat
+export const coworkRightPanelUserClosedAtom = atomWithStorage<boolean>(
+  "cowork:rightPanelUserClosed",
+  false,
+  undefined,
+  { getOnInit: true },
+)
+
+// ============================================================================
+// Section Collapse State
+// ============================================================================
+
+// Task section expanded state (null = auto, true = expanded, false = collapsed)
+// Auto mode: collapsed when no tasks, expanded when has tasks
+export const taskSectionExpandedAtom = atom<boolean | null>(null)
+
+// Artifacts section expanded state (null = auto, true = expanded, false = collapsed)
+// Auto mode: collapsed when no artifacts, expanded when has artifacts
+export const artifactsSectionExpandedAtom = atom<boolean | null>(null)
+
+// ============================================================================
+// File Tree State
+// ============================================================================
+
+// Expanded folder paths in file tree (not persisted - resets on reload)
+export const fileTreeExpandedPathsAtom = atom<Set<string>>(new Set<string>())
+
+// Selected file in file tree (for highlighting)
+export const fileTreeSelectedPathAtom = atom<string | null>(null)
+
+// Search query in file tree
+export const fileTreeSearchQueryAtom = atom<string>("")
+
+// Saved expanded paths before search (to restore after clearing search)
+export const fileTreeSavedExpandedPathsAtom = atom<Set<string> | null>(null)
+
+// ============================================================================
+// Content Search State (Advanced Search)
+// ============================================================================
+
+// Whether advanced search (content search) mode is active
+export const contentSearchActiveAtom = atom<boolean>(false)
+
+// Content search query
+export const contentSearchQueryAtom = atom<string>("")
+
+// Content search file pattern filter (e.g., "*.ts", "*.{js,tsx}")
+export const contentSearchPatternAtom = atom<string>("")
+
+// Content search case sensitivity
+export const contentSearchCaseSensitiveAtom = atom<boolean>(false)
+
+// Content search loading state
+export const contentSearchLoadingAtom = atom<boolean>(false)
+
+// Content search result type
+export interface ContentSearchResult {
+  file: string
+  line: number
+  column: number
+  text: string
+  beforeContext?: string[]
+  afterContext?: string[]
+}
+
+// Content search results
+export const contentSearchResultsAtom = atom<ContentSearchResult[]>([])
+
+// Content search tool used (ripgrep or grep)
+export const contentSearchToolAtom = atom<string>("")
+
+// ============================================================================
+// Artifacts State (per chat - all sub-chats share the same artifacts)
+// ============================================================================
+
+// Context information for an artifact (files read, URLs visited)
+export interface ArtifactContext {
+  type: "file" | "url"
+  // File context
+  filePath?: string
+  toolType?: "Read" | "Glob" | "Grep"
+  // URL context
+  url?: string
+  title?: string
+}
+
+export interface Artifact {
+  path: string
+  description?: string
+  status: "created" | "modified" | "deleted"
+  timestamp: number
+  contexts?: ArtifactContext[]
+}
+
+// All artifacts storage - keyed by chatId (persisted to localStorage)
+const allArtifactsStorageAtom = atomWithStorage<Record<string, Artifact[]>>(
+  "cowork:artifacts",
+  {},
+  undefined,
+  { getOnInit: true }
+)
+
+// atomFamily to get/set artifacts per subChatId (session)
+// Supports both direct value and updater function: setArtifacts(newArr) or setArtifacts(prev => newArr)
+type ArtifactsSetter = Artifact[] | ((prev: Artifact[]) => Artifact[])
+
+export const artifactsAtomFamily = atomFamily((subChatId: string) =>
+  atom(
+    (get) => get(allArtifactsStorageAtom)[subChatId] ?? [],
+    (get, set, update: ArtifactsSetter) => {
+      const current = get(allArtifactsStorageAtom)
+      const prevArtifacts = current[subChatId] ?? []
+      // Support both direct value and updater function
+      const newArtifacts = typeof update === "function" ? update(prevArtifacts) : update
+      console.log("[Artifacts] Setting artifacts for subChatId:", subChatId, "count:", newArtifacts.length)
+      set(allArtifactsStorageAtom, { ...current, [subChatId]: newArtifacts })
+    }
+  )
+)
+
+// ============================================================================
+// File Preview State
+// ============================================================================
+
+export type FilePreviewDisplayMode = "dialog" | "side-peek" | "full-page"
+
+// Display mode for file preview (persisted)
+export const filePreviewDisplayModeAtom = atomWithStorage<FilePreviewDisplayMode>(
+  "cowork:filePreviewDisplayMode",
+  "dialog",
+  undefined,
+  { getOnInit: true }
+)
+
+// Current preview file path (null = closed)
+export const filePreviewPathAtom = atom<string | null>(null)
+
+// Line number to scroll to in preview (null = no scroll)
+export const filePreviewLineAtom = atom<number | null>(null)
+
+// Search highlight keyword for preview (null = no highlight)
+export const filePreviewHighlightAtom = atom<string | null>(null)
+
+// ============================================================================
+// File Reference Insertion (File Tree -> Chat Input)
+// ============================================================================
+
+// Pending file reference to insert into chat input
+// When set, chat input components should insert this file as a mention and clear the atom
+export interface PendingFileReference {
+  path: string
+  name: string
+  type: "file" | "folder"
+}
+
+export const pendingFileReferenceAtom = atom<PendingFileReference | null>(null)
+
+// File preview dialog open state (derived from path)
+export const filePreviewOpenAtom = atom(
+  (get) => get(filePreviewPathAtom) !== null,
+  (get, set, open: boolean) => {
+    if (!open) {
+      set(filePreviewPathAtom, null)
+    }
+  }
+)
+
+// ============================================================================
+// Code Editor State
+// ============================================================================
+
+// Editor mode: "view" for read-only preview, "edit" for Monaco editor
+export type EditorMode = "view" | "edit"
+export const editorModeAtom = atom<EditorMode>("view")
+
+// Whether current file has unsaved changes
+export const editorDirtyAtom = atom<boolean>(false)
+
+// Original content for dirty comparison (set when entering edit mode)
+export const editorOriginalContentAtom = atom<string>("")
+
+// Current editor content (synced with Monaco)
+export const editorContentAtom = atom<string>("")
+
+// Computed: reset editor state when preview closes
+export const resetEditorStateAtom = atom(null, (_get, set) => {
+  set(editorModeAtom, "view")
+  set(editorDirtyAtom, false)
+  set(editorOriginalContentAtom, "")
+  set(editorContentAtom, "")
+})
Index: src/renderer/features/cowork/file-preview/audio-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/audio-preview.tsx b/src/renderer/features/cowork/file-preview/audio-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/audio-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,73 @@
+import { useState } from "react"
+import { Music, VolumeX, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+
+interface AudioPreviewProps {
+  filePath: string
+  className?: string
+}
+
+export function AudioPreview({ filePath, className }: AudioPreviewProps) {
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+
+  // Use local-file:// protocol for streaming audio access
+  // Format: local-file://localhost/<absolute-path>
+  // Ensure path starts with / for proper URL format (Windows paths like D:\... need leading /)
+  const normalizedPath = filePath.startsWith("/") ? filePath : `/${filePath}`
+  const fileUrl = `local-file://localhost${normalizedPath}`
+  // Use cross-platform path split
+  const fileName = filePath.split(/[\\/]/).pop() || filePath
+
+  const handleLoadedData = () => {
+    setIsLoading(false)
+    setHasError(false)
+  }
+
+  const handleError = () => {
+    console.error("[AudioPreview] Failed to load:", fileUrl)
+    setIsLoading(false)
+    setHasError(true)
+  }
+
+  if (hasError) {
+    return (
+      <div className={cn("h-full w-full flex flex-col items-center justify-center gap-3 text-muted-foreground", className)}>
+        <VolumeX className="h-12 w-12 opacity-40" />
+        <p className="text-sm">Unable to play audio</p>
+        <p className="text-xs text-muted-foreground/60 max-w-[300px] truncate">{filePath}</p>
+      </div>
+    )
+  }
+
+  return (
+    <div className={cn("h-full w-full flex flex-col items-center justify-center gap-6 bg-linear-to-b from-muted/20 to-muted/40", className)}>
+      {/* Album art placeholder */}
+      <div className="w-48 h-48 rounded-lg bg-muted/50 flex items-center justify-center shadow-lg">
+        <Music className="h-20 w-20 text-muted-foreground/40" />
+      </div>
+
+      {/* File name */}
+      <p className="text-sm font-medium text-foreground max-w-[300px] truncate">
+        {fileName}
+      </p>
+
+      {/* Audio player */}
+      <div className="w-full max-w-md px-6 relative">
+        {isLoading && (
+          <div className="absolute inset-0 flex items-center justify-center">
+            <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+          </div>
+        )}
+        <audio
+          src={fileUrl}
+          className={cn("w-full", isLoading && "opacity-0")}
+          controls
+          controlsList="nodownload"
+          onLoadedData={handleLoadedData}
+          onError={handleError}
+        />
+      </div>
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/code-editor.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/code-editor.tsx b/src/renderer/features/cowork/file-preview/code-editor.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/code-editor.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,454 @@
+import { useCallback, useEffect, useRef } from "react"
+import Editor, { OnMount, OnChange, loader } from "@monaco-editor/react"
+import * as monaco from "monaco-editor"
+import { useAtom, useSetAtom } from "jotai"
+import { cn } from "../../../lib/utils"
+import { trpc } from "../../../lib/trpc"
+import {
+  editorDirtyAtom,
+  editorOriginalContentAtom,
+  editorContentAtom,
+} from "../atoms"
+import { Loader2 } from "lucide-react"
+
+// LSP is optional - stub it out if not available
+// TODO: Import real useLSPClient when LSP module is ported
+const useLSPClient = (_opts: { filePath: string; language: string; enabled: boolean }): {
+  isConnected: boolean
+  sendDidOpen: (content: string) => Promise<void>
+  sendDidChange: (content: string) => Promise<void>
+  sendDidClose: () => Promise<void>
+  registerProviders: (monaco: any, editor: any) => () => void
+} => ({
+  isConnected: false,
+  sendDidOpen: async () => {},
+  sendDidChange: async () => {},
+  sendDidClose: async () => {},
+  registerProviders: () => () => {},
+})
+
+// Configure Monaco workers for Electron environment
+import editorWorker from "monaco-editor/esm/vs/editor/editor.worker?worker"
+import jsonWorker from "monaco-editor/esm/vs/language/json/json.worker?worker"
+import cssWorker from "monaco-editor/esm/vs/language/css/css.worker?worker"
+import htmlWorker from "monaco-editor/esm/vs/language/html/html.worker?worker"
+import tsWorker from "monaco-editor/esm/vs/language/typescript/ts.worker?worker"
+
+// Set up Monaco environment for workers BEFORE loader.config
+// @ts-ignore - Monaco global environment setup
+self.MonacoEnvironment = {
+  getWorker(_: any, label: string) {
+    if (label === "json") {
+      return new jsonWorker()
+    }
+    if (label === "css" || label === "scss" || label === "less") {
+      return new cssWorker()
+    }
+    if (label === "html" || label === "handlebars" || label === "razor") {
+      return new htmlWorker()
+    }
+    if (label === "typescript" || label === "javascript") {
+      return new tsWorker()
+    }
+    return new editorWorker()
+  },
+}
+
+// Configure @monaco-editor/react to use locally installed monaco-editor
+// This prevents CDN loading which is blocked by CSP
+loader.config({ monaco })
+
+interface CodeEditorProps {
+  filePath: string
+  content: string
+  language?: string
+  className?: string
+  onSave?: () => void
+  onDirtyChange?: (dirty: boolean) => void
+}
+
+// Map file extensions to Monaco language identifiers
+function getLanguageFromFileName(fileName: string): string {
+  const ext = fileName.split(".").pop()?.toLowerCase() || ""
+
+  const langMap: Record<string, string> = {
+    // JavaScript/TypeScript
+    js: "javascript",
+    jsx: "javascript",
+    ts: "typescript",
+    tsx: "typescript",
+    mjs: "javascript",
+    cjs: "javascript",
+
+    // Web
+    html: "html",
+    htm: "html",
+    css: "css",
+    scss: "scss",
+    sass: "scss",
+    less: "less",
+    vue: "html",
+    svelte: "html",
+
+    // Data formats
+    json: "json",
+    jsonc: "json",
+    json5: "json",
+    yaml: "yaml",
+    yml: "yaml",
+    toml: "toml",
+    xml: "xml",
+    csv: "plaintext",
+
+    // Shell/Scripts
+    sh: "shell",
+    bash: "shell",
+    zsh: "shell",
+    fish: "shell",
+    ps1: "powershell",
+    bat: "bat",
+    cmd: "bat",
+
+    // Python
+    py: "python",
+    pyw: "python",
+    pyi: "python",
+
+    // Other languages
+    rb: "ruby",
+    php: "php",
+    java: "java",
+    kt: "kotlin",
+    kts: "kotlin",
+    swift: "swift",
+    go: "go",
+    rs: "rust",
+    c: "c",
+    h: "c",
+    cpp: "cpp",
+    cc: "cpp",
+    cxx: "cpp",
+    hpp: "cpp",
+    cs: "csharp",
+    fs: "fsharp",
+    scala: "scala",
+    clj: "clojure",
+    ex: "elixir",
+    exs: "elixir",
+    lua: "lua",
+    r: "r",
+    dart: "dart",
+    sql: "sql",
+    graphql: "graphql",
+    gql: "graphql",
+
+    // Config files
+    dockerfile: "dockerfile",
+    makefile: "makefile",
+    ini: "ini",
+    conf: "ini",
+    env: "shell",
+
+    // Markdown/Docs
+    md: "markdown",
+    mdx: "markdown",
+
+    // Misc
+    diff: "diff",
+    patch: "diff",
+    log: "plaintext",
+    txt: "plaintext",
+  }
+
+  // Handle special filenames - use cross-platform path split
+  const baseName = fileName.split(/[\\/]/).pop() || fileName
+  const specialFiles: Record<string, string> = {
+    Dockerfile: "dockerfile",
+    Makefile: "makefile",
+    Gemfile: "ruby",
+    Rakefile: "ruby",
+    Podfile: "ruby",
+  }
+
+  if (specialFiles[baseName]) {
+    return specialFiles[baseName]
+  }
+
+  return langMap[ext] || "plaintext"
+}
+
+/**
+ * CodeEditor - Monaco Editor wrapper for code editing
+ *
+ * Features:
+ * - Syntax highlighting for 50+ languages
+ * - Cmd+S / Ctrl+S to save
+ * - Dirty state tracking
+ * - Dark theme matching the app
+ * - LSP integration for TS/JS (completions, hover, diagnostics)
+ */
+export function CodeEditor({
+  filePath,
+  content: initialContent,
+  language: explicitLanguage,
+  className,
+  onSave,
+  onDirtyChange,
+}: CodeEditorProps) {
+  const editorRef = useRef<MonacoTypes.editor.IStandaloneCodeEditor | null>(null)
+  const monacoRef = useRef<typeof MonacoTypes | null>(null)
+  const lspCleanupRef = useRef<(() => void) | null>(null)
+
+  const [isDirty, setIsDirty] = useAtom(editorDirtyAtom)
+  const setOriginalContent = useSetAtom(editorOriginalContentAtom)
+  const [editorContent, setEditorContent] = useAtom(editorContentAtom)
+
+  // File save mutation
+  const saveFileMutation = trpc.files.writeFile.useMutation()
+
+  // Determine language from file extension or explicit prop
+  // Use cross-platform path split
+  const fileName = filePath.split(/[\\/]/).pop() || filePath
+  const language = explicitLanguage || getLanguageFromFileName(fileName)
+
+  // LSP client for TypeScript/JavaScript
+  const {
+    isConnected: lspConnected,
+    sendDidOpen,
+    sendDidChange,
+    sendDidClose,
+    registerProviders,
+  } = useLSPClient({
+    filePath,
+    language,
+    enabled: true,
+  })
+
+  // Initialize original content when component mounts or file changes
+  const initialContentRef = useRef(initialContent)
+  useEffect(() => {
+    // Only reset if content actually changed (new file)
+    if (initialContentRef.current !== initialContent) {
+      initialContentRef.current = initialContent
+      setOriginalContent(initialContent)
+      setEditorContent(initialContent)
+      setIsDirty(false)
+    }
+  }, [initialContent, setOriginalContent, setEditorContent, setIsDirty])
+
+  // Set initial content on mount
+  useEffect(() => {
+    setOriginalContent(initialContent)
+    setEditorContent(initialContent)
+    setIsDirty(false)
+    // eslint-disable-next-line react-hooks/exhaustive-deps
+  }, [])
+
+  // Handle editor mount
+  const handleEditorMount: OnMount = useCallback(
+    (editor, monaco) => {
+      editorRef.current = editor
+      monacoRef.current = monaco
+
+      // Register Cmd+S / Ctrl+S save command
+      editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => {
+        handleSave()
+      })
+
+      // Register LSP providers if connected
+      if (lspConnected) {
+        // Clean up previous providers
+        if (lspCleanupRef.current) {
+          lspCleanupRef.current()
+        }
+        // Register new providers
+        lspCleanupRef.current = registerProviders(monaco, editor)
+        // Notify LSP server that file is open
+        sendDidOpen(initialContent)
+      }
+
+      // Focus the editor
+      editor.focus()
+    },
+    [filePath, lspConnected, registerProviders, sendDidOpen, initialContent]
+  )
+
+  // Update LSP providers when connection state changes
+  const lspInitializedRef = useRef(false)
+  // Reset LSP initialized state when file changes
+  const prevFilePathRef = useRef(filePath)
+  useEffect(() => {
+    if (prevFilePathRef.current !== filePath) {
+      prevFilePathRef.current = filePath
+      lspInitializedRef.current = false
+    }
+  }, [filePath])
+
+  useEffect(() => {
+    if (editorRef.current && monacoRef.current && lspConnected && !lspInitializedRef.current) {
+      lspInitializedRef.current = true
+      // Clean up previous providers
+      if (lspCleanupRef.current) {
+        lspCleanupRef.current()
+      }
+      // Register new providers
+      lspCleanupRef.current = registerProviders(monacoRef.current, editorRef.current)
+      // Notify LSP server that file is open
+      sendDidOpen(initialContentRef.current)
+    }
+
+    return () => {
+      // Clean up providers on unmount
+      if (lspCleanupRef.current) {
+        lspCleanupRef.current()
+        lspCleanupRef.current = null
+      }
+      // Reset initialized flag so it can reinitialize on next mount
+      lspInitializedRef.current = false
+    }
+    // eslint-disable-next-line react-hooks/exhaustive-deps
+  }, [lspConnected])
+
+  // Notify LSP on content change (debounced)
+  const lspUpdateTimeoutRef = useRef<NodeJS.Timeout | null>(null)
+  const sendDidChangeRef = useRef(sendDidChange)
+  sendDidChangeRef.current = sendDidChange
+
+  useEffect(() => {
+    if (!lspConnected || !editorContent) return
+
+    // Clear previous timeout
+    if (lspUpdateTimeoutRef.current) {
+      clearTimeout(lspUpdateTimeoutRef.current)
+    }
+
+    // Debounce LSP updates
+    lspUpdateTimeoutRef.current = setTimeout(() => {
+      sendDidChangeRef.current(editorContent)
+    }, 300)
+
+    return () => {
+      if (lspUpdateTimeoutRef.current) {
+        clearTimeout(lspUpdateTimeoutRef.current)
+      }
+    }
+  }, [editorContent, lspConnected])
+
+  // Clean up LSP on unmount
+  const sendDidCloseRef = useRef(sendDidClose)
+  sendDidCloseRef.current = sendDidClose
+
+  useEffect(() => {
+    return () => {
+      sendDidCloseRef.current()
+    }
+  }, [])
+
+  // Handle content changes
+  const handleChange: OnChange = useCallback(
+    (value) => {
+      if (value !== undefined) {
+        setEditorContent(value)
+        const dirty = value !== initialContent
+        setIsDirty(dirty)
+        onDirtyChange?.(dirty)
+      }
+    },
+    [initialContent, setEditorContent, setIsDirty, onDirtyChange]
+  )
+
+  // Handle save
+  const handleSave = useCallback(async () => {
+    if (!isDirty || !editorContent) return
+
+    try {
+      await saveFileMutation.mutateAsync({
+        path: filePath,
+        content: editorContent,
+      })
+
+      // Update original content to current content
+      setOriginalContent(editorContent)
+      setIsDirty(false)
+      onDirtyChange?.(false)
+      onSave?.()
+
+      console.log("[CodeEditor] File saved:", filePath)
+    } catch (error) {
+      console.error("[CodeEditor] Failed to save file:", error)
+      // TODO: Show error toast
+    }
+  }, [
+    filePath,
+    editorContent,
+    isDirty,
+    saveFileMutation,
+    setOriginalContent,
+    setIsDirty,
+    onDirtyChange,
+    onSave,
+  ])
+
+  // Expose save function for external use
+  useEffect(() => {
+    // Store save function on window for dialog to call
+    ;(window as any).__codeEditorSave = handleSave
+    return () => {
+      delete (window as any).__codeEditorSave
+    }
+  }, [handleSave])
+
+  return (
+    <div className={cn("h-full w-full", className)}>
+      <Editor
+        height="100%"
+        language={language}
+        value={editorContent || initialContent}
+        theme="vs-dark"
+        onMount={handleEditorMount}
+        onChange={handleChange}
+        loading={
+          <div className="flex items-center justify-center h-full">
+            <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+          </div>
+        }
+        options={{
+          fontSize: 13,
+          fontFamily: "'JetBrains Mono', 'Fira Code', 'SF Mono', Menlo, monospace",
+          fontLigatures: true,
+          minimap: { enabled: false },
+          lineNumbers: "on",
+          scrollBeyondLastLine: false,
+          wordWrap: "on",
+          automaticLayout: true,
+          tabSize: 2,
+          insertSpaces: true,
+          padding: { top: 16, bottom: 16 },
+          renderWhitespace: "selection",
+          bracketPairColorization: { enabled: true },
+          guides: {
+            bracketPairs: true,
+            indentation: true,
+          },
+          smoothScrolling: true,
+          cursorBlinking: "smooth",
+          cursorSmoothCaretAnimation: "on",
+          // Accessibility
+          accessibilitySupport: "auto",
+          // Performance
+          renderValidationDecorations: "on",
+          // Scroll
+          scrollbar: {
+            vertical: "auto",
+            horizontal: "auto",
+            verticalScrollbarSize: 10,
+            horizontalScrollbarSize: 10,
+          },
+        }}
+      />
+    </div>
+  )
+}
+
+// Export language detection helper for use elsewhere
+export { getLanguageFromFileName }
Index: src/renderer/features/cowork/file-preview/excel-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/excel-preview.tsx b/src/renderer/features/cowork/file-preview/excel-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/excel-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,153 @@
+import { useEffect, useState } from "react"
+import { Table2, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+import { trpc } from "../../../lib/trpc"
+
+interface ExcelPreviewProps {
+  filePath: string
+  className?: string
+}
+
+interface SheetData {
+  name: string
+  data: string[][]
+}
+
+export function ExcelPreview({ filePath, className }: ExcelPreviewProps) {
+  const [sheets, setSheets] = useState<SheetData[]>([])
+  const [activeSheet, setActiveSheet] = useState(0)
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+  const [errorMessage, setErrorMessage] = useState("")
+
+  // Read file as binary via tRPC
+  const { data, error: fetchError } = trpc.files.readBinaryFile.useQuery(
+    { path: filePath, maxSize: 50 * 1024 * 1024 }, // 50MB max
+    { staleTime: 30000 }
+  )
+
+  useEffect(() => {
+    if (fetchError) {
+      setHasError(true)
+      setErrorMessage(fetchError.message)
+      setIsLoading(false)
+      return
+    }
+
+    if (!data) return
+
+    const parseExcel = async () => {
+      try {
+        // Dynamically import xlsx
+        const XLSX = await import("xlsx")
+
+        // Convert base64 to ArrayBuffer
+        const binaryString = atob(data.base64)
+        const bytes = new Uint8Array(binaryString.length)
+        for (let i = 0; i < binaryString.length; i++) {
+          bytes[i] = binaryString.charCodeAt(i)
+        }
+
+        // Parse the workbook
+        const workbook = XLSX.read(bytes, { type: "array" })
+
+        // Convert each sheet to array of arrays
+        const parsedSheets: SheetData[] = workbook.SheetNames.map((name) => {
+          const sheet = workbook.Sheets[name]
+          const data = XLSX.utils.sheet_to_json<string[]>(sheet, { header: 1 })
+          return { name, data: data as string[][] }
+        })
+
+        setSheets(parsedSheets)
+        setIsLoading(false)
+        setHasError(false)
+      } catch (err) {
+        console.error("[ExcelPreview] Failed to parse:", err)
+        setHasError(true)
+        setErrorMessage(err instanceof Error ? err.message : "Parse failed")
+        setIsLoading(false)
+      }
+    }
+
+    parseExcel()
+  }, [data, fetchError])
+
+  if (hasError) {
+    return (
+      <div className={cn("h-full w-full flex flex-col items-center justify-center gap-3 text-muted-foreground", className)}>
+        <Table2 className="h-12 w-12 opacity-40" />
+        <p className="text-sm">Unable to preview Excel file</p>
+        {errorMessage && (
+          <p className="text-xs text-muted-foreground/60 max-w-[300px] text-center">
+            {errorMessage}
+          </p>
+        )}
+      </div>
+    )
+  }
+
+  if (isLoading) {
+    return (
+      <div className={cn("h-full w-full flex items-center justify-center", className)}>
+        <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
+      </div>
+    )
+  }
+
+  const currentSheet = sheets[activeSheet]
+
+  return (
+    <div className={cn("h-full w-full flex flex-col", className)}>
+      {/* Sheet tabs */}
+      {sheets.length > 1 && (
+        <div className="flex items-center gap-1 p-2 border-b bg-muted/30 overflow-x-auto">
+          {sheets.map((sheet, index) => (
+            <button
+              key={sheet.name}
+              onClick={() => setActiveSheet(index)}
+              className={cn(
+                "px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors",
+                index === activeSheet
+                  ? "bg-primary text-primary-foreground"
+                  : "bg-muted hover:bg-muted/80 text-muted-foreground"
+              )}
+            >
+              {sheet.name}
+            </button>
+          ))}
+        </div>
+      )}
+
+      {/* Table */}
+      <div className="flex-1 overflow-auto">
+        {currentSheet && currentSheet.data.length > 0 ? (
+          <table className="w-full border-collapse text-sm">
+            <tbody>
+              {currentSheet.data.map((row, rowIndex) => (
+                <tr key={rowIndex} className={rowIndex === 0 ? "bg-muted/50 font-medium" : ""}>
+                  {/* Row number */}
+                  <td className="px-2 py-1.5 border border-border bg-muted/30 text-muted-foreground text-xs text-center min-w-[40px]">
+                    {rowIndex + 1}
+                  </td>
+                  {row.map((cell, cellIndex) => (
+                    <td
+                      key={cellIndex}
+                      className="px-2 py-1.5 border border-border min-w-[80px] max-w-[300px] truncate"
+                      title={String(cell ?? "")}
+                    >
+                      {cell ?? ""}
+                    </td>
+                  ))}
+                </tr>
+              ))}
+            </tbody>
+          </table>
+        ) : (
+          <div className="flex items-center justify-center h-full text-muted-foreground">
+            <p className="text-sm">Empty sheet</p>
+          </div>
+        )}
+      </div>
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/file-preview-dialog.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/file-preview-dialog.tsx b/src/renderer/features/cowork/file-preview/file-preview-dialog.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/file-preview-dialog.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,423 @@
+import { useAtom, useSetAtom } from "jotai"
+import { useCallback, useState } from "react"
+import { X, ExternalLink, Maximize2, Minimize2, Pencil, Save, Eye } from "lucide-react"
+import { cn } from "../../../lib/utils"
+import { isMacOS } from "../../../lib/utils/platform"
+import { Button } from "../../../components/ui/button"
+import { Dialog, DialogContent, DialogTitle, DialogDescription } from "../../../components/ui/dialog"
+import { VisuallyHidden } from "@radix-ui/react-visually-hidden"
+import {
+  AlertDialog,
+  AlertDialogAction,
+  AlertDialogCancel,
+  AlertDialogContent,
+  AlertDialogDescription,
+  AlertDialogFooter,
+  AlertDialogHeader,
+  AlertDialogTitle,
+} from "../../../components/ui/alert-dialog"
+import { getFileIconByExtension } from "../../agents/mentions/agents-file-mention"
+import { FilePreview } from "./file-preview"
+import { trpc } from "../../../lib/trpc"
+import {
+  filePreviewPathAtom,
+  filePreviewOpenAtom,
+  filePreviewDisplayModeAtom,
+  filePreviewLineAtom,
+  filePreviewHighlightAtom,
+  editorModeAtom,
+  editorDirtyAtom,
+  resetEditorStateAtom,
+} from "../atoms"
+
+// File types that support editing
+const EDITABLE_EXTENSIONS = new Set([
+  // JavaScript/TypeScript
+  "js", "jsx", "ts", "tsx", "mjs", "cjs",
+  // Web
+  "css", "scss", "sass", "less", "vue", "svelte",
+  // Data formats
+  "json", "jsonc", "json5", "yaml", "yml", "toml", "xml",
+  // Shell/Scripts
+  "sh", "bash", "zsh", "fish", "ps1", "bat", "cmd",
+  // Python
+  "py", "pyw", "pyi",
+  // Other languages
+  "rb", "php", "java", "kt", "kts", "swift", "go", "rs",
+  "c", "h", "cpp", "cc", "cxx", "hpp", "cs", "fs",
+  "scala", "clj", "ex", "exs", "lua", "r", "dart", "sql",
+  // Config files
+  "ini", "conf", "env", "gitignore", "editorconfig",
+  // Docs
+  "md", "mdx", "txt", "rst",
+])
+
+function isFileEditable(fileName: string): boolean {
+  const ext = fileName.split(".").pop()?.toLowerCase() || ""
+  return EDITABLE_EXTENSIONS.has(ext)
+}
+
+interface FilePreviewDialogProps {
+  className?: string
+}
+
+export function FilePreviewDialog({ className }: FilePreviewDialogProps) {
+  const [open, setOpen] = useAtom(filePreviewOpenAtom)
+  const [filePath, setFilePath] = useAtom(filePreviewPathAtom)
+  const [displayMode, setDisplayMode] = useAtom(filePreviewDisplayModeAtom)
+  const [scrollToLine, setScrollToLine] = useAtom(filePreviewLineAtom)
+  const [highlightText, setHighlightText] = useAtom(filePreviewHighlightAtom)
+  const [editorMode, setEditorMode] = useAtom(editorModeAtom)
+  const [isDirty, setIsDirty] = useAtom(editorDirtyAtom)
+  const resetEditorState = useSetAtom(resetEditorStateAtom)
+
+  const [showUnsavedDialog, setShowUnsavedDialog] = useState(false)
+  const [pendingCloseAction, setPendingCloseAction] = useState<(() => void) | null>(null)
+
+  // Use cross-platform path split
+  const pathParts = filePath?.split(/[\\/]/) || []
+  const fileName = pathParts.pop() || ""
+  const dirPath = pathParts.join("/") || ""
+  const FileIcon = fileName ? (getFileIconByExtension(fileName) ?? null) : null
+  const canEdit = fileName ? isFileEditable(fileName) : false
+  const isEditing = editorMode === "edit"
+
+  // Handle close with unsaved changes check
+  const handleClose = useCallback(() => {
+    if (isDirty) {
+      setPendingCloseAction(() => () => {
+        resetEditorState()
+        setFilePath(null)
+        setScrollToLine(null)
+        setHighlightText(null)
+      })
+      setShowUnsavedDialog(true)
+    } else {
+      resetEditorState()
+      setFilePath(null)
+      setScrollToLine(null)
+      setHighlightText(null)
+    }
+  }, [isDirty, resetEditorState, setFilePath, setScrollToLine, setHighlightText])
+
+  // Toggle between view and edit mode
+  const handleToggleEdit = useCallback(() => {
+    if (isEditing && isDirty) {
+      // Switching from edit to view with unsaved changes
+      setPendingCloseAction(() => () => {
+        setEditorMode("view")
+        setIsDirty(false)
+      })
+      setShowUnsavedDialog(true)
+    } else {
+      setEditorMode(isEditing ? "view" : "edit")
+    }
+  }, [isEditing, isDirty, setEditorMode, setIsDirty])
+
+  // Handle save
+  const handleSave = useCallback(() => {
+    // Call the save function exposed by CodeEditor
+    const saveFunc = (window as any).__codeEditorSave
+    if (saveFunc) {
+      saveFunc()
+    }
+  }, [])
+
+  // Handle unsaved dialog actions
+  const handleDiscardChanges = useCallback(() => {
+    setShowUnsavedDialog(false)
+    setIsDirty(false)
+    if (pendingCloseAction) {
+      pendingCloseAction()
+      setPendingCloseAction(null)
+    }
+  }, [pendingCloseAction, setIsDirty])
+
+  const handleSaveAndClose = useCallback(async () => {
+    setShowUnsavedDialog(false)
+    handleSave()
+    // Wait a bit for save to complete, then execute pending action
+    setTimeout(() => {
+      if (pendingCloseAction) {
+        pendingCloseAction()
+        setPendingCloseAction(null)
+      }
+    }, 100)
+  }, [pendingCloseAction, handleSave])
+
+  const handleCancelClose = useCallback(() => {
+    setShowUnsavedDialog(false)
+    setPendingCloseAction(null)
+  }, [])
+
+  const openInFinderMutation = trpc.external.openInFinder.useMutation()
+
+  const handleOpenExternal = () => {
+    if (filePath) {
+      openInFinderMutation.mutate(filePath)
+    }
+  }
+
+  const handleToggleFullscreen = () => {
+    setDisplayMode(displayMode === "full-page" ? "dialog" : "full-page")
+  }
+
+  // Callback when dirty state changes in editor
+  const handleDirtyChange = useCallback((dirty: boolean) => {
+    setIsDirty(dirty)
+  }, [setIsDirty])
+
+  // Callback when file is saved
+  const handleFileSaved = useCallback(() => {
+    // Optionally show a toast or notification
+    console.log("[FilePreviewDialog] File saved")
+  }, [])
+
+  if (!filePath) return null
+
+  const isMac = isMacOS()
+
+  // Edit/Save button component
+  const EditSaveButton = () => {
+    if (!canEdit) return null
+
+    if (isEditing) {
+      return (
+        <>
+          <Button
+            variant="ghost"
+            size="icon"
+            className={cn("h-7 w-7", isDirty && "text-yellow-500")}
+            onClick={handleSave}
+            disabled={!isDirty}
+            title={isDirty ? "Save (Cmd+S)" : "No changes to save"}
+          >
+            <Save className="h-4 w-4" />
+          </Button>
+
+          <Button
+            variant="ghost"
+            size="icon"
+            className="h-7 w-7"
+            onClick={handleToggleEdit}
+            title="Switch to View Mode"
+          >
+            <Eye className="h-4 w-4" />
+          </Button>
+        </>
+      )
+    }
+
+    return (
+      <Button
+        variant="ghost"
+        size="icon"
+        className="h-7 w-7"
+        onClick={handleToggleEdit}
+        title="Edit File"
+      >
+        <Pencil className="h-4 w-4" />
+      </Button>
+    )
+  }
+
+  // Unsaved changes dialog
+  const UnsavedChangesDialog = () => (
+    <AlertDialog open={showUnsavedDialog} onOpenChange={setShowUnsavedDialog}>
+      <AlertDialogContent>
+        <AlertDialogHeader>
+          <AlertDialogTitle>Unsaved Changes</AlertDialogTitle>
+          <AlertDialogDescription>
+            You have unsaved changes. Do you want to save them before closing?
+          </AlertDialogDescription>
+        </AlertDialogHeader>
+        <AlertDialogFooter>
+          <AlertDialogCancel onClick={handleCancelClose}>Cancel</AlertDialogCancel>
+          <AlertDialogAction
+            className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
+            onClick={handleDiscardChanges}
+          >
+            Discard
+          </AlertDialogAction>
+          <AlertDialogAction onClick={handleSaveAndClose}>Save</AlertDialogAction>
+        </AlertDialogFooter>
+      </AlertDialogContent>
+    </AlertDialog>
+  )
+
+  // Full page mode
+  if (displayMode === "full-page") {
+    return (
+      <div className={cn("fixed inset-0 z-50 bg-background flex flex-col", className)}>
+        {/* Header */}
+        <div className="flex items-center justify-between px-4 py-2 border-b bg-muted/30">
+          {/* macOS: Left side has close + fullscreen buttons */}
+          {isMac && (
+            <div className="flex items-center gap-1">
+              <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleClose} title="Close">
+                <X className="h-4 w-4" />
+              </Button>
+
+              <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleToggleFullscreen} title="Exit Fullscreen">
+                <Minimize2 className="h-4 w-4" />
+              </Button>
+            </div>
+          )}
+
+          {/* File info - center on macOS, left on Windows */}
+          <div className={cn(
+            "flex items-center gap-2 min-w-0",
+            isMac && "flex-1 justify-center"
+          )}>
+            {FileIcon && <FileIcon className="h-4 w-4 text-muted-foreground flex-shrink-0" />}
+            <span className="text-sm font-medium truncate">{fileName}</span>
+            {dirPath && (
+              <span className="text-xs text-muted-foreground truncate hidden sm:block">
+                {dirPath}
+              </span>
+            )}
+          </div>
+
+          {/* macOS: Right side has edit/save + "Show in Finder" */}
+          {isMac ? (
+            <div className="flex items-center gap-1">
+              <EditSaveButton />
+              <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleOpenExternal} title="Show in Finder">
+                <ExternalLink className="h-4 w-4" />
+              </Button>
+            </div>
+          ) : (
+            /* Windows: Right side has all buttons - edit/save, external, fullscreen, close */
+            <div className="flex items-center gap-1">
+              <EditSaveButton />
+              <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleOpenExternal} title="Show in Explorer">
+                <ExternalLink className="h-4 w-4" />
+              </Button>
+
+              <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleToggleFullscreen} title="Exit Fullscreen">
+                <Minimize2 className="h-4 w-4" />
+              </Button>
+
+              <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleClose} title="Close">
+                <X className="h-4 w-4" />
+              </Button>
+            </div>
+          )}
+        </div>
+
+        {/* Content */}
+        <div className="flex-1 overflow-hidden">
+          <FilePreview
+            filePath={filePath}
+            editable={isEditing}
+            onSave={handleFileSaved}
+            onDirtyChange={handleDirtyChange}
+            scrollToLine={scrollToLine}
+            highlightText={highlightText}
+          />
+        </div>
+
+        <UnsavedChangesDialog />
+      </div>
+    )
+  }
+
+  // Dialog mode (default)
+  return (
+    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && handleClose()}>
+      <DialogContent
+        className={cn(
+          "max-w-4xl w-[90vw] h-[80vh] p-0 gap-0 flex flex-col overflow-hidden",
+          className
+        )}
+        showCloseButton={false}
+        aria-describedby={undefined}
+      >
+          {/* Accessibility: Hidden title for screen readers */}
+          <VisuallyHidden>
+            <DialogTitle>File Preview: {fileName}</DialogTitle>
+          </VisuallyHidden>
+
+          {/* Header */}
+          <div className="flex items-center justify-between px-4 py-2 border-b bg-muted/30 flex-shrink-0">
+            {/* macOS: Left side has close + fullscreen buttons */}
+            {isMac && (
+              <div className="flex items-center gap-1">
+                <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleClose} title="Close">
+                  <X className="h-4 w-4" />
+                </Button>
+
+                <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleToggleFullscreen} title="Fullscreen">
+                  <Maximize2 className="h-4 w-4" />
+                </Button>
+              </div>
+            )}
+
+            {/* File info - center on macOS, left on Windows */}
+            <div className={cn(
+              "flex items-center gap-2 min-w-0",
+              isMac && "flex-1 justify-center"
+            )}>
+              {FileIcon && <FileIcon className="h-4 w-4 text-muted-foreground flex-shrink-0" />}
+              <span className="text-sm font-medium truncate">{fileName}</span>
+              {dirPath && (
+                <span className="text-xs text-muted-foreground truncate hidden sm:block">
+                  {dirPath}
+                </span>
+              )}
+            </div>
+
+            {/* macOS: Right side has edit/save + "Show in Finder" */}
+            {isMac ? (
+              <div className="flex items-center gap-1">
+                <EditSaveButton />
+                <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleOpenExternal} title="Show in Finder">
+                  <ExternalLink className="h-4 w-4" />
+                </Button>
+              </div>
+            ) : (
+              /* Windows: Right side has all buttons - edit/save, external, fullscreen, close */
+              <div className="flex items-center gap-1">
+                <EditSaveButton />
+                <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleOpenExternal} title="Show in Explorer">
+                  <ExternalLink className="h-4 w-4" />
+                </Button>
+
+                <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleToggleFullscreen} title="Fullscreen">
+                  <Maximize2 className="h-4 w-4" />
+                </Button>
+
+                <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleClose} title="Close">
+                  <X className="h-4 w-4" />
+                </Button>
+              </div>
+            )}
+          </div>
+
+          {/* Content */}
+          <div className="flex-1 overflow-hidden">
+            <FilePreview
+              filePath={filePath}
+              editable={isEditing}
+              onSave={handleFileSaved}
+              onDirtyChange={handleDirtyChange}
+              scrollToLine={scrollToLine}
+              highlightText={highlightText}
+            />
+          </div>
+
+          <UnsavedChangesDialog />
+        </DialogContent>
+    </Dialog>
+  )
+}
+
+// Hook to open file preview
+export function useFilePreview() {
+  const [, setFilePath] = useAtom(filePreviewPathAtom)
+
+  return {
+    openPreview: (path: string) => setFilePath(path),
+    closePreview: () => setFilePath(null),
+  }
+}
Index: src/renderer/features/cowork/file-preview/file-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/file-preview.tsx b/src/renderer/features/cowork/file-preview/file-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/file-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,224 @@
+import { useMemo } from "react"
+import { FileQuestion, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+import { trpc } from "../../../lib/trpc"
+import { TextPreview } from "./text-preview"
+import { MarkdownPreview } from "./markdown-preview"
+import { ImagePreview } from "./image-preview"
+import { PdfPreview } from "./pdf-preview"
+import { VideoPreview } from "./video-preview"
+import { AudioPreview } from "./audio-preview"
+import { WordPreview } from "./word-preview"
+import { ExcelPreview } from "./excel-preview"
+import { PptPreview } from "./ppt-preview"
+import { HtmlPreview } from "./html-preview"
+
+interface FilePreviewProps {
+  filePath: string
+  className?: string
+  /** Enable editing mode for text files */
+  editable?: boolean
+  /** Callback when file is saved */
+  onSave?: () => void
+  /** Callback when dirty state changes */
+  onDirtyChange?: (dirty: boolean) => void
+  /** Line number to scroll to (for text files) */
+  scrollToLine?: number | null
+  /** Text to highlight in the content (for text files) */
+  highlightText?: string | null
+}
+
+type FileType = "text" | "markdown" | "html" | "image" | "pdf" | "video" | "audio" | "word" | "excel" | "ppt" | "unsupported"
+
+// Determine file type from extension
+function getFileType(fileName: string): FileType {
+  const ext = fileName.split(".").pop()?.toLowerCase() || ""
+
+  // Markdown files
+  if (["md", "mdx", "markdown"].includes(ext)) {
+    return "markdown"
+  }
+
+  // HTML files
+  if (["html", "htm"].includes(ext)) {
+    return "html"
+  }
+
+  // Image files
+  if (["png", "jpg", "jpeg", "gif", "webp", "svg", "ico", "bmp", "avif", "tiff", "heic", "heif"].includes(ext)) {
+    return "image"
+  }
+
+  // PDF files
+  if (ext === "pdf") {
+    return "pdf"
+  }
+
+  // Video files
+  if (["mp4", "webm", "mov", "avi", "mkv", "m4v", "ogv", "3gp"].includes(ext)) {
+    return "video"
+  }
+
+  // Audio files
+  if (["mp3", "wav", "ogg", "flac", "m4a", "aac", "wma", "opus", "aiff"].includes(ext)) {
+    return "audio"
+  }
+
+  // Word documents
+  if (["docx", "doc"].includes(ext)) {
+    return "word"
+  }
+
+  // Excel spreadsheets
+  if (["xlsx", "xls", "xlsm", "xlsb"].includes(ext)) {
+    return "excel"
+  }
+
+  // PowerPoint presentations
+  if (["pptx", "ppt"].includes(ext)) {
+    return "ppt"
+  }
+
+  // Text/code files
+  const textExtensions = [
+    // JavaScript/TypeScript
+    "js", "jsx", "ts", "tsx", "mjs", "cjs",
+    // Web
+    "css", "scss", "sass", "less", "vue", "svelte",
+    // Data formats
+    "json", "jsonc", "json5", "yaml", "yml", "toml", "xml", "csv",
+    // Shell/Scripts
+    "sh", "bash", "zsh", "fish", "ps1", "bat", "cmd",
+    // Python
+    "py", "pyw", "pyi",
+    // Other languages
+    "rb", "php", "java", "kt", "kts", "swift", "go", "rs",
+    "c", "h", "cpp", "cc", "cxx", "hpp", "cs", "fs",
+    "scala", "clj", "ex", "exs", "erl", "hs", "lua",
+    "r", "jl", "dart", "zig", "nim", "v", "d", "ml",
+    "sql", "graphql", "gql",
+    // Config files
+    "dockerfile", "makefile", "cmake", "gradle", "tf", "hcl",
+    "ini", "conf", "env", "gitignore", "editorconfig",
+    // Docs
+    "rst", "tex", "adoc",
+    // Misc
+    "diff", "patch", "log", "txt",
+  ]
+
+  if (textExtensions.includes(ext)) {
+    return "text"
+  }
+
+  // Check for common text file names without extensions
+  // Use cross-platform path split
+  const baseName = fileName.split(/[\\/]/).pop()?.toLowerCase() || ""
+  const textFileNames = [
+    "dockerfile", "makefile", "cmakelists", "gemfile", "rakefile",
+    "podfile", "fastfile", "vagrantfile", "brewfile", "readme",
+    "license", "changelog", "contributing", "authors", "todo",
+  ]
+
+  if (textFileNames.some((name) => baseName.startsWith(name))) {
+    return "text"
+  }
+
+  return "unsupported"
+}
+
+export function FilePreview({ filePath, className, editable = false, onSave, onDirtyChange, scrollToLine, highlightText }: FilePreviewProps) {
+  // Use cross-platform path split for fileName
+  const fileName = filePath.split(/[\\/]/).pop() || filePath
+  const fileType = useMemo(() => getFileType(fileName), [fileName])
+
+  // Read file content for text-based previews only
+  const { data: content, isLoading, error } = trpc.files.readFile.useQuery(
+    { path: filePath },
+    {
+      enabled: fileType === "text" || fileType === "markdown" || fileType === "html",
+      staleTime: 30000,
+    }
+  )
+
+  // Loading state (only for text-based files that need tRPC)
+  if (isLoading && (fileType === "text" || fileType === "markdown" || fileType === "html")) {
+    return (
+      <div className={cn("h-full flex items-center justify-center", className)}>
+        <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+      </div>
+    )
+  }
+
+  // Error state (only for text-based files)
+  if (error && (fileType === "text" || fileType === "markdown" || fileType === "html")) {
+    return (
+      <div className={cn("h-full flex flex-col items-center justify-center gap-2 text-destructive", className)}>
+        <FileQuestion className="h-8 w-8 opacity-60" />
+        <p className="text-sm">Unable to read file</p>
+        <p className="text-xs text-muted-foreground">{error.message}</p>
+      </div>
+    )
+  }
+
+  // Render appropriate preview based on file type
+  switch (fileType) {
+    case "markdown":
+      return (
+        <MarkdownPreview
+          content={content || ""}
+          className={className}
+          scrollToLine={scrollToLine}
+          highlightText={highlightText}
+        />
+      )
+
+    case "html":
+      return <HtmlPreview content={content || ""} fileName={fileName} className={className} />
+
+    case "text":
+      return (
+        <TextPreview
+          content={content || ""}
+          fileName={fileName}
+          className={className}
+          editable={editable}
+          filePath={filePath}
+          onSave={onSave}
+          onDirtyChange={onDirtyChange}
+          scrollToLine={scrollToLine}
+          highlightText={highlightText}
+        />
+      )
+
+    case "image":
+      return <ImagePreview filePath={filePath} className={className} />
+
+    case "pdf":
+      return <PdfPreview filePath={filePath} className={className} />
+
+    case "video":
+      return <VideoPreview filePath={filePath} className={className} />
+
+    case "audio":
+      return <AudioPreview filePath={filePath} className={className} />
+
+    case "word":
+      return <WordPreview filePath={filePath} className={className} />
+
+    case "excel":
+      return <ExcelPreview filePath={filePath} className={className} />
+
+    case "ppt":
+      return <PptPreview filePath={filePath} className={className} />
+
+    case "unsupported":
+    default:
+      return (
+        <div className={cn("h-full flex flex-col items-center justify-center gap-3 text-muted-foreground", className)}>
+          <FileQuestion className="h-12 w-12 opacity-40" />
+          <p className="text-sm">Preview not supported for this file type</p>
+          <p className="text-xs text-muted-foreground/60">{fileName}</p>
+        </div>
+      )
+  }
+}
Index: src/renderer/features/cowork/file-preview/html-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/html-preview.tsx b/src/renderer/features/cowork/file-preview/html-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/html-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,123 @@
+import { useEffect, useState, useRef } from "react"
+import { codeToHtml } from "shiki"
+import { cn } from "../../../lib/utils"
+import { Loader2, Code, Eye } from "lucide-react"
+
+interface HtmlPreviewProps {
+  content: string
+  fileName: string
+  className?: string
+}
+
+type TabType = "preview" | "source"
+
+export function HtmlPreview({ content, fileName, className }: HtmlPreviewProps) {
+  const [activeTab, setActiveTab] = useState<TabType>("preview")
+  const [highlightedHtml, setHighlightedHtml] = useState<string>("")
+  const [isHighlighting, setIsHighlighting] = useState(false)
+  const iframeRef = useRef<HTMLIFrameElement>(null)
+
+  // Syntax highlight for source view
+  useEffect(() => {
+    if (activeTab !== "source") return
+
+    let cancelled = false
+    setIsHighlighting(true)
+
+    async function highlight() {
+      try {
+        const result = await codeToHtml(content, {
+          lang: "html",
+          theme: "github-dark-default",
+        })
+
+        if (!cancelled) {
+          setHighlightedHtml(result)
+        }
+      } catch (err) {
+        console.error("Syntax highlighting error:", err)
+        if (!cancelled) {
+          // Fallback to plain text
+          setHighlightedHtml(
+            `<pre class="shiki"><code>${content
+              .replace(/&/g, "&amp;")
+              .replace(/</g, "&lt;")
+              .replace(/>/g, "&gt;")}</code></pre>`
+          )
+        }
+      } finally {
+        if (!cancelled) {
+          setIsHighlighting(false)
+        }
+      }
+    }
+
+    highlight()
+
+    return () => {
+      cancelled = true
+    }
+  }, [content, activeTab])
+
+  // Update iframe content when switching to preview
+  useEffect(() => {
+    if (activeTab !== "preview" || !iframeRef.current) return
+
+    const iframe = iframeRef.current
+    const doc = iframe.contentDocument || iframe.contentWindow?.document
+    if (doc) {
+      doc.open()
+      doc.write(content)
+      doc.close()
+    }
+  }, [content, activeTab])
+
+  const tabs: { id: TabType; label: string; icon: React.ReactNode }[] = [
+    { id: "preview", label: "Preview", icon: <Eye className="h-3.5 w-3.5" /> },
+    { id: "source", label: "Source", icon: <Code className="h-3.5 w-3.5" /> },
+  ]
+
+  return (
+    <div className={cn("h-full w-full flex flex-col", className)}>
+      {/* Tab bar */}
+      <div className="flex items-center justify-center gap-1 p-2 border-b bg-muted/30">
+        {tabs.map((tab) => (
+          <button
+            key={tab.id}
+            onClick={() => setActiveTab(tab.id)}
+            className={cn(
+              "flex items-center gap-1.5 px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors",
+              tab.id === activeTab
+                ? "bg-primary text-primary-foreground"
+                : "bg-muted hover:bg-muted/80 text-muted-foreground"
+            )}
+          >
+            {tab.icon}
+            {tab.label}
+          </button>
+        ))}
+      </div>
+
+      {/* Content */}
+      <div className="flex-1 overflow-hidden">
+        {activeTab === "preview" ? (
+          <iframe
+            ref={iframeRef}
+            className="w-full h-full border-0 bg-white"
+            sandbox="allow-scripts allow-same-origin"
+            title={`Preview: ${fileName}`}
+          />
+        ) : isHighlighting ? (
+          <div className="flex items-center justify-center h-full">
+            <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+          </div>
+        ) : (
+          <div
+            className="h-full overflow-auto text-sm [&_pre]:p-4 [&_pre]:m-0 [&_pre]:min-h-full [&_pre]:bg-transparent [&_code]:font-mono [&_code]:text-[13px] [&_code]:leading-relaxed"
+            dangerouslySetInnerHTML={{ __html: highlightedHtml }}
+          />
+        )}
+      </div>
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/image-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/image-preview.tsx b/src/renderer/features/cowork/file-preview/image-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/image-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,92 @@
+import { useState } from "react"
+import { ZoomIn, ZoomOut, RotateCw, ImageOff, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+import { Button } from "../../../components/ui/button"
+
+interface ImagePreviewProps {
+  filePath: string
+  className?: string
+}
+
+export function ImagePreview({ filePath, className }: ImagePreviewProps) {
+  const [scale, setScale] = useState(1)
+  const [rotation, setRotation] = useState(0)
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+
+  // Use local-file:// protocol for streaming file access
+  // Format: local-file://localhost/<absolute-path>
+  // Using "localhost" as hostname to prevent URL path normalization issues
+  // Ensure path starts with / for proper URL format (Windows paths like D:\... need leading /)
+  const normalizedPath = filePath.startsWith("/") ? filePath : `/${filePath}`
+  const fileUrl = `local-file://localhost${normalizedPath}`
+
+  const handleZoomIn = () => setScale((s) => Math.min(s + 0.25, 3))
+  const handleZoomOut = () => setScale((s) => Math.max(s - 0.25, 0.25))
+  const handleRotate = () => setRotation((r) => (r + 90) % 360)
+
+  const handleLoad = () => {
+    setIsLoading(false)
+    setHasError(false)
+  }
+
+  const handleError = () => {
+    console.error("[ImagePreview] Failed to load:", fileUrl)
+    setIsLoading(false)
+    setHasError(true)
+  }
+
+  if (hasError) {
+    return (
+      <div className={cn("h-full w-full flex flex-col items-center justify-center gap-3 text-muted-foreground", className)}>
+        <ImageOff className="h-12 w-12 opacity-40" />
+        <p className="text-sm">Unable to load image</p>
+        <p className="text-xs text-muted-foreground/60 max-w-[300px] truncate">{filePath}</p>
+      </div>
+    )
+  }
+
+  return (
+    <div className={cn("h-full w-full flex flex-col", className)}>
+      {/* Controls */}
+      <div className="flex items-center justify-center gap-1 p-2 border-b bg-muted/30">
+        <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleZoomOut} disabled={isLoading}>
+          <ZoomOut className="h-4 w-4" />
+        </Button>
+        <span className="text-xs text-muted-foreground w-12 text-center">
+          {Math.round(scale * 100)}%
+        </span>
+        <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleZoomIn} disabled={isLoading}>
+          <ZoomIn className="h-4 w-4" />
+        </Button>
+        <div className="w-px h-4 bg-border mx-1" />
+        <Button variant="ghost" size="icon" className="h-7 w-7" onClick={handleRotate} disabled={isLoading}>
+          <RotateCw className="h-4 w-4" />
+        </Button>
+      </div>
+
+      {/* Image container */}
+      <div className="flex-1 overflow-auto flex items-center justify-center p-4 bg-[#1a1a1a] relative">
+        {isLoading && (
+          <div className="absolute inset-0 flex items-center justify-center">
+            <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
+          </div>
+        )}
+        <img
+          src={fileUrl}
+          alt="Preview"
+          className={cn(
+            "max-w-full max-h-full object-contain transition-transform duration-200",
+            isLoading && "opacity-0"
+          )}
+          style={{
+            transform: `scale(${scale}) rotate(${rotation}deg)`,
+          }}
+          draggable={false}
+          onLoad={handleLoad}
+          onError={handleError}
+        />
+      </div>
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/index.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/index.ts b/src/renderer/features/cowork/file-preview/index.ts
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/index.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,13 @@
+export { FilePreview } from "./file-preview"
+export { FilePreviewDialog, useFilePreview } from "./file-preview-dialog"
+export { TextPreview } from "./text-preview"
+export { CodeEditor, getLanguageFromFileName } from "./code-editor"
+export { MarkdownPreview } from "./markdown-preview"
+export { HtmlPreview } from "./html-preview"
+export { ImagePreview } from "./image-preview"
+export { PdfPreview, PdfPreviewFallback } from "./pdf-preview"
+export { VideoPreview } from "./video-preview"
+export { AudioPreview } from "./audio-preview"
+export { WordPreview } from "./word-preview"
+export { ExcelPreview } from "./excel-preview"
+export { PptPreview } from "./ppt-preview"
Index: src/renderer/features/cowork/file-preview/markdown-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/markdown-preview.tsx b/src/renderer/features/cowork/file-preview/markdown-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/markdown-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,203 @@
+import { useEffect, useState, useRef, useCallback } from "react"
+import { codeToHtml } from "shiki"
+import { cn } from "../../../lib/utils"
+import { ChatMarkdownRenderer } from "../../../components/chat-markdown-renderer"
+import { Loader2, Code, Eye } from "lucide-react"
+
+interface MarkdownPreviewProps {
+  content: string
+  className?: string
+  /** Line number to scroll to (switches to source view) */
+  scrollToLine?: number | null
+  /** Text to highlight in the content */
+  highlightText?: string | null
+}
+
+type TabType = "preview" | "source"
+
+export function MarkdownPreview({ content, className, scrollToLine, highlightText }: MarkdownPreviewProps) {
+  // Auto-switch to source view when scrollToLine is provided
+  const [activeTab, setActiveTab] = useState<TabType>(scrollToLine ? "source" : "preview")
+  const [highlightedLines, setHighlightedLines] = useState<string[]>([])
+  const [isHighlighting, setIsHighlighting] = useState(false)
+  const containerRef = useRef<HTMLDivElement>(null)
+  const hasScrolledRef = useRef(false)
+
+  // Switch to source view when scrollToLine changes
+  useEffect(() => {
+    if (scrollToLine) {
+      setActiveTab("source")
+      hasScrolledRef.current = false
+    }
+  }, [scrollToLine])
+
+  // Split content into lines
+  const lines = content.split("\n")
+
+  // Syntax highlight for source view (line by line)
+  useEffect(() => {
+    if (activeTab !== "source") return
+
+    let cancelled = false
+    setIsHighlighting(true)
+    hasScrolledRef.current = false
+
+    async function highlight() {
+      try {
+        const result = await codeToHtml(content, {
+          lang: "markdown",
+          theme: "github-dark-default",
+        })
+
+        if (!cancelled) {
+          // Parse the HTML and extract line contents
+          const codeMatch = result.match(/<code[^>]*>([\s\S]*?)<\/code>/i)
+          if (codeMatch) {
+            const innerHtml = codeMatch[1]
+            const lineHtmls = innerHtml.split("\n")
+            setHighlightedLines(lineHtmls)
+          } else {
+            // Fallback: split plain content
+            setHighlightedLines(
+              lines.map((line) =>
+                line
+                  .replace(/&/g, "&amp;")
+                  .replace(/</g, "&lt;")
+                  .replace(/>/g, "&gt;") || "&nbsp;"
+              )
+            )
+          }
+        }
+      } catch (err) {
+        console.error("Syntax highlighting error:", err)
+        if (!cancelled) {
+          // Fallback to plain text
+          setHighlightedLines(
+            lines.map((line) =>
+              line
+                .replace(/&/g, "&amp;")
+                .replace(/</g, "&lt;")
+                .replace(/>/g, "&gt;") || "&nbsp;"
+            )
+          )
+        }
+      } finally {
+        if (!cancelled) {
+          setIsHighlighting(false)
+        }
+      }
+    }
+
+    highlight()
+
+    return () => {
+      cancelled = true
+    }
+  }, [content, activeTab])
+
+  // Scroll to line when specified
+  useEffect(() => {
+    if (scrollToLine && !isHighlighting && containerRef.current && !hasScrolledRef.current && activeTab === "source") {
+      const lineElement = containerRef.current.querySelector(`[data-line="${scrollToLine}"]`)
+      if (lineElement) {
+        requestAnimationFrame(() => {
+          lineElement.scrollIntoView({ behavior: "smooth", block: "center" })
+          hasScrolledRef.current = true
+        })
+      }
+    }
+  }, [scrollToLine, isHighlighting, highlightedLines, activeTab])
+
+  // Function to highlight text within a line
+  const highlightLineText = useCallback((lineHtml: string, searchText: string | null | undefined): string => {
+    if (!searchText) return lineHtml
+
+    const escaped = searchText.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
+    const regex = new RegExp(`(${escaped})`, "gi")
+
+    const parts = lineHtml.split(/(<[^>]+>)/g)
+    const result = parts.map((part) => {
+      if (part.startsWith("<")) return part
+      return part.replace(regex, '<mark class="bg-yellow-400/60 text-inherit rounded px-0.5">$1</mark>')
+    })
+    return result.join("")
+  }, [])
+
+  const tabs: { id: TabType; label: string; icon: React.ReactNode }[] = [
+    { id: "preview", label: "Preview", icon: <Eye className="h-3.5 w-3.5" /> },
+    { id: "source", label: "Source", icon: <Code className="h-3.5 w-3.5" /> },
+  ]
+
+  return (
+    <div className={cn("h-full w-full flex flex-col", className)}>
+      {/* Tab bar */}
+      <div className="flex items-center justify-center gap-1 p-2 border-b bg-muted/30">
+        {tabs.map((tab) => (
+          <button
+            key={tab.id}
+            onClick={() => setActiveTab(tab.id)}
+            className={cn(
+              "flex items-center gap-1.5 px-3 py-1.5 text-xs rounded-md whitespace-nowrap transition-colors",
+              tab.id === activeTab
+                ? "bg-primary text-primary-foreground"
+                : "bg-muted hover:bg-muted/80 text-muted-foreground"
+            )}
+          >
+            {tab.icon}
+            {tab.label}
+          </button>
+        ))}
+      </div>
+
+      {/* Content */}
+      <div className="flex-1 overflow-hidden">
+        {activeTab === "preview" ? (
+          <div className="h-full overflow-auto p-4">
+            <ChatMarkdownRenderer content={content} size="md" />
+          </div>
+        ) : isHighlighting ? (
+          <div className="flex items-center justify-center h-full">
+            <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+          </div>
+        ) : (
+          <div
+            ref={containerRef}
+            className="h-full overflow-auto font-mono text-[13px] leading-relaxed"
+          >
+            <table className="w-full border-collapse">
+              <tbody>
+                {highlightedLines.map((lineHtml, index) => {
+                  const lineNumber = index + 1
+                  const isTargetLine = scrollToLine === lineNumber
+                  const processedHtml = highlightLineText(lineHtml, highlightText)
+
+                  return (
+                    <tr
+                      key={lineNumber}
+                      data-line={lineNumber}
+                      className={cn(
+                        "group/line",
+                        isTargetLine && "bg-yellow-500/20"
+                      )}
+                    >
+                      {/* Line number */}
+                      <td className="w-12 text-right pr-3 select-none align-top text-muted-foreground/60 border-r border-border/40">
+                        <span className="text-xs tabular-nums">{lineNumber}</span>
+                      </td>
+
+                      {/* Code content */}
+                      <td
+                        className="pl-4 whitespace-pre"
+                        dangerouslySetInnerHTML={{ __html: processedHtml || "&nbsp;" }}
+                      />
+                    </tr>
+                  )
+                })}
+              </tbody>
+            </table>
+          </div>
+        )}
+      </div>
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/pdf-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/pdf-preview.tsx b/src/renderer/features/cowork/file-preview/pdf-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/pdf-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,70 @@
+import { useState } from "react"
+import { FileWarning, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+
+interface PdfPreviewProps {
+  filePath: string
+  className?: string
+}
+
+export function PdfPreview({ filePath, className }: PdfPreviewProps) {
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+
+  // Use local-file:// protocol for streaming PDF access
+  // Format: local-file://localhost/<absolute-path>
+  // Ensure path starts with / for proper URL format (Windows paths like D:\... need leading /)
+  const normalizedPath = filePath.startsWith("/") ? filePath : `/${filePath}`
+  const fileUrl = `local-file://localhost${normalizedPath}`
+
+  const handleLoad = () => {
+    setIsLoading(false)
+    setHasError(false)
+  }
+
+  const handleError = () => {
+    console.error("[PdfPreview] Failed to load:", fileUrl)
+    setIsLoading(false)
+    setHasError(true)
+  }
+
+  if (hasError) {
+    return <PdfPreviewFallback className={className} filePath={filePath} />
+  }
+
+  return (
+    <div className={cn("h-full w-full flex flex-col relative", className)}>
+      {isLoading && (
+        <div className="absolute inset-0 flex items-center justify-center bg-background z-10">
+          <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
+        </div>
+      )}
+      <iframe
+        src={fileUrl}
+        className="flex-1 w-full border-0 bg-white"
+        title="PDF Preview"
+        onLoad={handleLoad}
+        onError={handleError}
+      />
+    </div>
+  )
+}
+
+export function PdfPreviewFallback({ className, filePath }: { className?: string; filePath?: string }) {
+  return (
+    <div
+      className={cn(
+        "h-full w-full flex flex-col items-center justify-center text-muted-foreground gap-3",
+        className
+      )}
+    >
+      <FileWarning className="h-12 w-12 opacity-40" />
+      <p className="text-sm">PDF preview unavailable</p>
+      {filePath && (
+        <p className="text-xs text-muted-foreground/60 max-w-[300px] truncate">
+          {filePath}
+        </p>
+      )}
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/ppt-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/ppt-preview.tsx b/src/renderer/features/cowork/file-preview/ppt-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/ppt-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,305 @@
+import { useEffect, useRef, useState, useCallback } from "react"
+import { Presentation, Loader2, ExternalLink, ChevronLeft, ChevronRight } from "lucide-react"
+import { cn } from "../../../lib/utils"
+import { trpc } from "../../../lib/trpc"
+import { Button } from "../../../components/ui/button"
+
+interface PptPreviewProps {
+  filePath: string
+  className?: string
+}
+
+export function PptPreview({ filePath, className }: PptPreviewProps) {
+  const containerRef = useRef<HTMLDivElement>(null)
+  const slidesContainerRef = useRef<HTMLDivElement>(null)
+  const slidesRef = useRef<HTMLElement[]>([])
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+  const [errorMessage, setErrorMessage] = useState("")
+  const [currentSlide, setCurrentSlide] = useState(0)
+  const [totalSlides, setTotalSlides] = useState(0)
+  const [isAnimating, setIsAnimating] = useState(false)
+  const previewerRef = useRef<any>(null)
+
+  // Read file as binary via tRPC
+  const { data, error: fetchError } = trpc.files.readBinaryFile.useQuery(
+    { path: filePath, maxSize: 100 * 1024 * 1024 }, // 100MB max
+    { staleTime: 30000 }
+  )
+
+  // Animate slide transition
+  const animateSlideTransition = useCallback((fromIndex: number, toIndex: number, direction: number) => {
+    const slides = slidesRef.current
+    if (!slides.length || isAnimating) return
+
+    const fromSlide = slides[fromIndex]
+    const toSlide = slides[toIndex]
+    if (!fromSlide || !toSlide) return
+
+    setIsAnimating(true)
+
+    // Get slide width for animation offset
+    const slideWidth = fromSlide.offsetWidth
+
+    // Set up initial state for incoming slide
+    toSlide.style.display = 'block'
+    toSlide.style.position = 'absolute'
+    toSlide.style.left = `calc(50% + ${direction > 0 ? slideWidth : -slideWidth}px)`
+    toSlide.style.transform = 'translateX(-50%)'
+    toSlide.style.opacity = '0'
+    toSlide.style.transition = 'none'
+
+    // Force reflow
+    toSlide.offsetHeight
+
+    // Animate both slides
+    requestAnimationFrame(() => {
+      fromSlide.style.transition = 'left 0.3s ease-out, opacity 0.3s ease-out'
+      toSlide.style.transition = 'left 0.3s ease-out, opacity 0.3s ease-out'
+
+      fromSlide.style.left = `calc(50% + ${direction > 0 ? -slideWidth : slideWidth}px)`
+      fromSlide.style.opacity = '0'
+
+      toSlide.style.left = '50%'
+      toSlide.style.opacity = '1'
+
+      // Cleanup after animation
+      setTimeout(() => {
+        fromSlide.style.display = 'none'
+        fromSlide.style.left = '50%'
+        fromSlide.style.opacity = ''
+        fromSlide.style.transition = ''
+        fromSlide.style.position = 'absolute'
+
+        toSlide.style.transition = ''
+        toSlide.style.position = 'relative'
+
+        setIsAnimating(false)
+      }, 300)
+    })
+  }, [isAnimating])
+
+  // Navigation handlers
+  const goToSlide = useCallback((index: number, direction: number) => {
+    if (index >= 0 && index < totalSlides && index !== currentSlide && !isAnimating) {
+      animateSlideTransition(currentSlide, index, direction)
+      setCurrentSlide(index)
+    }
+  }, [totalSlides, currentSlide, isAnimating, animateSlideTransition])
+
+  const nextSlide = useCallback(() => {
+    goToSlide(currentSlide + 1, 1)
+  }, [currentSlide, goToSlide])
+
+  const prevSlide = useCallback(() => {
+    goToSlide(currentSlide - 1, -1)
+  }, [currentSlide, goToSlide])
+
+  // Keyboard navigation
+  useEffect(() => {
+    const handleKeyDown = (e: KeyboardEvent) => {
+      if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === ' ') {
+        e.preventDefault()
+        nextSlide()
+      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
+        e.preventDefault()
+        prevSlide()
+      }
+    }
+
+    window.addEventListener('keydown', handleKeyDown)
+    return () => window.removeEventListener('keydown', handleKeyDown)
+  }, [nextSlide, prevSlide])
+
+  // Initialize previewer and load PPTX when data is available
+  useEffect(() => {
+    if (fetchError) {
+      setHasError(true)
+      setErrorMessage(fetchError.message)
+      setIsLoading(false)
+      return
+    }
+
+    if (!data || !containerRef.current) return
+
+    const loadPptx = async () => {
+      try {
+        // Convert base64 to ArrayBuffer
+        const binaryString = atob(data.base64)
+        const bytes = new Uint8Array(binaryString.length)
+        for (let i = 0; i < binaryString.length; i++) {
+          bytes[i] = binaryString.charCodeAt(i)
+        }
+        const arrayBuffer = bytes.buffer
+
+        // Dynamically import pptx-preview
+        const { init } = await import("pptx-preview")
+
+        // Get container dimensions
+        const container = containerRef.current
+        if (!container) return
+
+        const rect = container.getBoundingClientRect()
+        // Use available space with some padding
+        const availableHeight = rect.height - 20
+        const availableWidth = rect.width - 20
+
+        // Calculate dimensions maintaining 16:9 aspect ratio
+        const aspectRatio = 16 / 9
+        let width = availableWidth
+        let height = width / aspectRatio
+
+        if (height > availableHeight) {
+          height = availableHeight
+          width = height * aspectRatio
+        }
+
+        // Create a wrapper div for slides
+        const slidesWrapper = document.createElement('div')
+        slidesWrapper.style.cssText = 'display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden;'
+        slidesContainerRef.current = slidesWrapper
+        container.appendChild(slidesWrapper)
+
+        // Initialize previewer with calculated size
+        const slideWidth = Math.max(width, 400)
+        const slideHeight = Math.max(height, 225)
+
+        previewerRef.current = init(slidesWrapper, {
+          width: slideWidth,
+          height: slideHeight,
+        })
+
+        // Preview the PPTX file
+        await previewerRef.current.preview(arrayBuffer)
+
+        // Find the main wrapper and disable its scrolling
+        const pptxWrapper = slidesWrapper.querySelector<HTMLElement>('.pptx-preview-wrapper')
+        if (pptxWrapper) {
+          pptxWrapper.style.overflow = 'hidden'
+          pptxWrapper.style.background = 'transparent'
+          pptxWrapper.style.position = 'relative'
+        }
+
+        // Find slides by class name - pptx-preview uses 'pptx-preview-slide-wrapper' class
+        const slides = slidesWrapper.querySelectorAll<HTMLElement>('.pptx-preview-slide-wrapper')
+        const slideCount = slides.length
+        setTotalSlides(slideCount)
+
+        // Store slides reference for navigation
+        slidesRef.current = Array.from(slides)
+
+        // Style and hide all slides except the first one
+        slides.forEach((slide, index) => {
+          slide.style.display = index === 0 ? 'block' : 'none'
+          slide.style.position = index === 0 ? 'relative' : 'absolute'
+          slide.style.top = '0'
+          slide.style.left = '50%'
+          slide.style.transform = index === 0 ? 'translateX(-50%)' : 'translateX(-50%)'
+          slide.style.margin = '0'
+          // Add some styling for better appearance
+          slide.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)'
+          slide.style.borderRadius = '4px'
+        })
+
+        setCurrentSlide(0)
+        setIsLoading(false)
+      } catch (err) {
+        console.error("[PptPreview] Failed to preview PPTX:", err)
+        setHasError(true)
+        setErrorMessage(err instanceof Error ? err.message : "Preview failed")
+        setIsLoading(false)
+      }
+    }
+
+    loadPptx()
+
+    // Cleanup
+    return () => {
+      if (previewerRef.current?.destroy) {
+        previewerRef.current.destroy()
+      }
+      previewerRef.current = null
+      slidesRef.current = []
+      if (slidesContainerRef.current && containerRef.current) {
+        containerRef.current.removeChild(slidesContainerRef.current)
+      }
+      slidesContainerRef.current = null
+    }
+  }, [data, fetchError])
+
+  // Open file in external app
+  const handleOpenExternal = () => {
+    if (window.desktopApi?.openPath) {
+      window.desktopApi.openPath(filePath)
+    }
+  }
+
+  if (hasError) {
+    return (
+      <div className={cn("h-full w-full flex flex-col items-center justify-center gap-4 text-muted-foreground", className)}>
+        <Presentation className="h-12 w-12 opacity-40" />
+        <div className="text-center">
+          <p className="text-sm">Unable to preview PPT file</p>
+          {errorMessage && (
+            <p className="text-xs text-muted-foreground/60 max-w-[300px] mt-1">
+              {errorMessage}
+            </p>
+          )}
+        </div>
+        <Button variant="outline" size="sm" onClick={handleOpenExternal}>
+          <ExternalLink className="h-4 w-4 mr-2" />
+          Open with external app
+        </Button>
+      </div>
+    )
+  }
+
+  return (
+    <div className={cn("h-full w-full flex flex-col overflow-hidden", className)}>
+      {/* Loading overlay */}
+      {isLoading && (
+        <div className="absolute inset-0 flex flex-col items-center justify-center gap-3 bg-background/80 z-10">
+          <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
+          <p className="text-sm text-muted-foreground">Loading presentation...</p>
+        </div>
+      )}
+
+      {/* Slide container */}
+      <div
+        ref={containerRef}
+        className="flex-1 flex items-center justify-center overflow-hidden bg-muted/30"
+      />
+
+      {/* Navigation bar */}
+      {!isLoading && totalSlides > 0 && (
+        <div className="flex items-center justify-center gap-4 py-3 px-4 border-t bg-background flex-shrink-0">
+          <Button
+            variant="outline"
+            size="icon"
+            className="h-8 w-8"
+            onClick={prevSlide}
+            disabled={currentSlide === 0 || isAnimating}
+          >
+            <ChevronLeft className="h-4 w-4" />
+          </Button>
+
+          <div className="flex items-center gap-2 min-w-[100px] justify-center">
+            <span className="text-sm font-medium">{currentSlide + 1}</span>
+            <span className="text-sm text-muted-foreground">/</span>
+            <span className="text-sm text-muted-foreground">{totalSlides}</span>
+          </div>
+
+          <Button
+            variant="outline"
+            size="icon"
+            className="h-8 w-8"
+            onClick={nextSlide}
+            disabled={currentSlide === totalSlides - 1 || isAnimating}
+          >
+            <ChevronRight className="h-4 w-4" />
+          </Button>
+        </div>
+      )}
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/text-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/text-preview.tsx b/src/renderer/features/cowork/file-preview/text-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/text-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,421 @@
+import { useEffect, useState, useRef, memo, lazy, Suspense, useCallback } from "react"
+import { codeToHtml } from "shiki"
+import { cn } from "../../../lib/utils"
+import { Loader2 } from "lucide-react"
+
+// Lazy load Monaco Editor to reduce initial bundle size
+const CodeEditor = lazy(() =>
+  import("./code-editor").then((m) => ({ default: m.CodeEditor }))
+)
+
+// ReviewComment type for optional comment support
+interface ReviewComment {
+  id: string
+  content: string
+  lineRange: { startLine: number; endLine: number }
+}
+
+interface TextPreviewProps {
+  content: string
+  fileName: string
+  className?: string
+  /** Enable edit mode with Monaco Editor */
+  editable?: boolean
+  /** File path for saving (required when editable is true) */
+  filePath?: string
+  /** Callback when file is saved */
+  onSave?: () => void
+  /** Callback when dirty state changes */
+  onDirtyChange?: (dirty: boolean) => void
+  /** Enable comment mode with line numbers and comment controls */
+  enableComments?: boolean
+  /** Chat ID for comment storage (required when enableComments is true) */
+  chatId?: string
+  /** Existing comments for this file */
+  comments?: ReviewComment[]
+  /** Callback when a comment is added */
+  onCommentAdded?: (comment: ReviewComment) => void
+  /** Line number to scroll to */
+  scrollToLine?: number | null
+  /** Text to highlight in the content */
+  highlightText?: string | null
+}
+
+// Map file extensions to Shiki language identifiers
+function getLanguageFromFileName(fileName: string): string {
+  const ext = fileName.split(".").pop()?.toLowerCase() || ""
+
+  const langMap: Record<string, string> = {
+    // JavaScript/TypeScript
+    js: "javascript",
+    jsx: "jsx",
+    ts: "typescript",
+    tsx: "tsx",
+    mjs: "javascript",
+    cjs: "javascript",
+
+    // Web
+    html: "html",
+    htm: "html",
+    css: "css",
+    scss: "scss",
+    sass: "sass",
+    less: "less",
+    vue: "vue",
+    svelte: "svelte",
+
+    // Data formats
+    json: "json",
+    jsonc: "jsonc",
+    json5: "json5",
+    yaml: "yaml",
+    yml: "yaml",
+    toml: "toml",
+    xml: "xml",
+    csv: "csv",
+
+    // Shell/Scripts
+    sh: "bash",
+    bash: "bash",
+    zsh: "bash",
+    fish: "fish",
+    ps1: "powershell",
+    bat: "batch",
+    cmd: "batch",
+
+    // Python
+    py: "python",
+    pyw: "python",
+    pyi: "python",
+    ipynb: "python",
+
+    // Other languages
+    rb: "ruby",
+    php: "php",
+    java: "java",
+    kt: "kotlin",
+    kts: "kotlin",
+    swift: "swift",
+    go: "go",
+    rs: "rust",
+    c: "c",
+    h: "c",
+    cpp: "cpp",
+    cc: "cpp",
+    cxx: "cpp",
+    hpp: "cpp",
+    cs: "csharp",
+    fs: "fsharp",
+    scala: "scala",
+    clj: "clojure",
+    ex: "elixir",
+    exs: "elixir",
+    erl: "erlang",
+    hs: "haskell",
+    lua: "lua",
+    r: "r",
+    jl: "julia",
+    dart: "dart",
+    zig: "zig",
+    nim: "nim",
+    v: "v",
+    d: "d",
+    ml: "ocaml",
+    sql: "sql",
+    graphql: "graphql",
+    gql: "graphql",
+
+    // Config files
+    dockerfile: "dockerfile",
+    makefile: "makefile",
+    cmake: "cmake",
+    gradle: "groovy",
+    tf: "hcl",
+    hcl: "hcl",
+    ini: "ini",
+    conf: "ini",
+    env: "shell",
+    gitignore: "gitignore",
+    editorconfig: "ini",
+
+    // Markdown/Docs
+    md: "markdown",
+    mdx: "mdx",
+    rst: "rst",
+    tex: "latex",
+    adoc: "asciidoc",
+
+    // Misc
+    diff: "diff",
+    patch: "diff",
+    log: "log",
+    txt: "text",
+  }
+
+  // Handle special filenames - use cross-platform path split
+  const specialFiles: Record<string, string> = {
+    Dockerfile: "dockerfile",
+    Makefile: "makefile",
+    CMakeLists: "cmake",
+    Gemfile: "ruby",
+    Rakefile: "ruby",
+    Podfile: "ruby",
+    Fastfile: "ruby",
+    Vagrantfile: "ruby",
+    Brewfile: "ruby",
+  }
+
+  const baseName = fileName.split(/[\\/]/).pop() || fileName
+  if (specialFiles[baseName]) {
+    return specialFiles[baseName]
+  }
+
+  return langMap[ext] || "text"
+}
+
+/**
+ * TextPreview - Code file preview with optional edit mode and comment support
+ *
+ * Modes:
+ * - `editable=true`: Monaco Editor with full editing capabilities
+ * - `enableComments=true`: Shiki preview with line numbers and comment controls
+ * - Default: Basic Shiki syntax highlighted code (read-only)
+ */
+export const TextPreview = memo(function TextPreview({
+  content,
+  fileName,
+  className,
+  editable = false,
+  filePath,
+  onSave,
+  onDirtyChange,
+  enableComments = false,
+  chatId,
+  comments = [],
+  onCommentAdded,
+  scrollToLine,
+  highlightText,
+}: TextPreviewProps) {
+  // Edit mode: Use Monaco Editor
+  if (editable && filePath) {
+    return (
+      <Suspense
+        fallback={
+          <div className={cn("flex items-center justify-center h-full", className)}>
+            <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+          </div>
+        }
+      >
+        <CodeEditor
+          filePath={filePath}
+          content={content}
+          className={className}
+          onSave={onSave}
+          onDirtyChange={onDirtyChange}
+        />
+      </Suspense>
+    )
+  }
+
+  // Comment mode: Currently disabled (requires comments module)
+  // TODO: Enable when comments module is ported
+  // if (enableComments && chatId && filePath) {
+  //   return <CodeWithLineNumbers ... />
+  // }
+
+  // Default: Basic syntax highlighted preview (no comments)
+  return (
+    <BasicTextPreview
+      content={content}
+      fileName={fileName}
+      className={className}
+      scrollToLine={scrollToLine}
+      highlightText={highlightText}
+    />
+  )
+})
+
+/**
+ * BasicTextPreview - Simple syntax highlighted code with line numbers, scroll-to-line and highlight support
+ */
+const BasicTextPreview = memo(function BasicTextPreview({
+  content,
+  fileName,
+  className,
+  scrollToLine,
+  highlightText,
+}: {
+  content: string
+  fileName: string
+  className?: string
+  scrollToLine?: number | null
+  highlightText?: string | null
+}) {
+  const [highlightedLines, setHighlightedLines] = useState<string[]>([])
+  const [isLoading, setIsLoading] = useState(true)
+  const [error, setError] = useState<string | null>(null)
+  const containerRef = useRef<HTMLDivElement>(null)
+  const hasScrolledRef = useRef(false)
+
+  // Split content into lines
+  const lines = content.split("\n")
+
+  // Highlight code using Shiki
+  useEffect(() => {
+    let cancelled = false
+    hasScrolledRef.current = false // Reset scroll flag when content changes
+
+    async function highlight() {
+      setIsLoading(true)
+      setError(null)
+
+      try {
+        const lang = getLanguageFromFileName(fileName)
+
+        // Highlight full content then split
+        const result = await codeToHtml(content, {
+          lang,
+          theme: "github-dark-default",
+        })
+
+        if (!cancelled) {
+          // Parse the HTML and extract line contents
+          // Shiki outputs a single <code> block, we need to split by lines
+          const codeMatch = result.match(/<code[^>]*>([\s\S]*?)<\/code>/i)
+          if (codeMatch) {
+            // Split the inner HTML by newline, preserving HTML tags
+            const innerHtml = codeMatch[1]
+            const lineHtmls = innerHtml.split("\n")
+            setHighlightedLines(lineHtmls)
+          } else {
+            // Fallback: split plain content
+            setHighlightedLines(
+              lines.map((line) =>
+                line
+                  .replace(/&/g, "&amp;")
+                  .replace(/</g, "&lt;")
+                  .replace(/>/g, "&gt;") || "&nbsp;"
+              )
+            )
+          }
+        }
+      } catch (err) {
+        console.error("Syntax highlighting error:", err)
+        if (!cancelled) {
+          // Fallback to plain text
+          setHighlightedLines(
+            lines.map((line) =>
+              line
+                .replace(/&/g, "&amp;")
+                .replace(/</g, "&lt;")
+                .replace(/>/g, "&gt;") || "&nbsp;"
+            )
+          )
+        }
+      } finally {
+        if (!cancelled) {
+          setIsLoading(false)
+        }
+      }
+    }
+
+    highlight()
+
+    return () => {
+      cancelled = true
+    }
+  }, [content, fileName])
+
+  // Scroll to line when specified
+  useEffect(() => {
+    if (scrollToLine && !isLoading && containerRef.current && !hasScrolledRef.current) {
+      const lineElement = containerRef.current.querySelector(`[data-line="${scrollToLine}"]`)
+      if (lineElement) {
+        // Wait a tick for DOM to settle
+        requestAnimationFrame(() => {
+          lineElement.scrollIntoView({ behavior: "smooth", block: "center" })
+          hasScrolledRef.current = true
+        })
+      }
+    }
+  }, [scrollToLine, isLoading, highlightedLines])
+
+  // Function to highlight text within a line
+  const highlightLineText = useCallback((lineHtml: string, searchText: string | null | undefined): string => {
+    if (!searchText) return lineHtml
+
+    // Escape special regex characters
+    const escaped = searchText.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
+    // Case insensitive search
+    const regex = new RegExp(`(${escaped})`, "gi")
+
+    // We need to be careful not to replace text inside HTML tags
+    // Split by HTML tags, process text parts only
+    const parts = lineHtml.split(/(<[^>]+>)/g)
+    const result = parts.map((part) => {
+      // If it's an HTML tag, leave it unchanged
+      if (part.startsWith("<")) return part
+      // Replace matches in text content
+      return part.replace(regex, '<mark class="bg-yellow-400/60 text-inherit rounded px-0.5">$1</mark>')
+    })
+    return result.join("")
+  }, [])
+
+  if (isLoading) {
+    return (
+      <div className={cn("flex items-center justify-center h-full", className)}>
+        <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
+      </div>
+    )
+  }
+
+  if (error) {
+    return (
+      <div className={cn("flex items-center justify-center h-full text-destructive", className)}>
+        {error}
+      </div>
+    )
+  }
+
+  return (
+    <div
+      ref={containerRef}
+      className={cn(
+        "h-full overflow-auto font-mono text-[13px] leading-relaxed",
+        className
+      )}
+    >
+      <table className="w-full border-collapse">
+        <tbody>
+          {highlightedLines.map((lineHtml, index) => {
+            const lineNumber = index + 1
+            const isTargetLine = scrollToLine === lineNumber
+            const processedHtml = highlightLineText(lineHtml, highlightText)
+
+            return (
+              <tr
+                key={lineNumber}
+                data-line={lineNumber}
+                className={cn(
+                  "group/line",
+                  isTargetLine && "bg-yellow-500/20"
+                )}
+              >
+                {/* Line number */}
+                <td className="w-12 text-right pr-3 select-none align-top text-muted-foreground/60 border-r border-border/40">
+                  <span className="text-xs tabular-nums">{lineNumber}</span>
+                </td>
+
+                {/* Code content */}
+                <td
+                  className="pl-4 whitespace-pre"
+                  dangerouslySetInnerHTML={{ __html: processedHtml || "&nbsp;" }}
+                />
+              </tr>
+            )
+          })}
+        </tbody>
+      </table>
+    </div>
+  )
+})
Index: src/renderer/features/cowork/file-preview/video-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/video-preview.tsx b/src/renderer/features/cowork/file-preview/video-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/video-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,61 @@
+import { useState } from "react"
+import { VideoOff, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+
+interface VideoPreviewProps {
+  filePath: string
+  className?: string
+}
+
+export function VideoPreview({ filePath, className }: VideoPreviewProps) {
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+
+  // Use local-file:// protocol for streaming video access
+  // Format: local-file://localhost/<absolute-path>
+  // Ensure path starts with / for proper URL format (Windows paths like D:\... need leading /)
+  const normalizedPath = filePath.startsWith("/") ? filePath : `/${filePath}`
+  const fileUrl = `local-file://localhost${normalizedPath}`
+
+  const handleLoadedData = () => {
+    setIsLoading(false)
+    setHasError(false)
+  }
+
+  const handleError = () => {
+    console.error("[VideoPreview] Failed to load:", fileUrl)
+    setIsLoading(false)
+    setHasError(true)
+  }
+
+  if (hasError) {
+    return (
+      <div className={cn("h-full w-full flex flex-col items-center justify-center gap-3 text-muted-foreground", className)}>
+        <VideoOff className="h-12 w-12 opacity-40" />
+        <p className="text-sm">Unable to play video</p>
+        <p className="text-xs text-muted-foreground/60 max-w-[300px] truncate">{filePath}</p>
+      </div>
+    )
+  }
+
+  return (
+    <div className={cn("h-full w-full flex flex-col bg-black relative", className)}>
+      {isLoading && (
+        <div className="absolute inset-0 flex items-center justify-center z-10">
+          <Loader2 className="h-8 w-8 animate-spin text-white/60" />
+        </div>
+      )}
+      <video
+        src={fileUrl}
+        className={cn(
+          "flex-1 w-full h-full object-contain",
+          isLoading && "opacity-0"
+        )}
+        controls
+        controlsList="nodownload"
+        onLoadedData={handleLoadedData}
+        onError={handleError}
+      />
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-preview/word-preview.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-preview/word-preview.tsx b/src/renderer/features/cowork/file-preview/word-preview.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-preview/word-preview.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,136 @@
+import { useEffect, useRef, useState } from "react"
+import { FileText, Loader2 } from "lucide-react"
+import { cn } from "../../../lib/utils"
+import { trpc } from "../../../lib/trpc"
+
+interface WordPreviewProps {
+  filePath: string
+  className?: string
+}
+
+export function WordPreview({ filePath, className }: WordPreviewProps) {
+  const containerRef = useRef<HTMLDivElement>(null)
+  const [isLoading, setIsLoading] = useState(true)
+  const [hasError, setHasError] = useState(false)
+  const [errorMessage, setErrorMessage] = useState("")
+
+  // Read file as binary via tRPC
+  const { data, error: fetchError } = trpc.files.readBinaryFile.useQuery(
+    { path: filePath, maxSize: 50 * 1024 * 1024 }, // 50MB max for Word files
+    { staleTime: 30000 }
+  )
+
+  useEffect(() => {
+    if (fetchError) {
+      setHasError(true)
+      setErrorMessage(fetchError.message)
+      setIsLoading(false)
+      return
+    }
+
+    if (!data || !containerRef.current) return
+
+    const renderDocument = async () => {
+      try {
+        // Dynamically import docx-preview to avoid SSR issues
+        const { renderAsync } = await import("docx-preview")
+
+        // Convert base64 to ArrayBuffer
+        const binaryString = atob(data.base64)
+        const bytes = new Uint8Array(binaryString.length)
+        for (let i = 0; i < binaryString.length; i++) {
+          bytes[i] = binaryString.charCodeAt(i)
+        }
+
+        // Render the document
+        await renderAsync(bytes.buffer, containerRef.current!, undefined, {
+          className: "docx-preview",
+          inWrapper: true,
+          ignoreWidth: false,
+          ignoreHeight: false,
+          ignoreFonts: false,
+          breakPages: true,
+          ignoreLastRenderedPageBreak: true,
+          experimental: false,
+          trimXmlDeclaration: true,
+          debug: false,
+        })
+
+        setIsLoading(false)
+        setHasError(false)
+      } catch (err) {
+        console.error("[WordPreview] Failed to render:", err)
+        setHasError(true)
+        setErrorMessage(err instanceof Error ? err.message : "Render failed")
+        setIsLoading(false)
+      }
+    }
+
+    renderDocument()
+  }, [data, fetchError])
+
+  if (hasError) {
+    return (
+      <div className={cn("h-full w-full flex flex-col items-center justify-center gap-3 text-muted-foreground", className)}>
+        <FileText className="h-12 w-12 opacity-40" />
+        <p className="text-sm">Unable to preview Word document</p>
+        {errorMessage && (
+          <p className="text-xs text-muted-foreground/60 max-w-[300px] text-center">
+            {errorMessage}
+          </p>
+        )}
+      </div>
+    )
+  }
+
+  return (
+    <div className={cn("h-full w-full flex flex-col relative bg-white dark:bg-zinc-900", className)}>
+      {isLoading && (
+        <div className="absolute inset-0 flex items-center justify-center bg-background z-10">
+          <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
+        </div>
+      )}
+      <div
+        ref={containerRef}
+        className={cn(
+          "flex-1 overflow-auto p-4",
+          isLoading && "opacity-0"
+        )}
+      />
+      <style>{`
+        .docx-preview {
+          padding: 20px;
+        }
+        .docx-wrapper {
+          background: white;
+          padding: 30px;
+          box-shadow: 0 0 10px rgba(0,0,0,0.1);
+          max-width: 100%;
+          margin: 0 auto;
+        }
+        .dark .docx-wrapper {
+          background: #18181b;
+          color: #fafafa;
+        }
+        .docx-wrapper section {
+          margin-bottom: 20px;
+        }
+        .docx-wrapper p {
+          margin: 0.5em 0;
+          line-height: 1.6;
+        }
+        .docx-wrapper table {
+          border-collapse: collapse;
+          width: 100%;
+        }
+        .docx-wrapper td, .docx-wrapper th {
+          border: 1px solid #ddd;
+          padding: 8px;
+        }
+        .dark .docx-wrapper td, .dark .docx-wrapper th {
+          border-color: #3f3f46;
+        }
+      `}</style>
+    </div>
+  )
+}
Index: src/renderer/features/cowork/file-tree-panel.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/cowork/file-tree-panel.tsx b/src/renderer/features/cowork/file-tree-panel.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/cowork/file-tree-panel.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,817 @@
+import { useState, useMemo, useCallback, useEffect, useRef } from "react"
+import { useAtom, useSetAtom } from "jotai"
+import { useQueryClient } from "@tanstack/react-query"
+import { trpc } from "../../lib/trpc"
+import { useGitWatcher } from "../../lib/hooks/use-file-change-listener"
+import { getFileIconByExtension } from "../agents/mentions/agents-file-mention"
+import {
+  ChevronRight,
+  ChevronDown,
+  Search,
+  FolderOpen,
+  FolderTree,
+  Folder,
+  X,
+  PanelLeftClose,
+  RefreshCw,
+  Loader2,
+  AtSign,
+  FileSearch,
+  ArrowLeft,
+  FileText,
+  Filter,
+  MoreHorizontal,
+  ChevronsUpDown,
+  ChevronsDownUp,
+} from "lucide-react"
+import { Input } from "../../components/ui/input"
+import { Button } from "../../components/ui/button"
+import {
+  DropdownMenu,
+  DropdownMenuContent,
+  DropdownMenuItem,
+  DropdownMenuTrigger,
+} from "../../components/ui/dropdown-menu"
+import { cn } from "../../lib/utils"
+import { toast } from "sonner"
+import {
+  fileTreeExpandedPathsAtom,
+  fileTreeSearchQueryAtom,
+  fileTreeSavedExpandedPathsAtom,
+  pendingFileReferenceAtom,
+  contentSearchActiveAtom,
+  contentSearchQueryAtom,
+  contentSearchPatternAtom,
+  contentSearchCaseSensitiveAtom,
+  contentSearchLoadingAtom,
+  contentSearchResultsAtom,
+  contentSearchToolAtom,
+  filePreviewPathAtom,
+  filePreviewLineAtom,
+  filePreviewHighlightAtom,
+  type ContentSearchResult,
+} from "./atoms"
+
+// ============================================================================
+// Types
+// ============================================================================
+
+interface DirectoryEntry {
+  name: string
+  path: string
+  type: "file" | "folder"
+}
+
+interface FileTreePanelProps {
+  projectPath?: string
+  onClose?: () => void
+  onFileSelect?: (path: string, line?: number) => void
+  showHeader?: boolean
+}
+
+// ============================================================================
+// Lazy Loading Directory Node
+// ============================================================================
+
+interface LazyDirectoryNodeProps {
+  entry: DirectoryEntry
+  projectPath: string
+  depth: number
+  expandedPaths: Set<string>
+  matchingPaths: Set<string> // Paths that match the search query
+  onToggle: (path: string) => void
+  onSelect: (path: string, type: "file" | "folder") => void
+  onReference: (path: string, name: string, type: "file" | "folder") => void
+  searchQuery: string
+}
+
+function LazyDirectoryNode({
+  entry,
+  projectPath,
+  depth,
+  expandedPaths,
+  matchingPaths,
+  onToggle,
+  onSelect,
+  onReference,
+  searchQuery,
+}: LazyDirectoryNodeProps) {
+  const isExpanded = expandedPaths.has(entry.path)
+  const isFolder = entry.type === "folder"
+  const [isHovered, setIsHovered] = useState(false)
+
+  // Check if this item or its descendants match the search
+  const isMatching = matchingPaths.has(entry.path)
+  const hasMatchingDescendant = useMemo(() => {
+    if (!searchQuery) return false
+    for (const path of matchingPaths) {
+      if (path.startsWith(entry.path + "/")) return true
+    }
+    return false
+  }, [matchingPaths, entry.path, searchQuery])
+
+  // Lazy load children when folder is expanded
+  // IMPORTANT: This hook must be called before any conditional returns
+  const { data: children, isLoading } = trpc.files.listDirectory.useQuery(
+    { projectPath, relativePath: entry.path },
+    {
+      enabled: isFolder && isExpanded,
+      staleTime: 30000, // 30 seconds
+    }
+  )
+
+  // Filter children - hide non-matching items when searching
+  const filteredChildren = useMemo(() => {
+    if (!children) return []
+    return children
+  }, [children])
+
+  const handleClick = useCallback(() => {
+    if (isFolder) {
+      onToggle(entry.path)
+    } else {
+      onSelect(entry.path, entry.type)
+    }
+  }, [isFolder, entry.path, entry.type, onToggle, onSelect])
+
+  const handleReference = useCallback((e: React.MouseEvent) => {
+    e.stopPropagation()
+    onReference(entry.path, entry.name, entry.type)
+  }, [entry.path, entry.name, entry.type, onReference])
+
+  // Hide non-matching files when searching (but keep folders that have matching descendants)
+  // IMPORTANT: Conditional returns must come AFTER all hooks
+  if (searchQuery && !isMatching && !hasMatchingDescendant && !isFolder) {
+    return null
+  }
+  if (searchQuery && isFolder && !isMatching && !hasMatchingDescendant) {
+    return null
+  }
+
+  const FileIcon = isFolder
+    ? (isExpanded ? FolderOpen : Folder)
+    : (getFileIconByExtension(entry.name) ?? FileText)
+
+  // Highlight matching text
+  const highlightMatch = (text: string) => {
+    if (!searchQuery) return text
+    const idx = text.toLowerCase().indexOf(searchQuery.toLowerCase())
+    if (idx === -1) return text
+    return (
+      <>
+        {text.slice(0, idx)}
+        <span className="bg-yellow-500/30 text-foreground font-medium">{text.slice(idx, idx + searchQuery.length)}</span>
+        {text.slice(idx + searchQuery.length)}
+      </>
+    )
+  }
+
+  return (
+    <>
+      <div
+        className={cn(
+          "flex items-center gap-1 py-1 px-1.5 rounded text-xs cursor-pointer group",
+          "hover:bg-accent hover:text-accent-foreground",
+          isMatching && searchQuery && "bg-yellow-500/10"
+        )}
+        style={{ paddingLeft: `${depth * 12 + 8}px` }}
+        onClick={handleClick}
+        onMouseEnter={() => setIsHovered(true)}
+        onMouseLeave={() => setIsHovered(false)}
+      >
+        {/* Expand/collapse chevron for folders */}
+        {isFolder ? (
+          <span className="w-4 h-4 flex items-center justify-center flex-shrink-0">
+            {isLoading ? (
+              <Loader2 className="h-3 w-3 text-muted-foreground animate-spin" />
+            ) : isExpanded ? (
+              <ChevronDown className="h-3 w-3 text-muted-foreground" />
+            ) : (
+              <ChevronRight className="h-3 w-3 text-muted-foreground" />
+            )}
+          </span>
+        ) : (
+          <span className="w-4 flex-shrink-0" />
+        )}
+
+        {/* File/folder icon */}
+        <FileIcon className="h-3.5 w-3.5 text-muted-foreground flex-shrink-0" />
+
+        {/* Name with highlight */}
+        <span className="truncate flex-1">{highlightMatch(entry.name)}</span>
+
+        {/* Reference button - only show on hover for files */}
+        {!isFolder && isHovered && (
+          <button
+            onClick={handleReference}
+            className="flex-shrink-0 p-0.5 rounded hover:bg-primary/20 transition-colors"
+            title="Insert reference to chat"
+          >
+            <AtSign className="h-3 w-3 text-muted-foreground hover:text-primary" />
+          </button>
+        )}
+      </div>
+
+      {/* Children (lazy loaded when expanded) */}
+      {isFolder && isExpanded && filteredChildren && filteredChildren.length > 0 && (
+        <div>
+          {filteredChildren.map((child) => (
+            <LazyDirectoryNode
+              key={child.path}
+              entry={child}
+              projectPath={projectPath}
+              depth={depth + 1}
+              expandedPaths={expandedPaths}
+              matchingPaths={matchingPaths}
+              onToggle={onToggle}
+              onSelect={onSelect}
+              onReference={onReference}
+              searchQuery={searchQuery}
+            />
+          ))}
+        </div>
+      )}
+
+      {/* Empty folder indicator */}
+      {isFolder && isExpanded && !isLoading && filteredChildren && filteredChildren.length === 0 && (
+        <div
+          className="text-xs text-muted-foreground/60 italic py-1"
+          style={{ paddingLeft: `${(depth + 1) * 12 + 8 + 16}px` }}
+        >
+          Empty folder
+        </div>
+      )}
+    </>
+  )
+}
+
+// ============================================================================
+// Content Search Result Item
+// ============================================================================
+
+interface ContentSearchResultItemProps {
+  result: ContentSearchResult
+  projectPath: string
+  query: string
+  onSelect: (path: string, line: number) => void
+}
+
+function ContentSearchResultItem({ result, projectPath, query, onSelect }: ContentSearchResultItemProps) {
+  const FileIcon = getFileIconByExtension(result.file) ?? FileText
+
+  // Highlight matching text in the line
+  const highlightText = (text: string) => {
+    if (!query) return text
+    const idx = text.toLowerCase().indexOf(query.toLowerCase())
+    if (idx === -1) return text
+    return (
+      <>
+        {text.slice(0, idx)}
+        <span className="bg-yellow-500/50 text-foreground font-medium">{text.slice(idx, idx + query.length)}</span>
+        {text.slice(idx + query.length)}
+      </>
+    )
+  }
+
+  return (
+    <div
+      className="px-2 py-1.5 hover:bg-accent cursor-pointer rounded-sm"
+      onClick={() => onSelect(result.file, result.line)}
+    >
+      <div className="flex items-center gap-1.5 text-xs">
+        <FileIcon className="h-3.5 w-3.5 text-muted-foreground flex-shrink-0" />
+        <span className="text-muted-foreground truncate">{result.file}</span>
+        <span className="text-muted-foreground/60">:</span>
+        <span className="text-primary font-mono">{result.line}</span>
+      </div>
+      <div className="mt-1 text-xs font-mono text-muted-foreground truncate pl-5">
+        {highlightText(result.text)}
+      </div>
+    </div>
+  )
+}
+
+// ============================================================================
+// Main Component
+// ============================================================================
+
+export function FileTreePanel({
+  projectPath,
+  onClose,
+  onFileSelect,
+  showHeader = true,
+}: FileTreePanelProps) {
+  const [expandedPaths, setExpandedPaths] = useAtom(fileTreeExpandedPathsAtom)
+  const [searchQuery, setSearchQuery] = useAtom(fileTreeSearchQueryAtom)
+  const [savedExpandedPaths, setSavedExpandedPaths] = useAtom(fileTreeSavedExpandedPathsAtom)
+  const setPendingFileReference = useSetAtom(pendingFileReferenceAtom)
+
+  // Preview atoms for search result navigation
+  const setPreviewPath = useSetAtom(filePreviewPathAtom)
+  const setPreviewLine = useSetAtom(filePreviewLineAtom)
+  const setPreviewHighlight = useSetAtom(filePreviewHighlightAtom)
+
+  // Content search state
+  const [contentSearchActive, setContentSearchActive] = useAtom(contentSearchActiveAtom)
+  const [contentQuery, setContentQuery] = useAtom(contentSearchQueryAtom)
+  const [contentPattern, setContentPattern] = useAtom(contentSearchPatternAtom)
+  const [caseSensitive, setCaseSensitive] = useAtom(contentSearchCaseSensitiveAtom)
+  const [contentLoading, setContentLoading] = useAtom(contentSearchLoadingAtom)
+  const [contentResults, setContentResults] = useAtom(contentSearchResultsAtom)
+  const [contentTool, setContentTool] = useAtom(contentSearchToolAtom)
+
+  // Query client for cache invalidation
+  const queryClient = useQueryClient()
+
+  // Subscribe to file system changes to auto-refresh
+  useGitWatcher(projectPath)
+
+  const searchInputRef = useRef<HTMLInputElement>(null)
+  const contentSearchInputRef = useRef<HTMLInputElement>(null)
+
+  // Track if we're currently in search mode (to know when to save/restore state)
+  const prevSearchQueryRef = useRef<string>("")
+
+  // Fetch root directory contents
+  const { data: rootEntries, isLoading, refetch, isFetching } = trpc.files.listDirectory.useQuery(
+    { projectPath: projectPath ?? "", relativePath: "" },
+    {
+      enabled: !!projectPath,
+      staleTime: 30000, // 30 seconds
+    }
+  )
+
+  // Search files to get matching paths and parent paths to expand
+  const { data: searchData } = trpc.files.searchFiles.useQuery(
+    { projectPath: projectPath ?? "", query: searchQuery, limit: 100 },
+    {
+      enabled: !!projectPath && !!searchQuery && searchQuery.length >= 1,
+      staleTime: 10000,
+    }
+  )
+
+  // Save expanded state when starting to search, restore when clearing
+  useEffect(() => {
+    const wasSearching = prevSearchQueryRef.current.length > 0
+    const isSearching = searchQuery.length > 0
+
+    if (!wasSearching && isSearching) {
+      // Starting to search - save current expanded state
+      setSavedExpandedPaths(new Set(expandedPaths))
+    } else if (wasSearching && !isSearching && savedExpandedPaths) {
+      // Cleared search - restore saved state
+      setExpandedPaths(savedExpandedPaths)
+      setSavedExpandedPaths(null)
+    }
+
+    prevSearchQueryRef.current = searchQuery
+  }, [searchQuery, expandedPaths, savedExpandedPaths, setSavedExpandedPaths, setExpandedPaths])
+
+  // Auto-expand parent directories when search results come in
+  useEffect(() => {
+    if (searchData?.parentPaths && searchData.parentPaths.length > 0 && searchQuery) {
+      setExpandedPaths((prev) => {
+        const next = new Set(prev)
+        for (const path of searchData.parentPaths) {
+          next.add(path)
+        }
+        return next
+      })
+    }
+  }, [searchData?.parentPaths, searchQuery, setExpandedPaths])
+
+  // Create a set of matching paths for quick lookup
+  const matchingPaths = useMemo(() => {
+    if (!searchData?.results) return new Set<string>()
+    return new Set(searchData.results.map((r) => r.path))
+  }, [searchData?.results])
+
+  // Content search mutation
+  const contentSearchMutation = trpc.files.searchContent.useMutation({
+    onMutate: () => {
+      console.log("[FileTree] Starting content search...")
+      setContentLoading(true)
+    },
+    onSuccess: (data) => {
+      console.log("[FileTree] Content search success:", data.tool, data.results.length, "results")
+      setContentResults(data.results)
+      setContentTool(data.tool)
+      setContentLoading(false)
+
+      // Show toast notification for fallback tools or errors
+      if (data.tool === "findstr") {
+        toast.info("Using Windows findstr for content search", {
+          description: "For better results, install ripgrep: scoop install ripgrep",
+          duration: 5000,
+        })
+      } else if (data.tool === "grep") {
+        toast.info("Using grep for content search", {
+          description: "For better results, install ripgrep: brew install ripgrep",
+          duration: 5000,
+        })
+      } else if (data.tool === "findstr-failed" || data.tool === "findstr-error") {
+        toast.warning("Content search failed", {
+          description: "Install ripgrep for better search: scoop install ripgrep",
+          duration: 5000,
+        })
+      } else if (data.tool === "grep-failed" || data.tool === "grep-error") {
+        toast.warning("Content search failed", {
+          description: "Install ripgrep for better search: brew install ripgrep",
+          duration: 5000,
+        })
+      }
+    },
+    onError: (error) => {
+      console.error("[FileTree] Content search error:", error)
+      setContentResults([])
+      setContentLoading(false)
+      toast.error("Content search failed", {
+        description: error.message,
+      })
+    },
+  })
+
+  // Execute content search
+  const handleContentSearch = useCallback(() => {
+    if (!projectPath || !contentQuery) return
+    contentSearchMutation.mutate({
+      projectPath,
+      query: contentQuery,
+      filePattern: contentPattern || undefined,
+      caseSensitive,
+      limit: 50,
+    })
+  }, [projectPath, contentQuery, contentPattern, caseSensitive, contentSearchMutation])
+
+  // Handle enter key for content search
+  const handleContentSearchKeyDown = useCallback((e: React.KeyboardEvent) => {
+    if (e.key === "Enter") {
+      handleContentSearch()
+    }
+  }, [handleContentSearch])
+
+  // Refresh file list - invalidate cache first to ensure fresh data
+  const handleRefresh = useCallback(() => {
+    queryClient.invalidateQueries({ queryKey: [["files", "listDirectory"]] })
+    refetch()
+  }, [queryClient, refetch])
+
+  // Toggle folder expansion
+  const handleToggle = useCallback(
+    (path: string) => {
+      setExpandedPaths((prev: Set<string>) => {
+        const next = new Set(prev)
+        if (next.has(path)) {
+          next.delete(path)
+        } else {
+          next.add(path)
+        }
+        return next
+      })
+    },
+    [setExpandedPaths]
+  )
+
+  // Select file/folder
+  const handleSelect = useCallback(
+    (path: string, type: "file" | "folder", line?: number) => {
+      if (type === "file" && onFileSelect) {
+        onFileSelect(path, line)
+      }
+    },
+    [onFileSelect]
+  )
+
+  // Clear search
+  const handleClearSearch = useCallback(() => {
+    setSearchQuery("")
+  }, [setSearchQuery])
+
+  // Reference file in chat input
+  const handleReference = useCallback(
+    (path: string, name: string, type: "file" | "folder") => {
+      setPendingFileReference({ path, name, type })
+    },
+    [setPendingFileReference]
+  )
+
+  // Switch to content search mode
+  const handleOpenContentSearch = useCallback(() => {
+    setContentSearchActive(true)
+    setContentResults([])
+    setTimeout(() => contentSearchInputRef.current?.focus(), 100)
+  }, [setContentSearchActive, setContentResults])
+
+  // Switch back to file tree mode
+  const handleCloseContentSearch = useCallback(() => {
+    setContentSearchActive(false)
+    setContentQuery("")
+    setContentResults([])
+  }, [setContentSearchActive, setContentQuery, setContentResults])
+
+  // Handle content search result click - open preview with line and highlight
+  const handleContentResultSelect = useCallback(
+    (filePath: string, line: number) => {
+      // Set preview atoms for line jump and highlight
+      if (projectPath) {
+        // Normalize project path (remove trailing slashes)
+        const normalizedProjectPath = projectPath.replace(/[\\/]+$/, "")
+        // Construct full path with forward slash (filePath already normalized by backend)
+        const fullPath = `${normalizedProjectPath}/${filePath}`
+        setPreviewPath(fullPath)
+        setPreviewLine(line)
+        setPreviewHighlight(contentQuery)
+      }
+      // Also call onFileSelect if provided
+      if (onFileSelect) {
+        onFileSelect(filePath, line)
+      }
+    },
+    [projectPath, contentQuery, setPreviewPath, setPreviewLine, setPreviewHighlight, onFileSelect]
+  )
+
+  // Expand all folders - uses searchFiles API to get all folder paths
+  const { data: allFilesData } = trpc.files.searchFiles.useQuery(
+    { projectPath: projectPath ?? "", query: "", limit: 500 },
+    {
+      enabled: !!projectPath,
+      staleTime: 30000,
+    }
+  )
+
+  const handleExpandAll = useCallback(() => {
+    const allFolders = new Set<string>()
+    // Get all folder paths from root entries
+    rootEntries?.forEach((entry) => {
+      if (entry.type === "folder") {
+        allFolders.add(entry.path)
+      }
+    })
+    // Add all parent paths (which includes all nested folders)
+    if (allFilesData?.parentPaths) {
+      allFilesData.parentPaths.forEach((path) => allFolders.add(path))
+    }
+    // Also add folders from search results if searching
+    if (searchData?.parentPaths) {
+      searchData.parentPaths.forEach((path) => allFolders.add(path))
+    }
+    setExpandedPaths(allFolders)
+  }, [allFilesData?.parentPaths, searchData?.parentPaths, rootEntries, setExpandedPaths])
+
+  // Collapse all folders
+  const handleCollapseAll = useCallback(() => {
+    setExpandedPaths(new Set<string>())
+  }, [setExpandedPaths])
+
+  // Render content search view
+  if (contentSearchActive) {
+    return (
+      <div className="flex flex-col h-full">
+        {/* Content Search Header - always show back button (even when showHeader=false) */}
+        <div className="flex items-center justify-between px-3 py-2 border-b">
+          <div className="flex items-center gap-2">
+            <Button
+              variant="ghost"
+              size="icon"
+              className="h-6 w-6"
+              onClick={handleCloseContentSearch}
+            >
+              <ArrowLeft className="h-3.5 w-3.5" />
+            </Button>
+            <FileSearch className="h-3.5 w-3.5 text-muted-foreground" />
+            <span className="text-xs font-medium">Content Search</span>
+          </div>
+          {/* Close button only shown when showHeader is true and onClose is provided */}
+          {showHeader && onClose && (
+            <Button
+              variant="ghost"
+              size="icon"
+              className="h-6 w-6"
+              onClick={onClose}
+            >
+              <PanelLeftClose className="h-4 w-4" />
+            </Button>
+          )}
+        </div>
+
+        {/* Search Input */}
+        <div className="p-2 border-b space-y-2">
+          <div className="relative">
+            <Search className="absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />
+            <Input
+              ref={contentSearchInputRef}
+              placeholder="Search in files..."
+              value={contentQuery}
+              onChange={(e) => setContentQuery(e.target.value)}
+              onKeyDown={handleContentSearchKeyDown}
+              className="pl-8 pr-20 h-8 text-xs"
+            />
+            <div className="absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-1">
+              <Button
+                variant="ghost"
+                size="icon"
+                className={cn("h-6 w-6", caseSensitive && "bg-primary/20")}
+                onClick={() => setCaseSensitive(!caseSensitive)}
+                title="Case sensitive"
+              >
+                <span className="text-[10px] font-bold">Aa</span>
+              </Button>
+              <Button
+                variant="default"
+                size="icon"
+                className="h-6 w-6"
+                onClick={handleContentSearch}
+                disabled={!contentQuery || contentLoading}
+              >
+                {contentLoading ? (
+                  <Loader2 className="h-3 w-3 animate-spin" />
+                ) : (
+                  <Search className="h-3 w-3" />
+                )}
+              </Button>
+            </div>
+          </div>
+
+          {/* File pattern filter */}
+          <div className="relative">
+            <Filter className="absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />
+            <Input
+              placeholder="File pattern (e.g., *.ts, *.{js,tsx})"
+              value={contentPattern}
+              onChange={(e) => setContentPattern(e.target.value)}
+              onKeyDown={handleContentSearchKeyDown}
+              className="pl-8 h-7 text-xs"
+            />
+          </div>
+        </div>
+
+        {/* Results */}
+        <div className="flex-1 overflow-auto">
+          {contentLoading ? (
+            <div className="flex items-center justify-center gap-2 p-4 text-xs text-muted-foreground">
+              <Loader2 className="h-4 w-4 animate-spin" />
+              Searching...
+            </div>
+          ) : contentResults.length === 0 ? (
+            <div className="p-4 text-xs text-muted-foreground text-center">
+              {contentQuery ? "No matches found" : "Enter a search term"}
+            </div>
+          ) : (
+            <div className="p-1">
+              <div className="px-2 py-1 text-xs text-muted-foreground flex items-center justify-between">
+                <span>{contentResults.length} results</span>
+                {contentTool && (
+                  <span className="text-[10px] text-muted-foreground/60">
+                    via {contentTool}
+                  </span>
+                )}
+              </div>
+              {contentResults.map((result, idx) => (
+                <ContentSearchResultItem
+                  key={`${result.file}:${result.line}:${idx}`}
+                  result={result}
+                  projectPath={projectPath ?? ""}
+                  query={contentQuery}
+                  onSelect={handleContentResultSelect}
+                />
+              ))}
+            </div>
+          )}
+        </div>
+      </div>
+    )
+  }
+
+  // Render file tree view
+  return (
+    <div className="flex flex-col h-full">
+      {/* Header (optional) - just title and close button, toolbar is in search row */}
+      {showHeader && (
+        <div className="flex items-center justify-between px-3 py-2 border-b">
+          <div className="flex items-center gap-2">
+            <FolderTree className="h-3.5 w-3.5 text-muted-foreground" />
+            <span className="text-xs font-medium">Explorer</span>
+          </div>
+          {onClose && (
+            <Button
+              variant="ghost"
+              size="icon"
+              className="h-6 w-6"
+              onClick={onClose}
+            >
+              <PanelLeftClose className="h-4 w-4" />
+            </Button>
+          )}
+        </div>
+      )}
+
+      {/* Search + Toolbar */}
+      <div className="p-2 border-b">
+        <div className="flex items-center gap-1">
+          {/* Search input */}
+          <div className="relative flex-1">
+            <Search className="absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />
+            <Input
+              ref={searchInputRef}
+              placeholder="Filter files..."
+              value={searchQuery}
+              onChange={(e) => setSearchQuery(e.target.value)}
+              className="pl-8 pr-8 h-7 text-xs"
+            />
+            {searchQuery && (
+              <Button
+                variant="ghost"
+                size="icon"
+                className="absolute right-1 top-1/2 -translate-y-1/2 h-5 w-5"
+                onClick={handleClearSearch}
+              >
+                <X className="h-3 w-3" />
+              </Button>
+            )}
+          </div>
+          {/* Toolbar buttons - always visible */}
+          <Button
+            variant="ghost"
+            size="icon"
+            className="h-7 w-7 flex-shrink-0"
+            onClick={handleOpenContentSearch}
+            title="Search file contents"
+          >
+            <FileSearch className="h-3.5 w-3.5" />
+          </Button>
+          <Button
+            variant="ghost"
+            size="icon"
+            className="h-7 w-7 flex-shrink-0"
+            onClick={handleRefresh}
+            disabled={isFetching}
+            title="Refresh"
+          >
+            <RefreshCw className={cn("h-3.5 w-3.5", isFetching && "animate-spin")} />
+          </Button>
+          <DropdownMenu>
+            <DropdownMenuTrigger asChild>
+              <Button
+                variant="ghost"
+                size="icon"
+                className="h-7 w-7 flex-shrink-0"
+                title="More options"
+              >
+                <MoreHorizontal className="h-3.5 w-3.5" />
+              </Button>
+            </DropdownMenuTrigger>
+            <DropdownMenuContent align="end" className="w-40">
+              <DropdownMenuItem onClick={handleExpandAll}>
+                <ChevronsUpDown className="h-3.5 w-3.5 mr-2" />
+                <span className="text-xs">Expand All</span>
+              </DropdownMenuItem>
+              <DropdownMenuItem onClick={handleCollapseAll}>
+                <ChevronsDownUp className="h-3.5 w-3.5 mr-2" />
+                <span className="text-xs">Collapse All</span>
+              </DropdownMenuItem>
+            </DropdownMenuContent>
+          </DropdownMenu>
+        </div>
+        {/* Show match count when searching */}
+        {searchQuery && searchData?.results && (
+          <div className="mt-1.5 px-1 text-[10px] text-muted-foreground">
+            {searchData.results.length} matches
+          </div>
+        )}
+      </div>
+
+      {/* File Tree */}
+      <div className="flex-1 overflow-auto p-1">
+        {!projectPath ? (
+          <div className="text-xs text-muted-foreground p-2 text-center">
+            Select a project first
+          </div>
+        ) : isLoading ? (
+          <div className="text-xs text-muted-foreground p-2 text-center flex items-center justify-center gap-2">
+            <Loader2 className="h-4 w-4 animate-spin" />
+            Loading...
+          </div>
+        ) : !rootEntries || rootEntries.length === 0 ? (
+          <div className="text-xs text-muted-foreground p-2 text-center">
+            {searchQuery ? "No matching files" : "No files"}
+          </div>
+        ) : (
+          rootEntries.map((entry) => (
+            <LazyDirectoryNode
+              key={entry.path}
+              entry={entry}
+              projectPath={projectPath}
+              depth={0}
+              expandedPaths={expandedPaths}
+              matchingPaths={matchingPaths}
+              onToggle={handleToggle}
+              onSelect={handleSelect}
+              onReference={handleReference}
+              searchQuery={searchQuery}
+            />
+          ))
+        )}
+      </div>
+    </div>
+  )
+}
Index: src/renderer/features/details-sidebar/atoms/index.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/details-sidebar/atoms/index.ts b/src/renderer/features/details-sidebar/atoms/index.ts
--- a/src/renderer/features/details-sidebar/atoms/index.ts	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/details-sidebar/atoms/index.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -2,13 +2,13 @@
 import { atomFamily, atomWithStorage } from "jotai/utils"
 import { atomWithWindowStorage } from "../../../lib/window-storage"
 import type { LucideIcon } from "lucide-react"
-import { Box, FileText, Terminal, FileDiff, ListTodo } from "lucide-react"
+import { Box, FileText, Terminal, FileDiff, ListTodo, FolderTree } from "lucide-react"
 
 // ============================================================================
 // Widget System Types & Registry
 // ============================================================================
 
-export type WidgetId = "info" | "todo" | "plan" | "terminal" | "diff"
+export type WidgetId = "info" | "todo" | "plan" | "terminal" | "diff" | "explorer"
 
 export interface WidgetConfig {
   id: WidgetId
@@ -24,6 +24,7 @@
   { id: "plan", label: "Plan", icon: FileText, canExpand: true, defaultVisible: true },
   { id: "terminal", label: "Terminal", icon: Terminal, canExpand: true, defaultVisible: false },
   { id: "diff", label: "Changes", icon: FileDiff, canExpand: true, defaultVisible: true },
+  { id: "explorer", label: "Explorer", icon: FolderTree, canExpand: true, defaultVisible: true },
 ]
 
 // Helper to get default visible widgets
Index: src/renderer/features/details-sidebar/details-sidebar.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/details-sidebar/details-sidebar.tsx b/src/renderer/features/details-sidebar/details-sidebar.tsx
--- a/src/renderer/features/details-sidebar/details-sidebar.tsx	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/details-sidebar/details-sidebar.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -2,7 +2,7 @@
 
 import { useCallback, useEffect, useMemo } from "react"
 import { useAtom, useAtomValue } from "jotai"
-import { ArrowUpRight, TerminalSquare, Box, ListTodo } from "lucide-react"
+import { ArrowUpRight, TerminalSquare, Box, ListTodo, FolderTree } from "lucide-react"
 import { ResizableSidebar } from "@/components/ui/resizable-sidebar"
 import { Button } from "@/components/ui/button"
 import {
@@ -32,6 +32,7 @@
 import { PlanWidget } from "./sections/plan-widget"
 import { TerminalWidget } from "./sections/terminal-widget"
 import { ChangesWidget } from "./sections/changes-widget"
+import { ExplorerWidget } from "./sections/explorer-widget"
 import type { ParsedDiffFile } from "./types"
 
 interface DetailsSidebarProps {
@@ -69,8 +70,13 @@
   onExpandTerminal?: () => void
   onExpandPlan?: () => void
   onExpandDiff?: () => void
+  onExpandExplorer?: () => void
+  /** Sidebar open states for explorer */
+  isExplorerSidebarOpen?: boolean
   /** Callback when a file is selected in Changes widget - opens diff with file selected */
   onFileSelect?: (filePath: string) => void
+  /** Callback when a file is selected in Explorer widget */
+  onExplorerFileSelect?: (filePath: string) => void
 }
 
 export function DetailsSidebar({
@@ -94,7 +100,10 @@
   onExpandTerminal,
   onExpandPlan,
   onExpandDiff,
+  onExpandExplorer,
+  isExplorerSidebarOpen,
   onFileSelect,
+  onExplorerFileSelect,
 }: DetailsSidebarProps) {
   // Global sidebar open state
   const [isOpen, setIsOpen] = useAtom(detailsSidebarOpenAtom)
@@ -134,9 +143,12 @@
         case "diff":
           onExpandDiff?.()
           break
+        case "explorer":
+          onExpandExplorer?.()
+          break
       }
     },
-    [onExpandTerminal, onExpandPlan, onExpandDiff],
+    [onExpandTerminal, onExpandPlan, onExpandDiff, onExpandExplorer],
   )
 
   // Check if a widget should be shown
@@ -184,6 +196,8 @@
         return TerminalSquare
       case "diff":
         return DiffIcon
+      case "explorer":
+        return FolderTree
       default:
         return Box
     }
@@ -383,6 +397,18 @@
                   />
                 )
 
+              case "explorer":
+                // Hidden when Explorer sidebar is open
+                if (!worktreePath || isExplorerSidebarOpen) return null
+                return (
+                  <ExplorerWidget
+                    key="explorer"
+                    worktreePath={worktreePath}
+                    onExpand={onExpandExplorer}
+                    onFileSelect={onExplorerFileSelect}
+                  />
+                )
+
               default:
                 return null
             }
Index: src/renderer/features/details-sidebar/expanded-widget-sidebar.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/details-sidebar/expanded-widget-sidebar.tsx b/src/renderer/features/details-sidebar/expanded-widget-sidebar.tsx
--- a/src/renderer/features/details-sidebar/expanded-widget-sidebar.tsx	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/features/details-sidebar/expanded-widget-sidebar.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -21,6 +21,7 @@
 import { PlanSection } from "./sections/plan-section"
 import { TerminalSection } from "./sections/terminal-section"
 import { DiffSection } from "./sections/diff-section"
+// Explorer is now handled by ExplorerPanel (supports three display modes)
 
 interface ExpandedWidgetSidebarProps {
   /** Workspace/chat ID */
@@ -122,6 +123,9 @@
             isExpanded
           />
         )
+      // Explorer is handled by ExplorerPanel component (supports three display modes)
+      case "explorer":
+        return null
       default:
         return null
     }
Index: src/renderer/features/details-sidebar/sections/explorer-panel.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/details-sidebar/sections/explorer-panel.tsx b/src/renderer/features/details-sidebar/sections/explorer-panel.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/details-sidebar/sections/explorer-panel.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,144 @@
+"use client"
+
+import { memo, useState, useCallback, useMemo } from "react"
+import { useAtom, useSetAtom } from "jotai"
+import { FolderTree } from "lucide-react"
+import {
+  PanelContainer,
+  PanelHeader,
+  type PanelDisplayMode,
+} from "../../../components/ui/panel-container"
+import { FileTreePanel } from "../../cowork/file-tree-panel"
+import { FilePreview } from "../../cowork/file-preview/file-preview"
+import { FilePreviewDialog } from "../../cowork/file-preview/file-preview-dialog"
+import {
+  explorerDisplayModeAtom,
+  explorerSidebarWidthAtom,
+} from "../../agents/atoms"
+import { filePreviewPathAtom } from "../../cowork/atoms"
+
+interface ExplorerPanelProps {
+  chatId: string
+  worktreePath: string
+  isOpen: boolean
+  onClose: () => void
+}
+
+export const ExplorerPanel = memo(function ExplorerPanel({
+  chatId,
+  worktreePath,
+  isOpen,
+  onClose,
+}: ExplorerPanelProps) {
+  const [displayMode, setDisplayMode] = useAtom(explorerDisplayModeAtom)
+  const setFilePreviewPath = useSetAtom(filePreviewPathAtom)
+
+  // Selected file for inline preview (only used in dialog/fullscreen modes)
+  const [selectedFile, setSelectedFile] = useState<string | null>(null)
+
+  // Sidebar mode: click opens preview dialog
+  // Dialog/Fullscreen mode: click shows inline preview
+  const isCompact = displayMode === "side-peek"
+
+  // Handle file selection
+  const handleFileSelect = useCallback(
+    (path: string) => {
+      // Construct full path - path from FileTreePanel is relative
+      const fullPath = `${worktreePath.replace(/[\\/]+$/, "")}/${path}`
+
+      if (isCompact) {
+        // Open FilePreviewDialog
+        setFilePreviewPath(fullPath)
+      } else {
+        // Show inline preview
+        setSelectedFile(fullPath)
+      }
+    },
+    [isCompact, worktreePath, setFilePreviewPath]
+  )
+
+  // Handle display mode change
+  const handleDisplayModeChange = useCallback(
+    (mode: PanelDisplayMode) => {
+      setDisplayMode(mode as typeof displayMode)
+      // Clear selected file when switching to compact mode
+      if (mode === "side-peek") {
+        setSelectedFile(null)
+      }
+    },
+    [setDisplayMode]
+  )
+
+  // Title element
+  const titleElement = useMemo(
+    () => (
+      <div className="flex items-center gap-2">
+        <FolderTree className="h-4 w-4 text-muted-foreground" />
+        <span className="text-sm font-medium">Explorer</span>
+      </div>
+    ),
+    []
+  )
+
+  return (
+    <>
+      <PanelContainer
+        isOpen={isOpen}
+        onClose={onClose}
+        displayMode={displayMode}
+        widthAtom={explorerSidebarWidthAtom}
+        minWidth={280}
+        maxWidth={500}
+        className="bg-background border-l"
+        style={{ borderLeftWidth: "0.5px" }}
+      >
+        <div className="h-full flex flex-col">
+          {/* Header with mode switcher */}
+          <PanelHeader
+            title={titleElement}
+            onClose={onClose}
+            displayMode={displayMode}
+            onDisplayModeChange={handleDisplayModeChange}
+          />
+
+          {/* Content */}
+          {isCompact ? (
+            // Sidebar: file tree only
+            <div className="flex-1 overflow-hidden">
+              <FileTreePanel
+                projectPath={worktreePath}
+                onFileSelect={handleFileSelect}
+                showHeader={false}
+              />
+            </div>
+          ) : (
+            // Dialog/Fullscreen: file tree + inline preview
+            <div className="flex-1 flex min-h-0">
+              {/* File tree panel - left side */}
+              <div className="w-[280px] border-r flex-shrink-0 overflow-hidden">
+                <FileTreePanel
+                  projectPath={worktreePath}
+                  onFileSelect={handleFileSelect}
+                  showHeader={false}
+                />
+              </div>
+              {/* Inline file preview - right side */}
+              <div className="flex-1 overflow-hidden">
+                {selectedFile ? (
+                  <FilePreview filePath={selectedFile} />
+                ) : (
+                  <div className="h-full flex items-center justify-center text-muted-foreground text-sm">
+                    Select a file to preview
+                  </div>
+                )}
+              </div>
+            </div>
+          )}
+        </div>
+      </PanelContainer>
+
+      {/* File preview dialog (for sidebar mode) */}
+      <FilePreviewDialog />
+    </>
+  )
+})
Index: src/renderer/features/details-sidebar/sections/explorer-section.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/details-sidebar/sections/explorer-section.tsx b/src/renderer/features/details-sidebar/sections/explorer-section.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/details-sidebar/sections/explorer-section.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,54 @@
+"use client"
+
+import { memo } from "react"
+import { Folder } from "lucide-react"
+import { FileTreePanel } from "@/features/cowork/file-tree-panel"
+import { FilePreviewDialog } from "@/features/cowork/file-preview"
+
+// ============================================================================
+// Types
+// ============================================================================
+
+interface ExplorerSectionProps {
+  worktreePath?: string | null
+  isExpanded?: boolean
+  /** Called when a file is selected for preview */
+  onFileSelect?: (filePath: string, line?: number) => void
+}
+
+// ============================================================================
+// Explorer Section Component (Full/Expanded version)
+// ============================================================================
+
+/**
+ * Explorer Section for Expanded Widget Sidebar
+ * Wraps FileTreePanel with full height and includes FilePreviewDialog
+ */
+export const ExplorerSection = memo(function ExplorerSection({
+  worktreePath,
+  isExpanded = false,
+  onFileSelect,
+}: ExplorerSectionProps) {
+  if (!worktreePath) {
+    return (
+      <div className="h-full flex flex-col items-center justify-center text-muted-foreground">
+        <Folder className="h-12 w-12 opacity-40 mb-2" />
+        <p className="text-sm">No workspace selected</p>
+      </div>
+    )
+  }
+
+  return (
+    <div className="h-full flex flex-col">
+      {/* FileTreePanel - full height with header */}
+      <FileTreePanel
+        projectPath={worktreePath}
+        onFileSelect={onFileSelect}
+        showHeader={true}
+      />
+
+      {/* File preview dialog - triggered by file selection */}
+      <FilePreviewDialog projectPath={worktreePath} />
+    </div>
+  )
+})
Index: src/renderer/features/details-sidebar/sections/explorer-widget.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/features/details-sidebar/sections/explorer-widget.tsx b/src/renderer/features/details-sidebar/sections/explorer-widget.tsx
new file mode 100644
--- /dev/null	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
+++ b/src/renderer/features/details-sidebar/sections/explorer-widget.tsx	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -0,0 +1,117 @@
+"use client"
+
+import { memo, useCallback } from "react"
+import { useSetAtom } from "jotai"
+import { Button } from "@/components/ui/button"
+import { FolderTree, ArrowUpRight } from "lucide-react"
+import {
+  Tooltip,
+  TooltipContent,
+  TooltipTrigger,
+} from "@/components/ui/tooltip"
+import { FileTreePanel } from "@/features/cowork/file-tree-panel"
+import { FilePreviewDialog } from "@/features/cowork/file-preview/file-preview-dialog"
+import { filePreviewPathAtom } from "@/features/cowork/atoms"
+
+// ============================================================================
+// Types
+// ============================================================================
+
+interface ExplorerWidgetProps {
+  worktreePath?: string | null
+  onExpand?: () => void
+  /** Called when a file is selected for preview */
+  onFileSelect?: (filePath: string, line?: number) => void
+}
+
+// ============================================================================
+// Explorer Widget Component
+// ============================================================================
+
+/**
+ * Explorer Widget for Details Sidebar
+ * Wraps the full FileTreePanel component in a compact widget container
+ */
+export const ExplorerWidget = memo(function ExplorerWidget({
+  worktreePath,
+  onExpand,
+  onFileSelect,
+}: ExplorerWidgetProps) {
+  const setFilePreviewPath = useSetAtom(filePreviewPathAtom)
+
+  // Handle file selection - open preview dialog
+  const handleFileSelect = useCallback(
+    (path: string, line?: number) => {
+      if (worktreePath) {
+        const normalizedPath = worktreePath.replace(/[\\/]+$/, "")
+        const fullPath = `${normalizedPath}/${path}`
+        setFilePreviewPath(fullPath)
+      }
+      // Also call external callback if provided
+      onFileSelect?.(path, line)
+    },
+    [worktreePath, setFilePreviewPath, onFileSelect]
+  )
+
+  if (!worktreePath) {
+    return (
+      <div className="mx-2 mb-2">
+        <div className="rounded-lg border border-border/50 overflow-hidden">
+          <div className="flex items-center gap-2 px-2 h-8 select-none bg-muted/30">
+            <FolderTree className="h-3.5 w-3.5 text-muted-foreground" />
+            <span className="text-xs font-medium text-foreground">Explorer</span>
+          </div>
+          <div className="text-xs text-muted-foreground px-2 py-2">
+            No workspace selected
+          </div>
+        </div>
+      </div>
+    )
+  }
+
+  return (
+    <>
+      <div className="mx-2 mb-2">
+        {/* Fixed height container for proper flex layout and scrolling */}
+        <div className="rounded-lg border border-border/50 overflow-hidden flex flex-col" style={{ height: "350px" }}>
+          {/* Header */}
+          <div className="flex items-center gap-2 px-2 h-8 select-none group bg-muted/30 flex-shrink-0">
+            <FolderTree className="h-3.5 w-3.5 text-muted-foreground flex-shrink-0" />
+            <span className="text-xs font-medium text-foreground">Explorer</span>
+            <div className="flex-1" />
+
+            {/* Expand button */}
+            {onExpand && (
+              <Tooltip>
+                <TooltipTrigger asChild>
+                  <Button
+                    variant="ghost"
+                    size="icon"
+                    onClick={onExpand}
+                    className="h-5 w-5 p-0 hover:bg-foreground/10 text-muted-foreground hover:text-foreground rounded-md opacity-0 group-hover:opacity-100 transition-[background-color,opacity] duration-150 flex-shrink-0"
+                    aria-label="Expand explorer"
+                  >
+                    <ArrowUpRight className="h-3 w-3" />
+                  </Button>
+                </TooltipTrigger>
+                <TooltipContent side="left">Open in sidebar</TooltipContent>
+              </Tooltip>
+            )}
+          </div>
+
+          {/* FileTreePanel - compact mode, flex-1 for remaining space, min-h-0 allows shrinking */}
+          <div className="flex-1 min-h-0">
+            <FileTreePanel
+              projectPath={worktreePath}
+              onFileSelect={handleFileSelect}
+              showHeader={false}
+            />
+          </div>
+        </div>
+      </div>
+
+      {/* File preview dialog - triggered by file selection */}
+      <FilePreviewDialog />
+    </>
+  )
+})
Index: src/renderer/index.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/index.html b/src/renderer/index.html
--- a/src/renderer/index.html	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/index.html	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -3,7 +3,7 @@
   <head>
     <meta charset="UTF-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
-    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://*.posthog.com https://*.i.posthog.com; style-src 'self' 'unsafe-inline'; connect-src 'self' ws://localhost:* http://localhost:* https://unpkg.com https://21st.dev https://*.21st.dev https://*.posthog.com https://*.i.posthog.com; img-src 'self' data: blob: https:; media-src 'self' blob:;" />
+    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://*.posthog.com https://*.i.posthog.com; style-src 'self' 'unsafe-inline'; connect-src 'self' ws://localhost:* http://localhost:* https://unpkg.com https://21st.dev https://*.21st.dev https://*.posthog.com https://*.i.posthog.com; img-src 'self' data: blob: https: local-file:; media-src 'self' blob: local-file:; frame-src 'self' local-file:;" />
     <title>1Code</title>
     <!-- Prevent theme flash: detect system/stored theme before render -->
     <script>
Index: src/renderer/lib/hooks/use-file-change-listener.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/renderer/lib/hooks/use-file-change-listener.ts b/src/renderer/lib/hooks/use-file-change-listener.ts
--- a/src/renderer/lib/hooks/use-file-change-listener.ts	(revision fc32ba9dabbb62fddc936e5302b177d3932408a1)
+++ b/src/renderer/lib/hooks/use-file-change-listener.ts	(revision e14e1c4f402c0f8af4d73144d9ff62c7f4791f6e)
@@ -59,6 +59,11 @@
           queryKey: [["changes", "getStatus"]],
         })
 
+        // Invalidate file tree queries to refresh file list
+        queryClient.invalidateQueries({
+          queryKey: [["files", "listDirectory"]],
+        })
+
         // Also invalidate parsed diff if files were modified
         const hasModifiedFiles = data.changes.some(
           (change) => change.type === "change" || change.type === "add"
