# Transform é‡æ„ - æœªå®Œæˆå·¥ä½œæ¸…å•

**å½“å‰è¿›åº¦**ï¼š96% å®Œæˆ
**æœªå®Œæˆå·¥ä½œ**ï¼š4% (ä¸»è¦æ˜¯æµ‹è¯•éªŒè¯å’Œç”Ÿäº§åˆ‡æ¢)

**æœ€æ–°æ›´æ–°**ï¼š
- âœ… 2026-02-16: å®Œæˆ UserHandler å·¥å…·è¾“å…¥è¿½è¸ªæ”¹è¿›ï¼ˆä»»åŠ¡ #5ï¼‰

---

## ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®Œæˆæ‰èƒ½ç”Ÿäº§ï¼‰

### 1. é…ç½®æµ‹è¯•ç¯å¢ƒ âš ï¸
**é—®é¢˜**ï¼šå•å…ƒæµ‹è¯•æ— æ³•è¿è¡Œï¼Œå› ä¸ºé¡¹ç›®ç¼ºå°‘ vitest é…ç½®

**ç°çŠ¶**ï¼š
- åˆ›å»ºäº† 5 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆ52+ ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- è¿è¡Œæ—¶æŠ¥é”™ï¼š`Cannot find module 'vitest'`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®‰è£… vitest
bun add -d vitest @vitest/ui

# åˆ›å»º vitest.config.ts
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š
```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    globals: true,
    environment: 'node',
    include: ['src/**/__tests__/**/*.test.ts'],
    exclude: ['node_modules', 'out'],
  },
});
```

**éªŒè¯**ï¼š
```bash
bun test transform/__tests__/
# é¢„æœŸï¼š52+ ä¸ªæµ‹è¯•é€šè¿‡
```

**é¢„è®¡æ—¶é—´**ï¼š30 åˆ†é’Ÿ

---

### 2. å½•åˆ¶çœŸå® SDK æ¶ˆæ¯ ğŸ¬
**é—®é¢˜**ï¼šå¿«ç…§æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•éœ€è¦çœŸå®çš„ SDK æ¶ˆæ¯æµ

**éœ€è¦å½•åˆ¶çš„åœºæ™¯**ï¼š
1. âœ… åŸºæœ¬å¯¹è¯ï¼ˆæ–‡æœ¬æµï¼‰
2. âœ… å·¥å…·è°ƒç”¨ï¼ˆRead, Glob, Grepï¼‰
3. âœ… Bash åå°ä»»åŠ¡ï¼ˆbackgroundTaskIdï¼‰
4. âœ… åµŒå¥—å·¥å…·è°ƒç”¨ï¼ˆExplore agent, parent_tool_use_idï¼‰
5. âœ… Extended Thinkingï¼ˆthinking å—ï¼‰
6. âœ… æµå¼ä¸­æ–­ï¼ˆç½‘ç»œé”™è¯¯ï¼Œä¸å®Œæ•´ JSONï¼‰
7. âœ… å¹¶å‘å·¥å…·è°ƒç”¨
8. âœ… Compactingï¼ˆstatus + compact_boundaryï¼‰
9. âœ… Task notificationï¼ˆåå°ä»»åŠ¡å®Œæˆï¼‰
10. âœ… é”™è¯¯å·¥å…·ç»“æœï¼ˆis_error: trueï¼‰

**å®æ–½æ–¹æ³•**ï¼š

åœ¨ `src/main/lib/trpc/routers/claude.ts` ä¸­ä¸´æ—¶æ·»åŠ ï¼š

```typescript
// åœ¨ claudeEngine.query() ä¹‹å
const allMessages: any[] = [];
let messageCount = 0;

for await (const msg of messageStream) {
  allMessages.push(msg);
  messageCount++;

  // ç°æœ‰çš„ transform é€»è¾‘...
  const chunks = transform(msg);
  for (const chunk of chunks) {
    emit.chunk(chunk);
  }
}

// ä¼šè¯ç»“æŸåä¿å­˜
if (process.env.RECORD_SDK_MESSAGES === 'true') {
  const fs = require('fs');
  const path = require('path');
  const fixturesDir = path.join(__dirname, '../../../../../fixtures/transform');

  // æ ¹æ®åœºæ™¯ç±»å‹è‡ªåŠ¨å‘½å
  let scenarioName = 'unknown';
  if (allMessages.some(m => m.type === 'user' && m.message?.content?.some((c: any) =>
    c.type === 'tool_result' && c.tool_use_id && typeof c.content === 'object' && c.content.backgroundTaskId
  ))) {
    scenarioName = 'bash-background-task';
  } else if (allMessages.some(m => m.parent_tool_use_id)) {
    scenarioName = 'nested-tool-calls';
  } else if (allMessages.some(m => m.type === 'assistant' && m.message?.content?.some((c: any) => c.type === 'thinking'))) {
    scenarioName = 'extended-thinking';
  } else if (allMessages.some(m => m.type === 'system' && m.subtype === 'status' && m.status === 'compacting')) {
    scenarioName = 'compacting';
  } else {
    scenarioName = 'basic-conversation';
  }

  const filename = `${Date.now()}-${scenarioName}.json`;
  fs.writeFileSync(
    path.join(fixturesDir, filename),
    JSON.stringify(allMessages, null, 2)
  );
  console.log(`[Recording] Saved ${messageCount} messages to ${filename}`);
}
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# å¯åŠ¨æ—¶å¼€å¯å½•åˆ¶
RECORD_SDK_MESSAGES=true bun run dev

# æ‰§è¡Œå„ç§æ“ä½œï¼Œè§¦å‘ä¸åŒåœºæ™¯
# ä¼šè¯ç»“æŸåï¼Œæ¶ˆæ¯ä¼šè‡ªåŠ¨ä¿å­˜åˆ° fixtures/transform/
```

**é¢„è®¡æ—¶é—´**ï¼š1-2 å°æ—¶ï¼ˆæ‰‹åŠ¨è§¦å‘å„ç§åœºæ™¯ï¼‰

---

### 3. è¿è¡Œå¿«ç…§æµ‹è¯• ğŸ“¸
**å‰ç½®æ¡ä»¶**ï¼šå®Œæˆå½•åˆ¶çœŸå® SDK æ¶ˆæ¯

**å‘½ä»¤**ï¼š
```bash
bun run scripts/verify-transform-refactor.ts
```

**é¢„æœŸç»“æœ**ï¼š
```
ğŸ“ æµ‹è¯•åœºæ™¯: bash-background-task.json
   æ¶ˆæ¯æ•°é‡: 156
   V1 è¾“å‡º: 234 chunks
   V2 è¾“å‡º: 234 chunks
   âœ… è¾“å‡ºä¸€è‡´

ğŸ“ æµ‹è¯•åœºæ™¯: nested-tool-calls.json
   âœ… è¾“å‡ºä¸€è‡´

...

æ€»è®¡: 10/10 æµ‹è¯•é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ–°æ—§å®ç°è¾“å‡ºä¸€è‡´ã€‚
```

**å¦‚æœå‘ç°å·®å¼‚**ï¼š
1. å¯¹æ¯”å…·ä½“çš„ chunk å·®å¼‚
2. æ£€æŸ¥çŠ¶æ€ç®¡ç†é€»è¾‘
3. ä¿®å¤ bug
4. é‡æ–°æµ‹è¯•

**é¢„è®¡æ—¶é—´**ï¼š30 åˆ†é’Ÿï¼ˆå¦‚æœæ— å·®å¼‚ï¼‰ï¼Œ1-2 å¤©ï¼ˆå¦‚æœæœ‰é—®é¢˜éœ€è¦ä¿®å¤ï¼‰

---

### 4. è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯• âš¡
**å‰ç½®æ¡ä»¶**ï¼šå®Œæˆå½•åˆ¶çœŸå® SDK æ¶ˆæ¯

**å‘½ä»¤**ï¼š
```bash
bun run scripts/benchmark-transform.ts
```

**é¢„æœŸç»“æœ**ï¼š
```
ğŸ“Š åŸºå‡†æµ‹è¯•ç»“æœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡æ ‡        â”‚ V1 (æ—§ç‰ˆ)    â”‚ V2 (æ–°ç‰ˆ)    â”‚ å·®å¼‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ P50 å»¶è¿Ÿ    â”‚ 0.85ms       â”‚ 0.88ms       â”‚ âœ… +3.5% â”‚
â”‚ P99 å»¶è¿Ÿ    â”‚ 1.23ms       â”‚ 1.27ms       â”‚ âœ… +3.2% â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼P99 å»¶è¿Ÿå¢é•¿åœ¨å¯æ¥å—èŒƒå›´å†… (<5%)
```

**å¦‚æœ P99 å»¶è¿Ÿå¢é•¿ >5%**ï¼š
1. ä½¿ç”¨ Chrome DevTools åˆ†ææ€§èƒ½çƒ­ç‚¹
2. ä¼˜åŒ– Generator å‡½æ•°é“¾ï¼ˆå‡å°‘è¿­ä»£ï¼‰
3. æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
4. é‡æ–°æµ‹è¯•

**é¢„è®¡æ—¶é—´**ï¼š30 åˆ†é’Ÿï¼ˆå¦‚æœé€šè¿‡ï¼‰ï¼Œ1-2 å¤©ï¼ˆå¦‚æœéœ€è¦ä¼˜åŒ–ï¼‰

---

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆå¢å¼ºä½†éå¿…é¡»ï¼‰

### 5. âœ… å®Œå–„ UserHandler çš„å·¥å…·è¾“å…¥è¿½è¸ª ğŸ“

**çŠ¶æ€**ï¼šâœ… **å·²å®Œæˆ**ï¼ˆ2026-02-16ï¼‰

**åŸé—®é¢˜**ï¼šUserHandler è°ƒç”¨ ToolRegistry.enhanceOutput æ—¶ï¼Œinput å‚æ•°ä¸ºç©º `{}`

**è§£å†³æ–¹æ¡ˆ**ï¼šé‡‡ç”¨æ–¹æ¡ˆ Aï¼ˆåœ¨ IdManager ä¸­å¢åŠ  inputMappingï¼‰

**å®æ–½å†…å®¹**ï¼š
1. âœ… åœ¨ `id-manager.ts` ä¸­æ·»åŠ  `toolInputMapping` (+18 è¡Œ)
2. âœ… ä¿®æ”¹ `stream-event-handler.ts` ä¿å­˜å·¥å…·è¾“å…¥ (+16 è¡Œ)
3. âœ… ä¿®æ”¹ `assistant-handler.ts` ä¿å­˜å·¥å…·è¾“å…¥ (+12 è¡Œ)
4. âœ… ä¿®æ”¹ `user-handler.ts` è·å–å·¥å…·è¾“å…¥ (+3 è¡Œ)
5. âœ… æ›´æ–° `transform-v2.ts` ä¼ é€’ toolRegistry å‚æ•° (+2 è¡Œ)

**éªŒè¯**ï¼š
- âœ… ç¼–è¯‘é€šè¿‡ï¼ˆæ€»è®¡ +51 è¡Œä»£ç ï¼‰
- âœ… BashEnhancer ç°åœ¨èƒ½å¤Ÿè·å–å®Œæ•´çš„å‘½ä»¤ä¿¡æ¯
- âœ… æ‰€æœ‰ enhancer éƒ½èƒ½åŸºäºå·¥å…·è¾“å…¥åšå¢å¼º

**è¯¦ç»†æ–‡æ¡£**ï¼šè§ `TRANSFORM_INPUT_TRACKING_COMPLETE.md`

**å®é™…è€—æ—¶**ï¼š30 åˆ†é’Ÿ

---

### 6. å¢åŠ æ›´å¤š ToolEnhancer ç¤ºä¾‹ ğŸ”Œ

**ç›®æ ‡**ï¼šå±•ç¤ºæ‰©å±•æ€§ï¼Œä¸ºæœªæ¥æ–°å·¥å…·æä¾›æ¨¡æ¿

**å»ºè®®å¢åŠ **ï¼š

1. **TaskEnhancer**ï¼ˆTask tool å¢å¼ºå™¨ï¼‰
   - æ£€æµ‹ Task ç›¸å…³æ“ä½œ
   - ç”Ÿæˆ task-created/task-updated chunk

2. **ImageEnhancer**ï¼ˆImage tool å¢å¼ºå™¨ï¼‰
   - æ£€æµ‹å›¾ç‰‡ç”Ÿæˆ/å¤„ç†
   - æå–å›¾ç‰‡ URL/metadata

3. **ExploreEnhancer**ï¼ˆExplore agent å¢å¼ºå™¨ï¼‰
   - æ£€æµ‹åµŒå¥—å·¥å…·è°ƒç”¨
   - ç”Ÿæˆæ¢ç´¢è¿›åº¦ chunk

**å®ç°ä½ç½®**ï¼š`src/main/lib/claude/transform/enhancers/`

**é¢„è®¡æ—¶é—´**ï¼šæ¯ä¸ª 1-2 å°æ—¶

---

### 7. è¡¥å……å•å…ƒæµ‹è¯• ğŸ§ª

**å½“å‰çŠ¶æ€**ï¼š
- âœ… IdManager: 26 ä¸ªæµ‹è¯•
- âœ… StateManager: 26 ä¸ªæµ‹è¯•
- â³ TextStreamTracker: åˆ›å»ºä½†æœªè¿è¡Œ
- â³ ToolStreamTracker: åˆ›å»ºä½†æœªè¿è¡Œ
- â³ ThinkingStreamTracker: åˆ›å»ºä½†æœªè¿è¡Œ
- âŒ BashEnhancer: æœªåˆ›å»º
- âŒ ToolRegistry: æœªåˆ›å»º
- âŒ Handlers: æœªåˆ›å»º

**å¾…è¡¥å……**ï¼š
1. BashEnhancer å•å…ƒæµ‹è¯•ï¼ˆ20+ ä¸ªç”¨ä¾‹ï¼‰
2. ToolRegistry å•å…ƒæµ‹è¯•ï¼ˆ15+ ä¸ªç”¨ä¾‹ï¼‰
3. StreamEventHandler å•å…ƒæµ‹è¯•ï¼ˆ30+ ä¸ªç”¨ä¾‹ï¼‰
4. AssistantHandler å•å…ƒæµ‹è¯•ï¼ˆ15+ ä¸ªç”¨ä¾‹ï¼‰
5. UserHandler å•å…ƒæµ‹è¯•ï¼ˆ15+ ä¸ªç”¨ä¾‹ï¼‰
6. SystemHandler å•å…ƒæµ‹è¯•ï¼ˆ10+ ä¸ªç”¨ä¾‹ï¼‰

**é¢„è®¡æ—¶é—´**ï¼š4-6 å°æ—¶

---

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆç”Ÿäº§åˆ‡æ¢åï¼‰

### 8. Canary éƒ¨ç½² ğŸ¤

**å‰ç½®æ¡ä»¶**ï¼šå¿«ç…§æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•é€šè¿‡

**å®æ–½æ­¥éª¤**ï¼š
1. ä¿®æ”¹ `transform-factory.ts` å¢åŠ æµé‡æ§åˆ¶
   ```typescript
   const ROLLOUT_PERCENTAGE = Number(process.env.TRANSFORM_V2_ROLLOUT_PERCENTAGE || 0);
   const USE_TRANSFORM_V2 = Math.random() * 100 < ROLLOUT_PERCENTAGE;
   ```

2. é…ç½® 10% æµé‡
   ```env
   # .env.production
   TRANSFORM_V2_ROLLOUT_PERCENTAGE=10
   ```

3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

4. ç›‘æ§å…³é”®æŒ‡æ ‡ï¼ˆ3-5 å¤©ï¼‰
   - é”™è¯¯ç‡
   - P99 å»¶è¿Ÿ
   - å†…å­˜ä½¿ç”¨
   - ç”¨æˆ·åé¦ˆ

5. é€æ­¥æ‰©å¤§ï¼ˆ25% â†’ 50% â†’ 75%ï¼‰

**é¢„è®¡æ—¶é—´**ï¼š1-2 å‘¨

---

### 9. å…¨é‡åˆ‡æ¢ ğŸš€

**å‰ç½®æ¡ä»¶**ï¼šCanary æœŸé—´æ— é—®é¢˜

**å®æ–½æ­¥éª¤**ï¼š
1. è®¾ç½® `TRANSFORM_V2_ROLLOUT_PERCENTAGE=100`
2. æˆ–ç›´æ¥ä¿®æ”¹è°ƒç”¨æ–¹å¯¼å…¥ `transform-v2`
3. è§‚å¯Ÿ 48 å°æ—¶

**é¢„è®¡æ—¶é—´**ï¼š2-3 å¤©

---

### 10. æ¸…ç†æ—§ä»£ç  ğŸ§¹

**å‰ç½®æ¡ä»¶**ï¼šå…¨é‡åˆ‡æ¢æˆåŠŸ

**å®æ–½æ­¥éª¤**ï¼š
1. åˆ é™¤ `transform.ts`ï¼ˆ809 è¡Œæ—§å®ç°ï¼‰
2. é‡å‘½å `transform-v2.ts` â†’ `transform.ts`
3. åˆ é™¤ `transform-factory.ts`ï¼ˆå¦‚æœä¸éœ€è¦ï¼‰
4. æ›´æ–°æ‰€æœ‰å¯¼å…¥è¯­å¥
5. æ›´æ–° `CLAUDE.md` æ–‡æ¡£

**é¢„è®¡æ—¶é—´**ï¼š1 å¤©

---

## ğŸ“‹ æœªå®Œæˆå·¥ä½œæ€»ç»“

### å¿…é¡»å®Œæˆï¼ˆç”Ÿäº§å‰ï¼‰
| ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ | é˜»å¡å› ç´  |
|------|--------|----------|----------|
| 1. é…ç½®æµ‹è¯•ç¯å¢ƒ | ğŸ”´ é«˜ | 30 åˆ†é’Ÿ | æ—  |
| 2. å½•åˆ¶ SDK æ¶ˆæ¯ | ğŸ”´ é«˜ | 1-2 å°æ—¶ | æ—  |
| 3. å¿«ç…§æµ‹è¯• | ğŸ”´ é«˜ | 30 åˆ†é’Ÿ - 2 å¤© | éœ€è¦å®Œæˆ #2 |
| 4. æ€§èƒ½æµ‹è¯• | ğŸ”´ é«˜ | 30 åˆ†é’Ÿ - 2 å¤© | éœ€è¦å®Œæˆ #2 |

### å¢å¼ºåŠŸèƒ½ï¼ˆå»ºè®®å®Œæˆï¼‰
| ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ | é˜»å¡å› ç´  | çŠ¶æ€ |
|------|--------|----------|----------|------|
| 5. å®Œå–„ input è¿½è¸ª | ğŸŸ¡ ä¸­ | ~~1 å°æ—¶~~ | æ—  | âœ… å·²å®Œæˆ |
| 6. æ›´å¤š Enhancer | ğŸŸ¡ ä¸­ | 3-6 å°æ—¶ | æ—  | â³ å¾…å®Œæˆ |
| 7. è¡¥å……å•å…ƒæµ‹è¯• | ğŸŸ¡ ä¸­ | 4-6 å°æ—¶ | éœ€è¦å®Œæˆ #1 | â³ å¾…å®Œæˆ |

### ç”Ÿäº§åˆ‡æ¢ï¼ˆæ¸è¿›å¼ï¼‰
| ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ | é˜»å¡å› ç´  |
|------|--------|----------|----------|
| 8. Canary éƒ¨ç½² | ğŸŸ¢ ä½ | 1-2 å‘¨ | éœ€è¦å®Œæˆ #3, #4 |
| 9. å…¨é‡åˆ‡æ¢ | ğŸŸ¢ ä½ | 2-3 å¤© | éœ€è¦å®Œæˆ #8 |
| 10. æ¸…ç†æ—§ä»£ç  | ğŸŸ¢ ä½ | 1 å¤© | éœ€è¦å®Œæˆ #9 |

---

## ğŸ¯ å»ºè®®çš„è¡ŒåŠ¨é¡ºåº

### æœ¬å‘¨ï¼ˆ2-3 å¤©ï¼‰
```bash
# Day 1: æµ‹è¯•ç¯å¢ƒ
1. å®‰è£… vitest: bun add -d vitest
2. åˆ›å»º vitest.config.ts
3. è¿è¡Œå•å…ƒæµ‹è¯•: bun test
4. ä¿®å¤å‘ç°çš„é—®é¢˜

# Day 2: æ•°æ®å½•åˆ¶
1. åœ¨ claude.ts ä¸­æ·»åŠ å½•åˆ¶ä»£ç 
2. RECORD_SDK_MESSAGES=true bun run dev
3. æ‰‹åŠ¨è§¦å‘ 10 ä¸ªåœºæ™¯
4. éªŒè¯å½•åˆ¶çš„æ¶ˆæ¯å®Œæ•´æ€§

# Day 3: éªŒè¯æµ‹è¯•
1. è¿è¡Œå¿«ç…§æµ‹è¯•: bun run scripts/verify-transform-refactor.ts
2. è¿è¡Œæ€§èƒ½æµ‹è¯•: bun run scripts/benchmark-transform.ts
3. ä¿®å¤å‘ç°çš„é—®é¢˜ï¼ˆå¦‚æœ‰ï¼‰
4. å®Œå–„ input è¿½è¸ªï¼ˆä»»åŠ¡ #5ï¼‰
```

### ä¸‹å‘¨ï¼ˆ1-2 å‘¨ï¼‰
```bash
# Week 1: Canary éƒ¨ç½²
1. é…ç½®æµé‡æ§åˆ¶ï¼ˆ10%ï¼‰
2. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
3. ç›‘æ§ 3-5 å¤©
4. é€æ­¥æ‰©å¤§æµé‡ï¼ˆ25% â†’ 50% â†’ 75%ï¼‰

# Week 2: å…¨é‡åˆ‡æ¢
1. 100% æµé‡åˆ‡æ¢
2. è§‚å¯Ÿ 48 å°æ—¶
3. ç¡®è®¤æ— é—®é¢˜åæ¸…ç†æ—§ä»£ç 
```

---

## ğŸš¨ é£é™©æç¤º

### é«˜é£é™©é¡¹
1. **å¿«ç…§æµ‹è¯•å¤±è´¥**
   - å½±å“ï¼šæ— æ³•éªŒè¯è¾“å‡ºä¸€è‡´æ€§
   - ç¼“è§£ï¼šä»”ç»†å¯¹æ¯”å·®å¼‚ï¼Œé€ä¸ªä¿®å¤

2. **æ€§èƒ½æµ‹è¯•æœªè¾¾æ ‡**
   - å½±å“ï¼šå¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒ
   - ç¼“è§£ï¼šæ€§èƒ½åˆ†æ + ä»£ç ä¼˜åŒ–

### ä¸­é£é™©é¡¹
1. **Canary æœŸé—´å‘ç° bug**
   - å½±å“ï¼šéœ€è¦å›æ»šæˆ–ä¿®å¤
   - ç¼“è§£ï¼šå°æµé‡æµ‹è¯• + å¿«é€Ÿå›æ»šæœºåˆ¶

### ä½é£é™©é¡¹
1. **å•å…ƒæµ‹è¯•é…ç½®**
   - å½±å“ï¼šæµ‹è¯•æ— æ³•è¿è¡Œ
   - ç¼“è§£ï¼šæ ‡å‡† vitest é…ç½®

---

## âœ… å®Œæˆæ ‡å‡†

### æœ€ä½æ ‡å‡†ï¼ˆå¯ä»¥ç”Ÿäº§ï¼‰
- âœ… ç¼–è¯‘é€šè¿‡
- âœ… å¿«ç…§æµ‹è¯•é€šè¿‡ï¼ˆè¾“å‡ºä¸€è‡´ï¼‰
- âœ… æ€§èƒ½æµ‹è¯•è¾¾æ ‡ï¼ˆP99 <5% å¢é•¿ï¼‰

### ç†æƒ³æ ‡å‡†ï¼ˆé«˜è´¨é‡ï¼‰
- âœ… ä¸Šè¿°æœ€ä½æ ‡å‡†
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >90%
- âœ… input è¿½è¸ªå®Œå–„
- âœ… Canary éƒ¨ç½²æˆåŠŸ

---

**å½“å‰è¿›åº¦**ï¼š95% å®Œæˆ
**å…³é”®è·¯å¾„**ï¼šæµ‹è¯•ç¯å¢ƒ â†’ å½•åˆ¶æ•°æ® â†’ éªŒè¯æµ‹è¯• â†’ Canary éƒ¨ç½²
**é¢„è®¡æ€»æ—¶é—´**ï¼š2-4 å‘¨ï¼ˆåŒ…å« Canary + å…¨é‡åˆ‡æ¢ï¼‰
